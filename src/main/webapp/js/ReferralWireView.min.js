(function(H,C){if("object"===typeof exports){var v=require("jquery"),D=require("underscore"),E=require("backbone"),F=require("templatecache"),G=require("babysitter"),n=require("csvparser"),d=require("ReferralWireBase");module.exports=C(v,D,E,F,G,n,d)}else"function"===typeof define&&define.amd&&define("jquery underscore backbone templatecache babysitter csvparser ReferralWireBase".split(" "),C)})(this,function(H,C,v,D,E,F,G){v.ReferralWireView=ReferralWireView=function(n,d,c,v,C,D,m){var j={};j.ChildViewContainer=
new n.ChildViewContainer;j.FormView=n.View.extend({actor:"",tagName:"div",applet:"",templateHTML:function(){return"StdForm"},template:"",metaApplet:null,error:null,success:null,parentView:null,showViewBar:!1,viewBarTemplate:"",events:{"change select":"changeItem","change input":"changeItem","change textarea":"changeItem","click #save":"saveItem","click #editProfile":"editRecord","click #cancel":"cancelUpdate","click [pickApplet]":"launchPick","click [multicheckbox_search]":function(a){this.addToMultiCheckSearchBox(a)},
"click .removeSelectedMCS":function(a){this.removeMultiCheckSearchBox(a)},"click .multicheck-search-container":function(a){this.setMCSFocus(a)}},initialize:function(a){this.applet=a.applet;this.error=c.hasVal(a.error)?a.error:rwcore.showError;this.success=a.success;this.viewBarTemplate=a.viewBarTemplate;this.refreshFunctionStatic=a.refreshFunctionStatic;this.refreshFunction=a.refreshFunction;!d.isUndefined(a.templateHTML)&&!d.isNull(a.templateHTML)&&(this.templateHTML=a.templateHTML);!d.isUndefined(a.parentView)&&
!d.isNull(a.parentView)&&(this.parentView=a.parentView);!d.isUndefined(a.showViewBar)&&(!d.isNull(a.showViewBar)&&a.showViewBar)&&(this.showViewBar=!0);var b=this.applet,e=!d.isUndefined(this.model)?this.model:void 0;d.isFunction(this.applet)&&(b=this.applet(e));var f=this.viewBarTemplate;d.isFunction(this.viewBarTemplate)&&(f=this.viewBarTemplate(e));this.metaApplet=new m.AppletView({applet:b,template:this.templateHTML,showViewBar:this.showViewBar,viewBarTemplate:f,clickRoute:a.clickRoute});this.actor=
this.metaApplet.actor;this.bc=this.metaApplet.bc;this.bo=this.metaApplet.bo;this.class=a.class;this.options=a},setDefaultModel:function(a){this.model=new rwcore.StandardModel({module:this.actor,bo:this.bo,bc:this.bc});m.setDefaultValues(this.model,this.metaApplet,a)},launchPick:function(a){var b;b="A"==a.target.tagName?c(a.target).attr("id"):c(a.target).parents("a").attr("id");a=this.metaApplet.model.attributes.field;if(d.isUndefined(a))return"";!1==d.isArray(a)&&(a=[a]);var e=d.find(a,function(a){return a.fldname==
b});a=e.pickApplet;var f=c.hasVal(e.pickUsePaging)&&e.pickUsePaging?!0:null,h=c.hasVal(e.listItemClass)?e.listItemClass:void 0,g=null,g=c.hasVal(e.pickListTemplate)&&-1<e.pickListTemplate.indexOf("rwApp.")?eval(e.pickListTemplate):c.hasVal(e.pickListTemplate)?e.pickListTemplate:"StdDynamicPickList",k=rwApp.getCopyPickMaps(e.pickMap);if(d.isUndefined(k))return"";var l=new j.ListView({applet:a,setFilter:!0,listItemClass:h,template:g,parentView:this,ulClass:"pickID",batchSize:12,usePaging:f,pickMap:k});
a=rwApp.addConstraintPickMapExpressions(e.pickMap,this.model,l.searchSpec);var h=l.listItem.metaApplet.model.attributes.field,h=!d.isUndefined(l.sortBy)&&!d.isNull(l.sortBy)?l.sortBy:c.isArray(h)?h[0].fldname:h.fldname,I=this;(new rwcore.StandardCollection({module:l.actor,bc:l.bc,bo:l.bo,searchSpec:a,sortby:h,limit:d.isNull(f)?void 0:rwcore.pagingSize,shape:"Skinny"})).fetch({add:!0,error:function(a,b,c){(new rwcore.ErrorView({request:a,status:b,error:c})).render(b.responseText)},success:function(a){l.model=
a;l=I.insertPickNull(e.pickMap,l);a=l.render().el;var b=l.listItem.metaApplet.model.attributes.pickTitle,h=l.listItem.metaApplet.model.attributes.pickCreateApplet;c("#pickTitle").html(b);c.hasVal(h)?c("#pickCreate").show():c("#pickCreate").hide();c("#pickListContents").html(a).trigger("create");c.hasVal(f)&&f&&(c("#"+l.id+".pickID").on("listviewbeforefilter",l,l.textSearchHandler),c("#"+l.id+".pickID").on("scroll",l,l.scrollHandler));c("#pickBackground").show(50);c("#picklistContainer").show(250);
c("#picklistContainer").one("click","#cancelPick",function(){l.cancelPick();c("#picklistContainer").off("click","#pickCreate")});c("#picklistContainer").one("click","#pickCreate",function(){var a=l.pickCreate("ContactUpsertForm","PickCreateForm");c("#picklistContainer").off("click","#cancelPick");c("#picklistContainer").one("click","#savePickCreate",function(){var b=m.validateRequired(a.model,a.metaApplet);if(d.isNull(b))a.model.save({},{success:function(){l.execPickMap(a.model);c("#pickCreateMode").hide();
c("#pickMode").show();c("#pickMode").css("left","5px");c("#pickCreateMode").css("left","500px");c("#picklistContainer").off("click","#cancelPickCreate")},error:function(b,c,e){d.isUndefined(a.error)||a.error(b,c,e)},done:function(){}});else if(!d.isUndefined(a.error)){var e={};e.responseText=b;e.status=99999;a.error(null,e,null)}});c("#picklistContainer").one("click","#cancelPickCreate",function(){l.cancelPick();c("#pickCreateMode").hide();c("#pickMode").show();c("#picklistContainer").off("click",
"#savePickCreate");c("#pickMode").css("left","5px");c("#pickCreateMode").css("left","500px")})})}})},insertPickNull:function(a,b){var c=d.where(a,{type:"pickNone"});if(0<c.length){var f={};d.each(c,function(a){f[a.fldname]=a.value});c=new rwcore.StandardModel({module:b.model.options.module});c.set(f);b.model.add([c],{at:0});b.model.models[0].id=c.get("id")}return b},getActionsBarHTML:function(){return this.metaApplet.renderActionsBar()},render:function(a){try{rwcore.spinOn();!d.isUndefined(a)&&!d.isNull(a)&&
(this.model=a);if(!c.hasVal(this.metaAppletHasRadioModels)||!this.metaAppletHasRadioModels){var b=this.templateHTML,e=this.viewBarTemplate,f=this.applet;d.isFunction(this.templateHTML)&&(b=this.templateHTML(this.model));d.isFunction(this.applet)&&(f=this.applet(this.model));d.isFunction(this.viewBarTemplate)&&(e=this.viewBarTemplate(this.model));this.metaApplet=new m.AppletView({applet:f,template:b,showViewBar:this.showViewBar,viewBarTemplate:e,clickRoute:this.options.clickRoute})}var h=this.template=
this.metaApplet.render().el,g=this.metaApplet.model.get("type");if((d.isUndefined(this.model)||d.isNull(this.model))&&(d.isUndefined(this.options.htmlOnly)||!1==this.options.htmlOnly))"form"==g&&(h=d.template("NoRecordForm")()),"formPlain"==g&&(h=""),"viewbar"==g&&(this.metaApplet.template="NoRecordViewBar",h=this.metaApplet.render().el),"ReferralInboxMenu"==this.applet&&(h="");var k=m.recordBinder(h,this.model);c(this.el).html(k);switch(this.tagName){case "ul":c(this.el).attr("data-role","listview"),
c(this.el).attr("data-inset","true"),c(this.el).addClass("formfields")}rwcore.spinOff()}catch(l){rwcore.spinOff()}return this},mcsTextSearchHandler:function(a){var b=c(this),e=b.attr("fldname");a=a.data;a.adjustDD(e);var f=a.MCSFields[e],h=a.radioModels[e].radioList,g=c("#"+e+".multicheck-search-container input").val();if(1<g.length){d.isUndefined(a.mcsHtml)&&(a.mcsHtml={});d.isUndefined(a.mcsHtml[e])&&(a.mcsHtml[e]=b.html());var k=new m.AppletView({applet:f.pickApplet,template:""}),k=rwApp.addConstraintPickMapExpressions(f.pickMap,
a.model,k.model.get("searchSpec"));h.options.searchText=g;h.reset();h.options.searchSpec=k;rwApp.fetchList(h.options).done(function(a){fldHtml=(new m.PickList({model:a,fldname:e,order:f.order,key:f.lookupKeyField,display:f.lookupDisplayField,displayListField:f.displayListField,pickTemplate:f.pickListTemplate})).render(!1).el.innerHTML;a=c(c.parseHTML(fldHtml)).find("ul");b.html(a.html());b.listview("refresh")})}if(0==g.length&&!d.isUndefined(a.mcsHtml)&&!d.isUndefined(a.mcsHtml[e])){h=a.mcsHtml[e];
g=a.model.get(e);if(c.hasVal(g)){h=g.split(",");a=c(c.parseHTML("<div>"+a.mcsHtml[e]+"</div>"));for(g=0;g<h.length;g++)k="#"+e+"-"+h[g].replace(/\s/g,"")+"-typeahead",a.find(k).hide();h=a.html()}b.html(h)}},updateCommaDelimitedVal:function(a){var b=a.fieldValue,e="",e=this.model.get(a.fieldName);if(c.hasVal(e)){a=e.split(",");for(var e="",f=!0,d=0;d<a.length;d++){var g=a[d];g!=b?e+=""!=e?","+g:g:f=!1}f&&(e+=","+b)}else e=b;return e},renderSelectedMultiCheckSearch:function(a){var b=a.commaList,e=a.fieldName,
f=a.dispList,h=a.dispListFld;a="";var g="#"+e+"-selected.multicheck-selected-items";if(c.hasVal(b)&&c.hasVal(e)){for(var b=b.split(","),f=f.split(","),k=c(d.template("Snippets")()).find("#selectedMultiCheckSearch").html(),l=0;l<b.length;l++){var j=b[l],q=f[l],p=k.replace(/ZfieldName/g,e),p=p.replace(/ZglobalVal/g,j),p=p.replace(/ZdisplayVal/g,q),p=p.replace(/ZdisplayField/g,q),p=p.replace(/ZdisplayListField/g,h),q="#"+e+"-"+j.replace(/\s/g,"")+"-typeahead",m="#"+e+"-"+j.replace(/\s/g,"")+"-tile";
c(q).hide();c(m).hide();a+=p}c(g).length||(h=c(d.template("Snippets")()).find("#selectedMCSGroup").html(),h=h.replace(/ZfieldName/g,e),h=h.replace(/ZglobalVal/g,j),c("#"+e+" .ui-listview-filter .ui-input-search").prepend(h),this.addedSelectedDiv=!0)}c(g).html(a)},renderAllMultiCheckSearchControls:function(){var a=c(this.el).find(".multicheck-search-container").toArray(),b=this.metaApplet.model.attributes.field;d.isArray(b)||(b=[b]);0<a.length&&(this.MCSFields={});for(var e=0;e<a.length;e++){var f=
a[e].id,h=c("#"+f+".multicheck-search-container").attr("lovType"),g=c("#"+f+".multicheck-search-container").attr("order");this.MCSFields[f]=b[g-1];g=this.MCSFields[f].pickUsePaging;if(c.hasVal(g)&&g)c("#"+f+".multicheck-search-container ul").on("listviewbeforefilter",this,this.mcsTextSearchHandler);var g=this.model.get(f),k=this.MCSFields[f].lookupDisplayField,l=this.MCSFields[f].displayListField,j=k==f?g:this.model.get(l);this.renderSelectedMultiCheckSearch({commaList:g,fieldName:f,lovType:h,dispList:j,
displayField:k,dispListFld:l});this.adjustDD(f)}},adjustDD:function(a){var b="#"+a+".multicheck-search-container",e=c(b).offset().left,b=c(b+" input.ui-input-text").offset().left-e;c("#"+a+" ul").css("margin-left",b)},addToMultiCheckSearchBox:function(a){a=a.target;var b=d.isUndefined(c("#"+a.id).attr("multicheckbox_search"))?c("#"+a.id).parents("[multicheckbox_search]"):c("#"+a.id);a=b.attr("multicheckbox_search");var e=b.attr("name"),e=this.updateCommaDelimitedVal({fieldName:a,fieldValue:e}),f=
b.attr("displayField"),h=b.attr("displayVal"),b=b.attr("displayListField"),h=f==a?e:this.updateCommaDelimitedVal({fieldName:b,fieldValue:h});this.renderSelectedMultiCheckSearch({commaList:e,fieldName:a,dispList:h,displayField:f,dispListFld:b});this.model.set(a,e);this.model.set(b,h);c("#"+a+".multicheck-search-container input").val("");c("#"+a+".multicheck-search-container input").trigger("keyup");c("#"+a+".multicheck-search-container input").focus()},removeMultiCheckSearchBox:function(a){var b=d.isUndefined(c(a.target).attr("multicheckbox_search_selected"))?
c(a.target).parents("[multicheckbox_search_selected]"):c(a.target);a=b.attr("multicheckbox_search_selected");var e=b.attr("name");c("#"+a+".multicheck-search-container").attr("lovType");var f=this.updateCommaDelimitedVal({fieldName:a,fieldValue:e}),h=b.attr("displayField"),g=b.attr("displayVal"),b=b.attr("displayListField"),g=h==a?f:this.updateCommaDelimitedVal({fieldName:b,fieldValue:g});this.renderSelectedMultiCheckSearch({commaList:f,fieldName:a,dispList:g,displayField:h,dispListFld:b});e="#"+
a+"-"+e.replace(/\s/g,"")+"-typeahead";c(e).attr("style",null);this.model.set(a,f);this.model.set(b,g);this.adjustDD(a)},setMCSFocus:function(a){c(a.target).hasClass("ui-input-search")&&c(a.target).find("input").focus()},changeItem:function(a){var b=a.target,e={};a=b.id;var f=b.value,h=null,g=c("#"+a).hasClass("datetimepicker")?!0:!1,k=c("#"+a).hasClass("timepicker")?!0:!1,l=c("#"+a).hasClass("datepicker")?!0:!1;if("date"==b.type)f=b.value.split("-"),g=parseInt(f[0]),k=parseInt(f[1])-1,h=parseInt(f[2]),
b=f=0,this.model.get(a),f=new Date(g,k,h,f,b),f=c.getGMTTimeFromLocal(f.getTime()),e[a]=f.getTime(),this.model.set(e);else if(g||l)e[a]=(new Date(b.value)).getTime(),this.model.set(e),c("#"+a).attr("value",b.value),d.isUndefined(this.options.postChange)||this.options.postChange(this,a,f);else if(k){h=new Date;b=b.value.split(":");f=parseInt(b[0]);g=b[1].split(" ");b=parseInt(g[0]);if(1<g.length&&(g=g[1],("pm"==g||"PM"==g)&&12>f))f+=12;g=h.getFullYear();k=h.getMonth();h=h.getDate();f=new Date(g,k,
h,f,b);e[a]=f.getTime();this.model.set(e)}else"checkbox"==b.type&&(d.isUndefined(c(b).attr("multicheckbox"))?""==b.value?f=b.value="true":"true"==b.value?f=b.value="false":"false"==b.value&&(f=b.value="true"):(f=b.getAttribute("name"),a=b.getAttribute("fldname"),f=this.updateCommaDelimitedVal({fieldValue:f,fieldName:a}),g=b.getAttribute("displayField"),k=b.getAttribute("displayVal"),k=this.updateCommaDelimitedVal({fieldValue:k,fieldName:g}),l={},l[g]=k,this.model.set(l))),"radio"==b.type&&(f=b.getAttribute("name"),
a=b.getAttribute("fldname"),h=b.getAttribute("hasPickMap"),c(b).parents("form").find("label").attr("data-icon","radio-off"),c(b).parents("form").find("label").removeClass("ui-radio-on"),c(b).parents("form").find("label").addClass("ui-radio-off"),c(b).parents("form").find("span.ui-icon").removeClass("ui-icon-radio-on"),c(b).parents("form").find("span.ui-icon").addClass("ui-icon-radio-off"),c(b).siblings("label").addClass("ui-radio-on"),c(b).siblings("label").attr("data-icon","radio-off"),c(b).siblings("label").attr("data-icon",
"radio-off").find("span.ui-icon").removeClass("ui-icon-radio-off"),c(b).siblings("label").attr("data-icon","radio-off").find("span.ui-icon").addClass("ui-icon-radio-on")),c.hasVal(h)&&("true"==h||!0==h)?(h=this.radioModels[a].radioList,e=this.radioModels[a].radioPickMaps,b=b.getAttribute("pickedRecordId"),b=h.get(b),rwApp.execPickMap({fromModel:b,pickMap:e,toModel:this.model})):(e[a]=f,this.model.set(e)),d.isUndefined(this.options.postChange)||this.options.postChange(this,a,f)},cancelUpdate:function(){c("#upsertRecord").animate({top:1E3},
500,function(){c(this.el).hide(50);c(".overlay-background").hide();c("#upsertRecord").css("bottom","auto");c("#upsertRecord").css("height","99%");c("#upsertRecord").css("top","100%");c("#upsertRecord").hide()});rwApp.preventNavigation=!1},saveItem:function(){var a=this,b=m.validateRequired(this.model,this.metaApplet);this.model.options.bo=this.metaApplet.bo;this.model.options.bc=this.metaApplet.bc;if(d.isNull(b))c("#upsertRecord").animate({top:1E3},500,function(){c(this.el).hide(50);c(".overlay-background").toggle(0);
c("#upsertRecord").css("bottom","auto");c("#upsertRecord").css("height","99%");c("#upsertRecord").css("top","100%");c("#upsertRecord").hide()}),m.setPostDefaultValues(this.model,this.metaApplet),this.model.save({},{success:function(b,e,g){debugger;d.isUndefined(b.get("powerpartner1"))||(rwFB.powerpartner1=b.get("powerpartner1"));var k=b.id;if(c.hasVal(a.refreshFunction))a.refreshFunction(b,a);else if(c.hasVal(a.refreshFunctionStatic))eval(a.refreshFunctionStatic);else if(!d.isUndefined(a.parentView)&&
!d.isNull(a.parentView))k=c.hasVal(a.parentView.options.refreshModelView)?a.parentView.options.refreshModelView.model.get("id"):k,k=a.parentView.options.route+"/"+k,n.history.fragment==k&&(n.history.fragment=null),rwApp.navigate(k,{trigger:!0,replace:!0});else if(!d.isUndefined(a.options.showConfirmOnSave)&&!d.isNull(a.options.showConfirmOnSave)){var l=c("#PopupContainer");l.html(d.template(a.options.showConfirmOnSave)());l.addClass("confirmation");c(".overlay-background").show();l.show();l.one("click",
"[popEvent]",function(){l.hide();c(".overlay-background").hide()})}if(!d.isUndefined(a.success)){debugger;a.success(b,e,g)}},error:function(b,c,e){d.isUndefined(a.error)||a.error(b,c,e)},done:function(){rwApp.preventNavigation=!1}});else if(!d.isUndefined(a.error)){var e={};e.responseText=b;e.status=99999;a.error(null,e,null)}},saveRecordPhone:function(){rwApp.upsPhone(upModel,refreshRoute,routeIdField,confirmTemplate,this)},createRecord:function(a){rwApp.upsertRecord({el:"#upsertRecord",appletName:a,
upsertTemplate:"upsertForm",upsertModel:"",parentView:this.parentView,refreshFunction:function(a){rwApp.refreshAndSelect(a)},success:null})},editRecord:function(a){var b=c.hasVal(this.options.upsertTemplate)?this.options.upsertTemplate:"upsertForm";c.hasVal(this.parentView)&&(c.hasVal(this.parentView.options.fixRecordApplet)&&a==this.parentView.options.fixRecordApplet)&&(b="UpsertFormNarrow");rwApp.upsertRecord({el:"#upsertRecord",appletName:a,upsertTemplate:b,upsertModel:this.model,parentView:this.parentView,
refreshFunctionStatic:this.refreshFunctionStatic,refreshFunction:this.refreshFunction,success:null})},close:function(){c(this.el).unbind();c(this.el).empty();return that}});j.ListItemView=n.View.extend({actor:"",tagName:"li",applet:"",htmlTemplate:"",template:"",metaApplet:null,initialize:function(a){this.applet=a.applet;this.listItemClass=a.listItemClass;this.htmlTemplate=a.template;this.metaApplet=d.isFunction(this.htmlTemplate)?new m.AppletView({applet:this.applet,template:"StdList"}):new m.AppletView({applet:this.applet,
template:this.htmlTemplate});this.actor=this.metaApplet.actor;this.bc=this.metaApplet.bc;this.bo=this.metaApplet.bo;this.options=a;this.template=this.metaApplet.render().el},render:function(a){var b=this.template;void 0!=a&&(this.model=a);d.isFunction(this.htmlTemplate)&&(c.hasVal(this.options.clickRoute)&&(this.model.clickRoute=this.options.clickRoute),a=this.htmlTemplate(this.model),this.metaApplet=new m.AppletView({applet:this.applet,template:a}),b=this.metaApplet.render().el);c(this.el).html(m.recordBinder(b,
this.model));c(this.el).addClass(this.listItemClass);c(this.el).attr("id",this.model.get("id"));c.hasVal(this.options.customRowAttr)&&c(this.el).attr(this.options.customRowAttr.attrName,this.options.customRowAttr.attrVal);c.hasVal(this.options.setFilter)&&this.options.setFilter&&(a=c.getHiddenListFilters(this.metaApplet.model.attributes.field,this.model),c.hasVal(a)&&c(this.el).attr("data-filtertext",a));return this}});j.MultiColumnListView=n.View.extend({options:"",applet:null,actor:"",initialize:function(a){this.options=
a;this.applet=new m.RepoObjectModel({type:"Applet",name:this.options.applet});this.actor=this.applet.get("actor")},render:function(a){d.isUndefined(a)?a=this.model:this.model=a;c(this.el).html(d.template(this.options.template,{cc:a,applet:this.applet,fieldRenderer:m.fieldRenderer,recordBinder:m.recordBinder,_:d}));return this}});j.ListView=n.View.extend({actor:"",searchSpec:"",tagName:"ul",id:Math.random().toString(36).substr(2,16),params:"",applet:"",listItem:null,setFilter:!0,noRecordsMsg:"No records!",
listItemClass:"rw_listitem",backupModel:null,initialize:function(a){this.htmlTemplate=!d.isUndefined(a.template)&&!d.isNull(a.template)?a.template:a.templateHTML;this.applet=a.applet;!d.isUndefined(a.filter)&&!d.isNull(a.filter)&&(this.setFilter=a.filter);!d.isUndefined(a.noRecordsMsg)&&!d.isNull(a.noRecordsMsg)&&(this.noRecordsMsg=a.noRecordsMsg);!d.isUndefined(a.listItemClass)&&!d.isNull(a.listItemClass)&&(this.listItemClass=a.listItemClass);this.listItem=new j.ListItemView({applet:this.applet,
setFilter:this.setFilter,template:this.htmlTemplate,listItemClass:this.listItemClass,customRowAttr:this.customRowAttr,clickRoute:this.clickRoute});this.actor=this.listItem.actor;this.bc=this.listItem.bc;this.bo=this.listItem.bo;this.searchSpec=this.listItem.metaApplet.model.get("searchSpec");this.sortBy=this.listItem.metaApplet.model.get("sortBy");this.sortDir=this.listItem.metaApplet.model.get("sortDir");this.pageNumber=1;this.class=a.class;this.params=a;this.parentView=a.parentView;this.numCharsToTriggerSearch=
a.listMap?0:2;this.batchSize=c.hasVal(a.batchSize)?a.batchSize:2;this.nextHandlerState=!1;this.ulClass=a.ulClass;this.fillRemainder=a.fillRemainder},events:{"click .rw_listitem":"pick","click .pickPhoneContact":"pickPhoneContact","click #cancelPick":"cancelPick","click #pickCreate":"pickCreate","click #showNextRecords":"showNextRecords","click #showPreviousRecords":"showPreviousRecords",scroll:"refreshList"},reDraw:function(a){if(0<a.models.length){a=d.clone(a);d.isUndefined(this.modelClone)&&(this.modelClone=
d.clone(this.model));this.modelClone.models=[];var b=this.batchSize,e=this.selector,f=c.hasVal(this.params.usePaging&&this.model.models.length>=rwcore.pagingSize)?!0:!1;j.renderSet({models:a.models,setSize:b,selector:e,el:this.el,template:this.htmlTemplate,applet:this.applet,listItemClass:this.listItemClass,showMore:f,pageNumber:this.pageNumber,lastCategory:c(e).attr("lastCategory"),fillRemainder:!0,clickRoute:this.clickRoute})}},refreshList:function(){d.isUndefined(this.modelClone)||(this.modelClone.models.length>
this.batchSize?(this.modelClone.models=d.rest(this.modelClone.models,this.batchSize),this.reDraw(this.modelClone)):c(this.selector).listview("refresh"))},reDrawOld:function(a){var b=this;if(0<a.models.length){var e,f=b.listItem.metaApplet.model.get("dividerField"),h=b.listItem.metaApplet.model.get("divideWithWholeWord"),g=b.listItem.metaApplet.model.get("divideTemplateClass"),k=c.hasVal(this.options.ulClass)?"#"+b.id+"."+this.options.ulClass:"#"+b.id;d.each(a.models,function(a){if(!d.isUndefined(f)&&
!d.isNull(f)&&""!=f)if(!d.isUndefined(h)&&!d.isNull(h)&&!0==h)var j=a.get(f);else j=a.get(f),j=c.hasVal(j)?j.substr(0,1).toUpperCase():"...";if((d.isUndefined(e)||d.isNull(e)||j!=e)&&!d.isUndefined(j)&&!d.isNull(j)&&""!=j){var q="."+g,q=c(d.template("Snippets")()).find(q).html(j);c(k).append(q);e=j}a=b.listItem.render(a).el;c(k).append(a.outerHTML)},b);c(k).listview("refresh");b.pageNumber++}},scrollHandler:function(a){var b="#"+a.data.id;d.isUndefined(a.data.ulClass)||(b+="."+a.data.ulClass);var b=
c(b),e=b.scrollTop(),f=b.height();b.prop("scrollHeight")-e<f+5&&(c(".fetchingPane").show(),a.data.nextHandlerState||(rwcore.spinOn({top:b.position().top+f/2,left:b.position().left+b.width()/2}),a.data.nextHandlerState=!0,c.when(a.data.showNextRecords(a)).done(function(){c(".fetchingPane").hide();a.data.nextHandlerState=!1;rwcore.spinOff({mode:"custom"})}).fail(function(){a.data.nextHandlerState=!1;rwcore.spinOff({mode:"custom"})})))},showNextRecords:function(){var a=c.Deferred();c("#showNextRecords").find("h3").html("Fetching");
var b=this,e=new rwcore.StandardCollection(b.model.options);e.options.skip=b.model.models.length;e.dataout={data:JSON.stringify(e.options)};e.fetch({add:!0,async:!1,error:rwApp.showError,success:function(e){c("#nextRecordsListItem").remove();var h=new n.Collection;d.each(e.models,function(a){d.isUndefined(b.model.get(a.id))&&(b.model.add(a,{silent:!0}),h.add(a,{silent:!0}))});0<h.length&&(b.reDraw(h),b.pageNumber++);a.resolve()}});return a},showPreviousRecords:function(){this.pageNumber--},pickPhoneContact:function(a){if(c.hasVal(rwApp.newReferralData)){var b=
a.target,e=c(b).get(0).nodeName.toLowerCase();a=c(b).attr("id");if("a"!=e){var d=c(b).parents("a");a=d.attr("id")}d=d.find("h3").html();rwApp.newReferralData.contactId=a;rwApp.newReferralData.contactName=d;rwApp.navigate("createReferral2/"+rwApp.newReferralData.toPartyId,{trigger:!0,replace:!0})}},cancelPick:function(){c("#pickBackground").hide(50);c("#picklistContainer").hide(350)},setModel:function(a){var b=this;d.isUndefined(b.params.clientSideSortAttr)||(a.models=d.sortBy(a.models,function(a){return a.get(b.params.clientSideSortAttr)}));
!d.isUndefined(b.params.clientSideSortDirection)&&"DESC"==b.params.clientSideSortDirection&&a.models.reverse();this.model=a},pickCreate:function(a,b){var e=new j.FormView({applet:a,templateHTML:b,error:rwcore.showError});e.setDefaultModel();c("#pickCreateMode").html(e.render().el).trigger("create");c("#pickCreateMode").show(0);c("#pickCreateMode").animate({left:5},500,function(){});c("#pickMode").animate({left:-500},500,function(){c("#pickMode").hide()});return e},pick:function(a){if(d.isUndefined(this.params.ignorePick)){a=
a.target;var b=c(a).get(0).nodeName.toLowerCase(),e=c(a).attr("id");"a"!=b&&(e=c(a).parents("a").attr("id"));a=this.model.get(e);this.execPickMap(a)}},execPickMap:function(a){rwApp.execPickMap({fromModel:a,pickMap:this.params.pickMap,toModel:this.params.parentView.model,form:this.params.parentView})},render:function(a){var b=!d.isUndefined(this.ulClass)?"#"+this.id+"."+this.ulClass:"#"+this.id;c(b).html("");var e=this;void 0==a?a=e.model:d.isUndefined(e.params.clientSideSortAttr)?e.model=a:(a=d.sortBy(a.models,
function(a){return a.get(e.params.clientSideSortAttr)}),this.model.models=a,!d.isUndefined(e.params.clientSideSortDirection)&&"DESC"==e.params.clientSideSortDirection&&this.model.models.reverse());a="t"+(new Date).getTime();this.selector=c.hasVal(this.options.ulClass)?"#"+e.id+"."+this.options.ulClass+"."+a:"#"+e.id+"."+a;this.selector+=":visible";this.clickRoute=!d.isUndefined(this.clickRoute)?this.clickRoute:!d.isUndefined(this.params.clickRoute)?this.params.clickRoute:n.history.fragment;c(e.el).attr("data-role",
"listview");c.hasVal(this.options.ulClass)&&c(e.el).addClass(this.options.ulClass);c(e.el).addClass(a);0<e.model.models.length?(this.modelClone=d.clone(e.model),this.backupModel=d.clone(e.model),a=this.batchSize,b=c.hasVal(e.params.usePaging&&e.model.models.length>=rwcore.pagingSize)?!0:!1,j.renderSet({models:this.modelClone.models,setSize:a,selector:e.el,template:this.htmlTemplate,applet:this.applet,listItemClass:this.listItemClass,totalRecords:e.model.models.length,showMore:b,pageNumber:e.pageNumber,
initial:!0,ulClass:this.options.ulClass,fillRemainder:!d.isUndefined(e.fillRemainder)?e.fillRemainder:!1,clickRoute:this.clickRoute})):"hidden"==e.noRecordsMsg?c(e.el).addClass("hidden"):(a="<li class='noRecordsMsg'><h3 style='font-style:italic'>"+e.noRecordsMsg+"</h3></li>",c(e.el).append(a));c(e.el).attr("data-theme","c");this.setFilter&&(c(e.el).attr("data-filter","true"),c(e.el).attr("data-filter-placeholder","Keyword search (case sensitive)"));return e},renderOld:function(a){var b=this,e="nothing",
f=!1;c.hasVal(b)&&c.hasVal(b.model)&&c.hasVal(b.model.options)&&(e="listHTML_"+b.model.options.module+rwFB.uId,c.hasVal(window.rwObjectCache)&&c.hasVal(window.rwObjectCache[b.model.options.module+"_useCache"]),f=b.model.options.cacheOptimize);void 0==a?a=b.model:d.isUndefined(b.params.clientSideSortAttr)?b.model=a:(a=d.sortBy(a.models,function(a){return a.get(b.params.clientSideSortAttr)}),this.model.models=a,!d.isUndefined(b.params.clientSideSortDirection)&&"DESC"==b.params.clientSideSortDirection&&
this.model.models.reverse());b.backupModel=d.clone(b.model);if(0<b.model.models.length){var h,g=b.listItem.metaApplet.model.get("dividerField"),k=b.listItem.metaApplet.model.get("divideWithWholeWord"),l=b.listItem.metaApplet.model.get("divideTemplateClass");d.each(b.model.models,function(a){if(!d.isUndefined(g)&&!d.isNull(g)&&""!=g)if(!d.isUndefined(k)&&!d.isNull(k)&&!0==k)var e=a.get(g);else e=a.get(g),e=c.hasVal(e)?e.substr(0,1).toUpperCase():"...";if((d.isUndefined(h)||d.isNull(h)||e!=h)&&!d.isUndefined(e)&&
!d.isNull(e)&&""!=e){var f="."+l,f=c(d.template("Snippets")()).find(f).html(e);c(b.el).append(f);h=e}a=b.listItem.render(a).el;c(b.el).append(a.outerHTML)},b)}else a="<li class='noRecordsMsg'><h3 style='font-style:italic'>"+b.noRecordsMsg+"</h3></li>",c(b.el).append(a);c(b.el).attr("data-role","listview");c.hasVal(this.options.ulClass)&&c(b.el).addClass(this.options.ulClass);this.setFilter&&(c(b.el).attr("data-filter","true"),c(b.el).attr("data-filter-placeholder","Keyword search..."));c.hasVal(f)&&
(f=c(b.el).html(),c(b.el).html(f).trigger("create"),localStorage.setItem(e,c(b.el).html()));return b},selectItem:function(a){d.isUndefined(c("#"+a)[0])||(a="LI"==c("#"+a)[0].nodeName?c("#"+a):c("#"+a).parents("li"),a.siblings().removeClass("ui-btn-active"),a.addClass("ui-btn-active"))},textSearchHandler:function(a,b){var e=c(this),d=c(b.input).val();d&&d.length>a.data.numCharsToTriggerSearch&&(e.html(""),e.listview("refresh"),a.data.model.options.searchText=d,a.data.model.reset(),a.data.pageNumber=
1,a.data.showNextRecords(a),a.data.options.listMap&&a.data.parentView.renderListMap());0==d.length&&(a.data.model.options.searchText=void 0,a.data.model.reset(),a.data.pageNumber=1,rwApp.fetchList(a.data.model.options).done(function(b){e.html("");e.listview("refresh");a.data.model=b;a.data.reDraw(b);a.data.options.listMap&&a.data.parentView.renderListMap()}))}});j.RadioList=j.ListView.extend({tagName:"fieldset",events:{"click .rw_listitem":"pick","click #cancelPick":"cancelPick","click [radiolabel]":"select"},
select:function(a){a=c(a.target).parents("[radiolabel]").attr("for");var b={dview:this.options.updateview,setFieldMap:{contactLNId:a}};rwApp.showLinkedInProfile(a);rwApp.updateKeyFieldSilent(b)},render:function(a){void 0==a?a=this.model:this.model=a;var b=this;0<b.model.models.length?d.each(b.model.models,function(a){a=b.listItem.render(a).el;c(b.el).append(a.innerHTML)},b):(a="<h3 style='font-style:italic' class='noRecordsMsg'>"+b.noRecordsMsg+"</h3>",c(b.el).append(a));c(b.el).attr("data-role",
"controlgroup");!d.isUndefined(this.options.lnId)&&!d.isNull(this.options.lnId)&&""!=this.options.lnId?c(b.el).children("#"+this.options.lnId).attr("checked","checked"):c(b.el).children("fieldset input:first-child").attr("checked","checked");return b}});j.AssociationView=j.ListView.extend({events:{},cancelUpdate:function(){c("#upsertRecord").animate({top:1E3},500,function(){c(this.el).hide(50);c(".overlay-background").toggle(0);c("#upsertRecord").css("bottom","auto");c("#upsertRecord").css("height",
"99%");c("#upsertRecord").css("top","100%");c("#upsertRecord").hide();rwApp.refreshTopView(!1)});rwApp.preventNavigation=!1},removeAssociation:function(a){var b=null,b="LI"!=a.target.nodeName?c(a.target).parents("li"):c(a.target);a=b.attr("key");this.model.remove(this.model.get(this.cartIndex[a]));this.refresh(!0)},addAssociation:function(a){var b=null,b="LI"!=a.target.nodeName?c(a.target).parents("li"):c(a.target);a=b.attr("id");a=this.listModel.get(a);var e=new rwcore.StandardModel({module:this.model.options.module});
new m.AppletView({applet:this.applet});m.setDefaultValues(e,this.toMetaApplet,null);var d={};for(item in this.associationMap)d[item]=a.get(this.associationMap[item]);e.set(d);this.model.add(e);this.refresh(!1);b.hide()},refresh:function(a){c("#leftTitle").html(this.leftTitle);c("#rightTitle").html(this.rightTitle);var b=this.renderList({model:this.model,listItemView:this.toListItem,cartAction:"build",cartKey:this.toCartKey,clientSideSortAttr:this.toClientSideSortAttr});a&&(a=this.renderList({model:this.listModel,
listItemView:this.listItem,cartAction:"filter",cartKey:this.cartKey}),c("#assocFrame").html(a[0]).trigger("create"));c("#cartFrame").html(b[0]).trigger("create")},render:function(a){options=this.params;var b=this;this.assocMetaApplet=new m.AppletView({applet:this.applet});this.cartKey=this.assocMetaApplet.model.get("assocKeyField");this.leftTitle=this.assocMetaApplet.model.get("pluralTitle");this.toApplet=options.assocOptions.toApplet;this.toMetaApplet=new m.AppletView({applet:this.toApplet});this.toCartKey=
this.toMetaApplet.model.get("assocKeyField");this.rightTitle=this.toMetaApplet.model.get("pluralTitle");this.toSetFilter=options.assocOptions.toSetFilter;this.toHtmlTemplate=options.assocOptions.toHtmlTemplate;this.toClientSideSortAttr=this.toMetaApplet.model.get("sortBy");this.toListItemClass="cartItem";this.toListItem=new j.ListItemView({applet:this.toApplet,setFilter:this.toSetFilter,template:this.toHtmlTemplate,listItemClass:this.toListItemClass,customRowAttr:options.assocOptions.toCustomRowAttr});
this.listItem.listItemClass="assoc";this.associationMap=options.assocOptions.associationMap;var e={module:this.actor,searchSpec:this.searchSpec,sortby:this.sortby,sortOrder:d.isUndefined(options.sortOrder)?"ASC":options.sortOrder};if(!d.isUndefined(options.detailSearchSpec))for(var f=Object.keys(options.detailSearchSpec),h=0;h<f.length;h++){var g=f[h],k=options.detailSearchSpec[f[h]];c.hasVal(options.parentKeyField)&&options.parentKeyField==k&&(k=model.get(k));e[g]=k}(new rwcore.StandardCollection(e)).fetch({error:rwcore.showError,
success:function(c){b.listModel=c;"renderContainer"==a&&b.renderContainer();"refresh"==a&&b.refresh(!0)}})},renderContainer:function(){var a=this.parentView.options.viewTitle,b=this.parentView.options.dynamicTitles,e=this.renderList({model:this.model,listItemView:this.toListItem,cartAction:"build",cartKey:this.toCartKey,clientSideSortAttr:this.toClientSideSortAttr}),f=this.renderList({model:this.listModel,listItemView:this.listItem,cartAction:"filter",cartKey:this.cartKey}),h=ReferralWire.getTemplate("Templates/Patterns/WizardAssocSnippet.html"),
e=d.template(h,{fromListHTML:f[0].outerHTML,toListHTML:e[0].outerHTML,_:d}),a=c.hasVal(a)?a:c.hasVal(b)?b:"",a=d.template(this.parentView.viewTemplate,{firstAppletHTML:e,title:a,stations:this.parentView.stations,_:d});this.parentView.$el.html(a);c(this.parentView.container).html(this.parentView.$el).trigger("create");c("#leftTitle").html(this.leftTitle);c("#rightTitle").html(this.rightTitle);this.parentView.showView()},renderList:function(a){var b=a.model,e=a.cartKey,f=a.cartAction,h="";that=this;
var g=a.listItemView,k=a.clientSideSortAttr;c(that.el).attr("data-role","listview");c.hasVal(this.options.ulClass)&&c(that.el).addClass(this.options.ulClass);this.setFilter&&(c(that.el).attr("data-filter","true"),c(that.el).attr("data-filter-placeholder","Keyword search..."));d.isUndefined(k)||(a=d.sortBy(b.models,function(a){return a.get(k)}),b.models=a);"build"==f&&(this.cartIndex={});if(0<b.models.length){var l,j=g.metaApplet.model.get("dividerField"),q=g.metaApplet.model.get("divideWithWholeWord"),
p=g.metaApplet.model.get("divideTemplateClass");d.each(b.models,function(a){a.get("id");var b=a.get(e),h=a.cid;"build"==f&&(this.cartIndex[b]=h);if("filter"==f&&!c.hasVal(that.cartIndex[b])||"filter"!=f){if(!d.isUndefined(j)&&!d.isNull(j)&&""!=j)if(!d.isUndefined(q)&&!d.isNull(q)&&!0==q)var k=a.get(j);else k=a.get(j),k=c.hasVal(k)?k.substr(0,1).toUpperCase():"...";if((d.isUndefined(l)||d.isNull(l)||k!=l)&&!d.isUndefined(k)&&!d.isNull(k)&&""!=k)h="."+p,h=c(d.template("Snippets")()).find(h).html(k),
c(that.el).append(h),l=k;a=g.render(a).el;c(a).attr("key",b);c(that.el).append(a.outerHTML)}},that)}else a="<li class='noRecordsMsg'><h3 style='font-style:italic'>"+that.noRecordsMsg+"</h3></li>",c(that.el).append(a);c.hasVal(that.params.usePaging&&b.models.length>=rwcore.pagingSize)&&(b="<li id='nextRecordsListItem'><a id='showNextRecords' currentPage="+that.pageNumber+"><h3 style='font-style:italic'>Show More</h3></a></li>",c(that.el).append(b));h=c(that.el).clone();c(that.el).empty();return h}});
j.TableChartView=n.View.extend({tagName:"div",id:Math.random().toString(36).substr(2,16),params:"",applet:"",noRecordsMsg:"No records!",initialize:function(a){this.htmlTemplate=c.hasVal(a.template)?a.template:a.templateHTML;this.applet=a.applet;!d.isUndefined(a.noRecordsMsg)&&!d.isNull(a.noRecordsMsg)&&(this.noRecordsMsg=a.noRecordsMsg);this.metaApplet=new m.AppletView({applet:this.applet,template:this.htmlTemplate,showViewBar:!1});this.actor=this.metaApplet.actor;this.bc=this.metaApplet.bc;this.bo=
this.metaApplet.bo;this.parentView=a.parentView;this.searchSpec=this.metaApplet.model.get("searchSpec");this.sortBy=this.metaApplet.model.get("sortBy");this.sortDir=this.metaApplet.model.get("sortDir")},setModel:function(a){this.model=a},render:function(){that=this;this.tagName="div";var a=c.tableTransform(that.model.models,"fullName","datetime"),b="";c.hasVal(a.colIndex)&&0<a.colIndex.length&&(b=d.template(this.htmlTemplate,{indexes:a,data:that.model}));c(that.el).html(b);return that}});j.BasicChartView=
n.View.extend({tagName:"div",id:Math.random().toString(36).substr(2,16),params:"",applet:"",noRecordsMsg:"No records!",initialize:function(a){this.htmlTemplate=c.hasVal(a.template)?a.template:a.templateHTML;this.transformOptions=a.transformOptions;this.applet=a.applet;!d.isUndefined(a.noRecordsMsg)&&!d.isNull(a.noRecordsMsg)&&(this.noRecordsMsg=a.noRecordsMsg);this.metaApplet=new m.AppletView({applet:this.applet,template:this.htmlTemplate,showViewBar:!1});this.actor=this.metaApplet.actor;this.bc=
this.metaApplet.bc;this.bo=this.metaApplet.bo;this.parentView=a.parentView;this.searchSpec=this.metaApplet.model.get("searchSpec");this.sortBy=this.metaApplet.model.get("sortBy");this.sortDir=this.metaApplet.model.get("sortDir")},setModel:function(a){this.model=a},render:function(){that=this;this.tagName="div";this.chartData=this.transformOptions.transformFunction(that.model.models,this.transformOptions);c(that.el).html("");return that}});j.ReferralMgmtListView=j.ListView.extend({events:{"click #acceptOrIngore":"updateItem"},
toggleCollapse:function(a){var b=a.target,e=c(b).get(0).nodeName.toLowerCase(),f=c(b).attr("toggleCID"),h=d.isUndefined(a.expandDuration)?500:a.expandDuration;if("td"!=e)var g=c(b).parents("[toggleState]"),f=g.attr("toggleCID");var k=g.attr("statecell"),l=g.attr("toggleState"),b=g.attr("referralStatus"),j=!1;!d.isUndefined(g.attr("inboxToggle"))&&!d.isNull(g.attr("inboxToggle"))&&(j=!0);e=!1;!d.isUndefined(g.attr("recommendToggle"))&&!d.isNull(g.attr("recommendToggle"))&&(e=!0);var f=f+"_details",
q=this.model.get(k),p=!d.isUndefined(q)?q.get("from_fullName"):"",n=!d.isUndefined(q)?q.get("referralType"):g.attr("referralType");"PART_FOR_PART"==n&&("WAITING"==b&&!d.isUndefined(q))&&(b=q.get("waitingForId")==rwFB.uId?"UNREAD":b);var x=a.containerEL;if(d.isUndefined(x)||d.isNull(x))x="homePage";if("collapsed"==l)if("UNREAD"==b&&j){var r=c("#PopupContainer");that=this;h=d.template("PART_FOR_PART"==n||"PART_INVITE"==n?"AcceptInvitationConfirmation":"AcceptReferralConfirmation")();d.isUndefined(p)||
(h=h.replace(/ZfromFullName/g,p));r.html(h);r.addClass("confirmation");c(".overlay-background").show();r.show();r.delegate("[popEvent]","click",function(){that.updateItem({eventId:this.id,sModelId:k,pageContainer:x,popup:r,fromName:p});r.undelegate("[popEvent]","click")});r.delegate("[confirmevent]","click",function(a){a.popUpContainer=r;rwApp.confirmationDialogResponse(a)})}else a=g.attr("detailSnippetId"),c.hasVal(a)&&(l=d.template("Snippets")(),a=c(l).find("#"+a).html(),l=document.implementation.createHTMLDocument("refDetails").createElement("div"),
l.innerHTML=a,q=m.recordBinder(l,q),c("[objid="+k+"_details]").html(q)),c("#"+f).show(h,function(){g.toggleClass("expanded");g.attr("toggleState","expanded")}),"UNREAD"==b&&e&&(g.toggleClass("expanded"),rwApp.updateKeyFieldSilent({dview:this,actionRecordId:k,setFieldMap:{status:"PENDING"}}));else g.attr("toggleState","collapsed"),g.toggleClass("expanded"),c("#"+f).hide(500)},updateItem:function(a){if("cancelPick"==a.eventId)c("#PopupContainer").hide(),c("#PopupContainer").removeClass("confirmation"),
c(".overlay-background").hide();else{var b=this.model.get(a.sModelId),e=b.get("referralType"),d=b.get("status");"archiveReferral"==a.eventId?b.set("archiveFlag","true"):"UNREAD"==d&&"PART_FOR_PART"==e?(b.set("status","WAITING"),e=b.get("toId"),d=b.get("toId2"),e==rwFB.uId&&b.set("waitingForId",d),d==rwFB.uId&&b.set("waitingForId",e)):"WAITING"==d&&"PART_FOR_PART"==e?b.get("waitingForId")==rwFB.uId&&b.set("status","ACCEPTED"):"UNREAD"==d&&b.set("status","ACCEPTED");c("#PopupContainer").hide();c("#PopupContainer").removeClass("confirmation");
c(".overlay-background").hide();var h=this;b.save({},{success:function(){if("homePage"==a.pageContainer){var b=c('div [applet="ReferralNewsFeed"]');h.parentView.renderSection(b)}else c(a.pageContainer).html(h.render().el.outerHTML).trigger("create")},error:function(){rwcore.FYI("save error")},done:function(){a.popup.undelegate("[popEvent]","click")}})}},render:function(a){if(c.hasVal(a)&&c.hasVal(a.renderTo))this.renderOptimized(a);else return this.renderLegacy(a)},renderLegacy:function(a){void 0==
a?a=this.model:this.model=a;var b=this;c(b.el).empty();0<b.model.models.length?d.each(b.model.models,function(a){var f=!d.isFunction(this.htmlTemplate)&&-1<this.htmlTemplate.indexOf("rwApp.")?eval(this.htmlTemplate)(a):this.htmlTemplate;this.listItem=new j.ListItemView({applet:this.applet,template:f,listItemClass:this.listItemClass,clickRoute:this.clickRoute});a=b.listItem.render(a).el;c(b.el).append(a.outerHTML)},b):(a="<li class='noRecordsMsg'><h3 style='font-style:italic'>"+b.noRecordsMsg+"</h3></li>",
c(b.el).append(a));c(b.el).attr("data-role","listview");c(b.el).attr("appletUL",this.options.applet);this.setFilter&&(c(b.el).attr("data-filter","true"),c(b.el).attr("data-filter-placeholder","Keyword search..."));c(b.el).find('[referralFlag="UNREAD"]').children("img").css("display","initial");c(b.el).find('[flagLabel="UNREAD"]').html("Unread");c(b.el).find('[toggleAction="UNREAD"] [inboxToggle]').html("Accept?");c(b.el).find('[inboxDetailNode="UNREAD"]').empty();c(b.el).find('[inboxDetailNode="UNREAD"]').remove();
c(b.el).find('[inboxDetailNode="IGNORED"]').parent().hide();return b},renderOptimized:function(a){void 0==a?a=this.model:this.model=a;var b=this;if(0<b.model.models.length){c(b.el).attr("data-role","listview");c(b.el).attr("appletUL",this.options.applet);this.setFilter&&(c(b.el).attr("data-filter","true"),c(b.el).attr("data-filter-placeholder","Keyword search..."));var e=b.el,f=n.history.fragment.split("/")[0],h=c.Deferred(),e=j.renderSet({models:b.model.models,setSize:4,selector:e,template:b.htmlTemplate,
applet:b.applet,listItemClass:b.listItemClass,clickRoute:f,fillRemainder:!0,ulClass:this.options.ulClass,async:!0,promise:h}),e=d.isObject(e)?e.outerHTML:b.el.outerHTML;a.renderTo.html(e).trigger("create");h.done(function(){return b})}else return h="<li class='noRecordsMsg'><h3 style='font-style:italic'>"+b.noRecordsMsg+"</h3></li>",c(b.el).append(h),a.renderTo.html(b.el.outerHTML).trigger("create"),b}});j.addSeparator=function(a,b,e,f){var h=b.model.get("dividerField"),g=b.model.get("divideWithWholeWord");
b=b.model.get("divideTemplateClass");if(!d.isUndefined(h)&&!d.isNull(h)&&""!=h)if(!d.isUndefined(g)&&!d.isNull(g)&&!0==g)var k=f.get(h);else k=f.get(h),k=c.hasVal(k)?k.substr(0,1).toUpperCase():"...";if((d.isUndefined(e)||d.isNull(e)||k!=e)&&!d.isUndefined(k)&&!d.isNull(k)&&""!=k)e=c(d.template("Snippets")()).find("."+b).html(k),c(a).append(e),e=k;return e};j.renderSet=function(a){var b=a.models,e=!d.isUndefined(a.setSize)?a.setSize:4,f=a.selector,h=a.template,g=a.applet,k=a.listItemClass,l=a.clickRoute,
m=e,q=!d.isUndefined(a.fillRemainder)?a.fillRemainder:!0,p=n.history.fragment,A=p.split("/")[0],x=a.promise;p!=l&&A!=l&&(q=!1);b.length<=e&&(m=b.length,c.hasVal(a.showMore));var r=a.lastCategory;that=this;for(p=0;p<m;p++){A=b[p];if(d.isFunction(h)||-1<h.indexOf("rwApp.")){var w=eval(h);A.clickRoute=!d.isUndefined(l)?l.split("/")[0]:"undefined";w=w(A)}else w=h;var w=new j.ListItemView({applet:g,template:w,listItemClass:k,clickRoute:l}),B=w.render(A).el,r=j.addSeparator(f,w.metaApplet,r,A);c(f).append(B.outerHTML)}d.isObject(f)&&
a.async?(p=c(f).attr("id"),p=c.hasVal(a.ulClass)?"#"+p+"."+a.ulClass:"#"+p,0<c(p).parent().length&&(c(p).listview("refresh"),console.log("changing to string"),f=p)):0<c(f).parent().length&&c(f).listview("refresh");q&&b.length>m?(b=d.rest(b,m),c.hasVal(a.async)?setTimeout(function(){j.renderSet({models:b,setSize:e,selector:f,template:h,applet:g,listItemClass:k,lastCategory:r,showMore:a.showMore,initial:!0,fillRemainder:!0,clickRoute:l,promise:x,async:a.async})},10):j.renderSet({models:b,setSize:e,
selector:f,template:h,applet:g,listItemClass:k,lastCategory:r,showMore:a.showMore,initial:!0,fillRemainder:!0,clickRoute:l})):(c(f).attr("lastCategory",r),d.isUndefined(x)||x.resolve(f));return f};j.ListDetailView=n.View.extend({viewBarDiv:".rw_ViewBar",menuDiv:".rw_appletMenu",events:{"click .rw_listitem":"handleSelect","change select":function(a){rwcore.spinOn();this.options.detailview.changeItem(a);rwcore.spinOff()},"change input":function(a){this.options.detailview.changeItem(a)},"change textarea":function(a){this.options.detailview.changeItem(a)},
"click #save":function(){this.options.detailview.saveItem(event);event.preventDefault()},"click .savedSearchDisplay":"launchSavedSearch","click .editSearchButton":"showSearchView","click #delete":"deleteItem","click #enrich":"enrichItem","click #new":"newRecord","click #edit":"editRecord","click #editRole":"editRole","click #editSelf":"editSelf","click #refer":"referCustToSelected","click #invite":"invite","click #inmail":"inmail","click #org_announce":"org_announce","click [editSection]":function(){this.options[c(event.target).attr("editSection")].editRecord()},
"click [confirmation='true']":"updateField","click [claimOrArchive]":"claimOrArchive","click [updateStatus='ACCEPTED']":"updatedClaimedStatus","click [updateStatus='CONFIRMED']":"updatedContactedStatus","click [launchshow]":function(a){this.options.detailview.launchshow(a)},"click [nextphoto]":function(a){this.options.detailview.next(a)},"click [prevphoto]":function(a){this.options.detailview.previous(a)},"click [closeslideshow]":function(){c("#slideshowcontainer").hide()},"click #linkedIn":"showLinkedIn",
"click #referralWire":function(){rwApp.refreshTopView(!1)},"click #printprofile":"printProfile","click #printpartner":"printProfile","click #wizardEdit":"wizardEdit","click #publish":"publish","click #org_publish":"OrgPublish","click #LinkedIn":"LinkedIn","click #wizardNew":"wizardNew","click [action = 'import']":function(){rwApp.importContacts("placebo")},"click #showNextRecords":function(){this.options.listview.showNextRecords()},"click #showPreviousRecords":function(){this.options.listview.showPreviousRecords()},
"click #fixRecord":"fixRecord","click .addressbook":"prospectVals","click .addressbook":"prospectVals","click .joinChapter":"joinChapter","click .joinMeeting":"joinMeeting","click .leaveMeeting":"leaveMeeting","click [actionone]":function(a){j.ChildViewContainer.findByCustom("FaceBookFriendsList").actionone(a)},"click [actiontwo]":function(a){j.ChildViewContainer.findByCustom("LinkedInConnectionList").actiontwo(a)},"click #exportCSV":"exportCSV"},initialize:function(a){this.options=a;this.clickRoute=
a.route;this.searchModel=a.ssModel;this.refreshFunction=a.refreshFunction;this.editRefreshFunction=a.editRefreshFunction;!d.isUndefined(this.options.detailview)&&!d.isNull(this.options.detailview)&&(this.options.detailview.parentView=this);!d.isUndefined(this.options.profileLinksView)&&!d.isNull(this.options.profileLinksView)&&(this.options.profileLinksView.parentView=this);!d.isUndefined(this.options.profileChartView)&&!d.isNull(this.options.profileChartView)&&(this.options.profileChartView.parentView=
this)},refreshInPlace:function(a){var b=this.options.listview.params.calculatedFields;if(!d.isUndefined(b))for(var e in b){var f=b[e](a),h={};h[e]=f;a.set(h)}a.clickRoute=this.clickRoute;b=a.get("id");this.options.listview.model.set(a,{remove:!1});a=this.options.listview.listItem.render(a).el;c("li#"+b).replaceWith(a.outerHTML);c(this.options.listview.selector).listview("refresh");c("li#"+b+" a").click()},launchSavedSearch:function(){(new j.SavedSearchPickView({searchGroup:this.options.savedSearch.searchGroup,
parentView:this})).render()},showSearchView:function(){var a=this.options.savedSearch;a.parentView=this;a.searchModel=this.searchModel;a=new j.SearchView(a);a.render();this.searchView=a},applySavedSearch:function(a){var b="",b=""==a.get("searchName")?"Ad Hoc Search":a.get("searchName");this.searchModel=a;c(".savedSearchName").html(b);c("#view-title-suffix").html("");c("#viewTitle").html(b);this.options.listview.model.options.searchModel=this.searchModel;this.options.listview.model.options.searchRequest=
rwApp.parseSavedSearch(a,this.options.savedSearch.searchAppletName);this.options.listview.model.options.searchText=void 0;this.options.listview.model.options.skip=void 0;c(this.options.listview.selector).html("");c(".hasAdvancedSearch .ui-input-search input").attr("value","");var b=rwApp.fetchList(this.options.listview.model.options),e=this;a.get("accessLevel");c(this.options.listview.selector).addClass("fetching");d.isUndefined(this.ChartView)||(d.isUndefined(this.searchModel.get("noChartFilter"))?
(this.ChartView.searchRequest=this.options.listview.model.options.searchRequest,this.ChartView.render()):this.searchModel.set({noChartFilter:void 0}));e=this;b.done(function(a){e.options.listview.model=a;e.options.listview.pageNumber=1;e.options.listview.reDraw(a);c(e.options.listview.selector).removeClass("fetching");e.options.listMap&&e.renderListMap()})},fixRecord:function(){this.options.detailview.editRecord(this.options.fixRecordApplet)},prospectVals:function(){if(-1==(new String(window.location)).indexOf("ReferralWireView.com")){var a=
"#prospectVals/"+this.options.detailview.model.get("id");rwApp.navigate(a,{trigger:!0,replace:!1})}},claimOrArchive:function(){var a=this.options.detailview.model;a.set({protoStatus:"ACCEPTED"});var b=rwApp.getUpdateUnreadReferralWizard();(new j.WizardUpsertView({firstApplet:b.firstApplet,refreshFunction:function(){this.parentView.renderSection(c("#referralInboxView"))},nextAppletFunctions:b.nextAppletFunctions,viewTemplate:b.viewTemplate,upsertmodel:a,stations:b.stations,saveFunction:b.saveFunction,
parentView:this,showConfirmOnSave:b.showConfirmOnSave,wizardSpec:b,wizardViewClass:"noTrain"})).render()},updatedClaimedStatus:function(){var a=this.options.detailview.model;a.set({protoStatus:"CONFIRMED"});var b=rwApp.updateClaimedReferralWizard;(new j.WizardUpsertView({firstApplet:b.firstApplet,refreshFunction:function(){rwApp.refreshTopView()},nextAppletFunctions:b.nextAppletFunctions,viewTemplate:b.viewTemplate,upsertmodel:a,stations:b.stations,saveFunction:b.saveFunction,parentView:this,showConfirmOnSave:b.showConfirmOnSave,
wizardSpec:b,wizardViewClass:"noTrain"})).render()},updatedContactedStatus:function(){var a=this.options.detailview.model;a.set({protoStatus:"CONVERTED"});var b=rwApp.getUpdateContactedReferralWizard();(new j.WizardUpsertView({firstApplet:b.firstApplet,nextAppletFunctions:b.nextAppletFunctions,refreshFunction:function(){rwApp.refreshTopView()},viewTemplate:b.viewTemplate,upsertmodel:a,stations:b.stations,saveFunction:b.saveFunction,parentView:this,showConfirmOnSave:b.showConfirmOnSave,wizardSpec:b,
wizardViewClass:"noTrain"})).render()},showLinkedIn:function(){var a=this.options.listview.model.get("firstName"),b=this.options.listview.model.get("lastName"),c=this.options.listview.model.get("postalCodeAddress"),f=this.options.listview.model.get("LNProfileId"),a={firstName:!d.isUndefined(a)&&!d.isNull(a)?a:"",lastName:!d.isUndefined(b)&&!d.isNull(b)?b:"",zipCode:!d.isUndefined(c)&&!d.isNull(c)?c:"",contactLNId:!d.isUndefined(f)&&!d.isNull(f)?f:"",dview:this.options.listview};rwApp.showLinkedInList(a)},
renderInLineClock:function(){var a=this.options.detailview.model.get("timeField"),a=c.hasVal(a)?a:0;(new Date(a)).getHours();(new Date(a)).getMinutes()},renderInLineMap:function(){var a=rwApp.getMapMarkerArray([this.options.detailview.model],".mapPopUpSelector",{businessName:"ZfullName",establishmentName:"Zbusiness",logoUrl:rwFB.CDN+"/images/emptyPic.png"}),b=!d.isUndefined(a.markerArray[0].address)?a.markerArray[0].address:!d.isUndefined(a.markerArray[0].latLng)?a.markerArray[0].latLng:void 0;rwApp.renderMap({mArray:a.markerArray,
targetSelector:"#mapTarget",zoom:13,centerAddress:b})},renderListMap:function(){var a=this.options.listMapOptions,a=rwApp.getMapMarkerArray(this.options.listview.model.models,a.popTemplateSelector,a.fieldMap);this.isMapView=!0;rwApp.renderMap({mArray:a.markerArray,targetSelector:"#listMap",bounds:a.latlngbounds,centerAddress:a.centerAddress,parentView:this})},showMaps:function(){var a=rwApp.getMapMarkerArray([this.options.listview.model],".mapPopUpSelector",{fullName:"ZfullName",business:"Zbusiness",
photoUrl:rwFB.CDN+"/images/emptyPic.png"});rwApp.renderMap({mArray:a.markerArray,targetSelector:"#mapTarget"})},printProfile:function(){var a=this.options.listview.model.get("id");c("#printPage").css("top",1500);c("#printPage").show();rwApp.actor=this.options.listview.model.options.module;rwApp.printProfileViewDef.selectedId=a;rwApp.GenericSummaryDetailPattern(rwApp.printProfileViewDef)},newRecord:function(){var a=c.hasVal(this.options.upsertApplet)?this.options.upsertApplet:this.options.detailview.applet;
this.options.detailview.createRecord(a)},inmail:function(){var a=this.options.detailview.model;if("PartnerMgr"==a.options.module)var b=a.get("firstName_pub"),e=a.get("fullName_pub"),d=a.get("partnerId"),h=a.get("partytype"),g=a.get("emailAddress_pub");else b=a.get("firstName"),e=a.get("fullName"),d=a.get("id"),h=a.get("partytype"),g=a.get("emailAddress");c.hasVal(g)||(g=a.get("emailAddress2"));rwApp.newInMail({toFirstName:b,toFullName:e,toPartyId:d,toPartyType:h,toEmail:g,parentView:this})},org_announce:function(){rwApp.newAnnouncement({chapter:this.options.detailview.model,
parentView:this})},invite:function(){var a=this.options.detailview.model;if("PartnerMgr"==a.options.module)var b=a.get("firstName_pub"),e=a.get("fullName_pub"),d=a.get("partnerId"),h=a.get("partytype"),g=a.get("emailAddress_pub");else b=a.get("firstName"),e=a.get("fullName"),d=a.get("id"),h=a.get("partytype"),g=a.get("emailAddress");c.hasVal(g)||(g=a.get("emailAddress2"));rwApp.newInvitation({toFirstName:b,toFullName:e,toPartyId:d,toPartyType:h,toEmail:g,parentView:this})},editSelf:function(){debugger;
var a=this;rwApp.fetchList({module:"UserMgr"}).done(function(b){b=b.models[0];var e=c.hasVal(a.options.upsertApplet)?a.options.upsertApplet:a.options.detailview.applet;a.options.detailview.refreshFunction=function(){rwApp.refreshTopView(!1)};a.options.detailview.model=b;a.options.detailview.editRecord(e)})},editRecord:function(){var a=c.hasVal(this.options.upsertApplet)?this.options.upsertApplet:this.options.detailview.applet;this.options.detailview.refreshFunction=this.editRefreshFunction;this.options.detailview.editRecord(a);
this.options.detailview.refreshFunction=void 0},editRole:function(a){a=("A"==a.target.tagName?c(a.target):c(a.target).parent("a")).attr("upsertApplet");var b=this.options.detailview.model;this.options.detailview.model.set({pre_OrgId:b.get("OrgId"),pre_isPrimaryAmbassador:b.get("isPrimaryAmbassador")});this.options.detailview.editRecord(a)},exportCSV:function(){rwcore.showWaitDialog("CSVExportProgress");var a=rwcore.JSONServerRequest("/csv?type=members","GET","application/octet-stream");if(a){var b=
document.createElement("a");b.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(a));b.setAttribute("download","members");b.click()}rwcore.hideWaitDialog(!0)},wizardEdit:function(){(new j.WizardUpsertView({firstApplet:this.options.upsertWizard.firstApplet,nextAppletFunctions:this.options.upsertWizard.nextAppletFunctions,viewTemplate:this.options.upsertWizard.viewTemplate,upsertmodel:this.options.detailview.model,stations:this.options.upsertWizard.stations,saveFunction:this.options.upsertWizard.saveFunction,
parentView:this,wizardSpec:this.options.upsertWizard,refreshFunction:this.editRefreshFunction})).render()},publish:function(){rwcore.spinOn();var a=new rwcore.StandardModel({module:"UserMgr",id:rwFB.uId,publicProfile:c(".rw_details").html()}),a=a.call("publicProfile",a,{async:!1});c.when(a).done(function(a){rwcore.spinOff();window.open(a.publicProfile,"popup")})},OrgPublish:function(){var a=new rwcore.StandardModel({module:"OrgMgr",id:this.options.detailview.model.id,publicProfile:c(".profilePlatter").html()}),
a=a.call("publicProfile",a,{async:!1});rwcore.spinOn();c.when(a).done(function(a){rwcore.spinOff();window.open(a.publicProfile,"popup")})},LinkedIn:function(){var a=this;d.isNull(rwcore.SocialNetworkLogin.value)&&(rwcore.SocialNetworkLogin.value=rwcore.JSONServerRequest(rwcore.SocialNetworkLogin.location,"GET","html"));c.when(rwcore.LNAuthenticate()).done(function(b){var c=a.options.detailview.model.get("photoUrl"),f=a.options.detailview.model.get("profilePhotoUrl"),h=a.options.detailview.model.get("jobTitle");
(new rwcore.StandardModel({module:"UserMgr",id:rwFB.uId,bio:b.summary,jobTitle:d.isUndefined(h)?b.headline:void 0,profilePhotoUrl:d.isUndefined(f)?b.pictureUrl:void 0,photoUrl:d.isUndefined(c)?b.pictureUrl:void 0})).save({},{async:!1,success:function(){rwcore.FYI("Your LinkedIn Information has been imported");rwApp.refreshTopView()}})}).fail(function(){rwcore.FYI("There was connection issue with LinkedIn, please try again later.")})},wizardNew:function(){(new j.WizardUpsertView({firstApplet:this.options.upsertWizard.firstApplet,
nextAppletFunctions:this.options.upsertWizard.nextAppletFunctions,refreshFunction:this.options.upsertWizard.refreshFunction,viewTemplate:this.options.upsertWizard.viewTemplate,upsertmodel:null,stations:this.options.upsertWizard.stations,saveFunction:this.options.upsertWizard.saveFunction,parentView:this,wizardSpec:this.options.upsertWizard})).render()},updateField:function(a){a.dView=this.options.detailview;var b=c(a.target).attr("refreshlist");a.refreshFunction=b?"rwApp.refreshTopView(true)":"rwApp.refreshTopView(false)";
rwApp.updateKeyField(a)},joinChapter:function(){var a={};a.refreshRoute="#OrgList/"+this.options.detailview.model.get("id");a.OrgId=this.options.detailview.model.get("id");rwApp.joinChapter(a)},joinMeeting:function(){var a={refreshFunction:function(a,c){c.refreshInPlace(a)}};a.eventId=this.options.detailview.model.get("id");a.OrgId=this.options.detailview.model.get("OrgId");a.htmlTemplate="ConfirmJoinMeeting";a.parentView=this;a.operation="add";rwApp.toggleMeetingAttendence(a)},leaveMeeting:function(){var a=
{refreshFunction:function(){rwApp.refreshTopView()}};a.eventId=this.options.detailview.model.get("eventId");a.attendeeId=this.options.detailview.model.get("attendeeId");a.OrgId=this.options.detailview.model.get("OrgId");a.htmlTemplate="ConfirmLeaveMeeting";a.parentView=this;a.operation="remove";rwApp.toggleMeetingAttendence(a)},deleteItem:function(a){var b=this;a.dView=b.options.detailview;var e=b.options.detailview.model,f=e.get("id");a.refreshFunction=function(){var a=c(".rw_listitem#"+f),g=a.prev(),
k=a.next();a.remove();if("heading"==g.attr("role")&&"heading"==k.attr("role")){var l=g.prev();g.remove()}"heading"==k.attr("role")&&(k=k.next());b.options.listview.model.remove(e);d.isUndefined(k)?d.isUndefined(l)||(a=pprev_li.find("a"),a.click()):(a=k.find("a"),a.click())};rwApp.updateKeyField(a)},enrichItem:function(a){a.dView=this.options.detailview;a.refreshFunction="rwApp.refreshTopView(true)";rwApp.updateKeyField(a)},referCustToSelected:function(a){a.dView=this.options.detailview;a.refWizard=
this.options.refWizard;a.parentView=this;rwApp.referCustToSelectedPartner(a)},centerAndPopMapLocation:function(a){c.hasVal(a.get("latitude_work"))&&parseFloat(a.get("latitude_work"));c.hasVal(a.get("longitude_work"))&&parseFloat(a.get("longitude_work"));var b=a.get("id"),e=c("#listMap").gmap3("get");setTimeout(function(){var a=c("#listMap").gmap3({get:{name:"marker",tag:b,all:!0}});c.each(a,function(b,c){e.panTo(c.getPosition());e.getZoom();google.maps.event.trigger(a[b],"click")})},0);this.setNavContext(b)},
setNavContext:function(a){var b=this.options.listview.model.get(a);this.options.listview.selectItem(a);c.hasVal(this.options.secondTierNav)&&(secondTierNavHTML=d.template("SecondTierNavBar",{model:b,secondTierNav:this.options.secondTierNav}),c(".secondTierNav").html(secondTierNavHTML).trigger("create"));this.options.viewBar.model=b;a=this.options.viewBar.render().el.outerHTML;c(this.viewBarDiv).html(a).trigger("create")},handleSelect:function(a){rwcore.spinOn();try{var b=a.target,e=c(b).get(0).nodeName.toLowerCase(),
f=c(b).attr("id");"a"!=e&&(f=c(b).parents("a").attr("id"));var h=this.options.listview.model.get(f),g="#"+this.options.route+"/"+f;a={foo:"bar"};window.history.replaceState&&history.replaceState(a,"Contacts",g);d.isUndefined(this.searchView)||this.searchView.closeView();c.hasVal(this.isMapView)&&this.isMapView?this.centerAndPopMapLocation(h):this.displaySelected(h);rwcore.spinOff()}catch(k){rwcore.spinOff()}},displaySelected:function(a){if(!d.isUndefined(a)){if(a.get("_regualarSize")){a.clickRoute=
!d.isUndefined(this.options.route)?this.options.route:n.history.fragment;this.options.listview.selectItem(a.id);this.options.detailview.model=a;this.options.viewBar.model=a;this.options.appletMenu.model=a;c.hasVal(this.options.appletMenuRight)&&(this.options.appletMenuRight.model=a);var b=this.options.detailview.render().el.outerHTML,e=this.options.viewBar.render().el.outerHTML,f=this.options.appletMenu.render().el.outerHTML,h="";c.hasVal(this.options.appletMenuRight)&&(h=this.options.appletMenuRight.render().el.outerHTML);
c.hasVal(this.options.secondTierNav)&&(secondTierNavHTML=d.template("SecondTierNavBar",{model:a,secondTierNav:this.options.secondTierNav}));c("#form1").html(b).trigger("create");c.hasVal(this.options.detailview2)&&(this.options.detailview2.model=a,b=this.options.detailview2.render().el.outerHTML,c("#form2").html(b).trigger("create"));c.hasVal(this.options.detailview3)&&(this.options.detailview3.model=a,b=this.options.detailview3.render().el.outerHTML,c("#form3").html(b).trigger("create"));c.hasVal(this.options.detailview4)&&
(this.options.detailview4.model=a,b=this.options.detailview4.render().el.outerHTML,c("#form4").html(b).trigger("create"));d.isUndefined(this.options.ChartWizardView)||this.options.ChartWizardView.render(a);c(this.viewBarDiv).html(e).trigger("create");c(this.menuDiv).html(f).trigger("create");c(".rightMenu").html(h).trigger("create");c.hasVal(this.options.inlineMap)&&this.renderInLineMap();c.hasVal(this.options.inlineClock)&&this.renderInLineClock(this.options.inlineClock);rwApp.removeEmptyFields();
return!1}var g=this;(new rwcore.StandardModel({module:this.options.listview.actor,id:a.id})).fetch({async:!1,error:rwcore.showError,success:function(b){a.set(b.attributes);a.set({_regualarSize:!0});g.displaySelected(a)}})}},renderDetailView:function(a){return displaySelected(this.options.listview.model.models[a])},renderAdditionalDetailView:function(a){var b=null;switch(a){case 2:b=this.options.detailview2;break;case 3:b=this.options.detailview3;break;case 4:b=this.options.detailview4;break;default:b=
this.options.detailview2}b.model=this.options.listview.model.models[index];return b.outerHTML},renderDetailBody:function(){var a="";try{rwcore.spinOn(),a=this.options.detailview.render().el.outerHTML,rwcore.spinOff()}catch(b){rwcore.spinOff()}return a},renderViewBar:function(){return this.options.viewBar.render().el.outerHTML},render:function(){rwcore.spinOn();try{c.hasVal(this.options.appletMenuRight)&&(this.options.appletMenuRight=new j.FormView({applet:this.options.appletMenuRight,templateHTML:"StdForm",
showViewBar:!0,viewBarTemplate:"AppletMenuTemplate",model:this.options.detailview.model}));var a=this.options.listview.render().el.outerHTML,b="";if(!d.isUndefined(this.options.viewTitle)&&!d.isNull(this.options.viewTitle))b=this.options.viewTitle;else if(!d.isUndefined(this.options.dynamicTitles)&&!d.isNull(this.options.dynamicTitles)&&0<this.options.dynamicTitles.length)var e=this.options.dynamicTitles[0],b=!d.isUndefined(e)&&!d.isNull(e)?e:"";else b=this.options.detailview.metaApplet.model.attributes.pluralTitle;
e="";if(c.hasVal(this.options.secondTierNav))var f=c.hasVal(this.options.listview.model.models)?this.options.listview.model.models[0]:this.options.listview.model,e=d.template("SecondTierNavBar",{model:f,secondTierNav:this.options.secondTierNav});var h=c.hasVal(this.options.detailview)?this.renderDetailBody(0):"",g=d.template(this.options.templateHTML,{listview:a,secondTierNav:e,render:this,title:b,detailBody:h,_:d});d.isUndefined(this.printContainer)||d.isNull(this.printContainer)?(c(this.el).css("height",
"100%"),c(this.el).html(g)):c(this.printContainer).html(g).trigger("create");d.isUndefined(this.options.reportMeta)||(this.options.ChartWizardView=new j.ChartWizardView(this.options.reportMeta),this.options.ChartWizardView.render(this.options.reportMeta));rwcore.spinOff()}catch(k){rwcore.spinOff()}return this}});j.MasterDetailView=n.View.extend({leafApplet:"",initialize:function(a){this.options=a},events:{"click .mainList [toggleState]":function(a){a.containerEL=".mainList";this.displayRecord(a)},
"click .secondList [toggleState]":function(a){a.containerEL=".secondList";this.displayRecord(a)},"click [confirmation='true']":"updateField","click #refer":"referCustToSelected","click #wizardUpsert":"wizardUpsert","click #share":"share","click [action='ignoreMyRec']":"ignore","click #paynow":"paynow","click [action='invite']":"contextInvite","click [action='refer']":"contextRefer","click #new":"newRecord","click #edit":"editMaster","click .checkin":"checkin","click .checkout":"checkout","click .contextEdit":"editItem",
"click .contextDelete":"deleteItem","click #delete":"deleteMaster","click #deleteEvent":"deleteEvent","click #nextRec":"nextRecord","click #prevRec":"previousRecord","click #addGuest":"addGuest"},nextRecord:function(){var a=this.options.allOptions.nextPrevListView.model.indexOf(this.options.masterview.model);if(a<this.options.allOptions.nextPrevListView.model.length-1){var a=this.options.allOptions.nextPrevListView.model.at(a+1).get("id"),b=window.location.hash.replace("#","");if(-1!=b.indexOf("/"))var c=
b.substr(b.lastIndexOf("/")),b=b.replace(c,"");n.history.fragment=null;rwApp.navigate(b+"/"+a,{trigger:!0,replace:!1})}else rwcore.FYI("This is the last record")},previousRecord:function(){var a=this.options.allOptions.nextPrevListView.model.indexOf(this.options.masterview.model);if(0<a){var a=this.options.allOptions.nextPrevListView.model.at(a-1).get("id"),b=window.location.hash.replace("#","");if(-1!=b.indexOf("/"))var c=b.substr(b.lastIndexOf("/")),b=b.replace(c,"");n.history.fragment=null;rwApp.navigate(b+
"/"+a,{trigger:!0,replace:!1})}else rwcore.FYI("This is the first record")},addGuest:function(a){a.OrgId=this.options.masterview.model.get("OrgId");a.eventId=this.options.masterview.model.get("id");a.refWizard=rwApp.AddGuestWizard;a.parentView=this;rwApp.addGuest(a)},editMaster:function(){var a={el:"#upsertRecord",appletName:c.hasVal(this.options.upsertApplet)?this.options.upsertApplet:this.options.d1view.applet,upsertModel:this.options.masterview.model,parentView:this};rwApp.upsertRecord(a)},deleteEvent:function(){event.dView=
this.options.masterview;var a=this.options.masterview.model.get("OrgId");event.refreshFunction=function(){rwApp.navigate("#OrgEvents/"+a,{trigger:!0,replace:!0})};rwApp.updateKeyField(event)},deleteItem:function(a){a.dView=this.options.d1view;a.refreshFunction=function(){rwApp.refreshTopView(!1)};rwApp.updateKeyField(a)},editItem:function(a){a=c(a.target).attr("actionRecord");a=this.options.d1view.model.get(a);var b=this.options.upsertApplet,e=c.hasVal(this.options.upsertTemplate)?this.options.upsertTemplate:
"upsertForm";rwApp.upsertRecord({el:"#upsertRecord",appletName:b,upsertTemplate:e,upsertModel:a,parentView:this,success:null})},checkin:function(a){var b=c.hasVal(c(a.target).attr("checkInButtonId"))?c(a.target).attr("checkInButtonId"):c(a.target).parents("[checkInButtonId]").attr("checkInButtonId");a=this.options.d1view.model.get(b);a.options.module="AttendeeMgr";a.options.bo="Attendee";a.options.bc="Attendee";a=rwApp.eventCheckIn({model:a,changeToStatus:"CHECKEDIN"});c.when(a).done(function(){c("#"+
b).hide()})},checkout:function(a){var b=c.hasVal(c(a.target).attr("checkInButtonId"))?c(a.target).attr("checkInButtonId"):c(a.target).parents("[checkInButtonId]").attr("checkInButtonId");a=this.options.d1view.model.get(b);a.options.module="AttendeeMgr";a.options.bo="Attendee";a.options.bc="Attendee";a=rwApp.eventCheckIn({model:a,changeToStatus:"INVITED"});c.when(a).done(function(){c("#"+b).hide()})},referCustToSelected:function(a){a.dView=this.options.masterview;a.refWizard=this.options.refWizard;
a.parentView=!d.isUndefined(this.options.d2view)&&!d.isNull(this.options.d2view)?this:null;rwApp.referCustToSelectedPartner(a)},contextRefer:function(a){var b=c(a.target).attr("recId");a.dViewModel=c.hasVal(b)?this.options.d1view.model.get(b):null;a.refWizard=this.options.refWizard;a.parentView=!d.isUndefined(this.options.d2view)&&!d.isNull(this.options.d2view)?this:null;rwApp.referCustToSelectedPartner(a)},contextInvite:function(a){a=c(a.target).attr("recId");a=c.hasVal(a)?this.options.d1view.model.get(a):
null;var b=a.get(this.options.inviteFields.toEmailField[0]),e=a.get(this.options.inviteFields.toEmailField[1]),d=null;c.hasVal(b)?d=b:c.hasVal(e)?d=e:rwcore.FYI("The contact must have a valid email in order to receive an invitation");c.hasVal(d)&&-1<d.indexOf("@")&&rwApp.newInvitation({toFirstName:a.get(this.options.inviteFields.toFirstNameField),toFullName:a.get(this.options.inviteFields.toFullNameField),toPartyId:a.get(this.options.inviteFields.toPartyIdField),toPartyType:a.get(this.options.inviteFields.toPartyTypeField),
toEmail:d,parentView:this})},newRecord:function(){var a=this.options.upsertApplet,b={},c;for(c in this.options.parentDefaultVals){var f=this.options.parentDefaultVals[c];if(d.isObject(f)){arguments={};for(var h=0;h<f.functionArg.length;h++){var g=f.functionArg[h];arguments[g]=this.options.masterview.model.get(g)}f=f.functionName(arguments);b[c]=f}else b[c]=this.options.masterview.model.get(f)}c=new j.FormView({applet:a,templateHTML:"StdForm",parentView:this,showConfirmOnSave:!1,showViewBar:!1});c.setDefaultModel();
c.model.set(b);c.editRecord(a)},wizardUpsert:function(){(new j.WizardUpsertView({firstApplet:this.options.upsertWizard.firstApplet,nextAppletFunctions:this.options.upsertWizard.nextAppletFunctions,viewTemplate:this.options.upsertWizard.viewTemplate,upsertmodel:this.options.d1view.model,stations:this.options.upsertWizard.stations,saveFunction:this.options.upsertWizard.saveFunction,parentView:this,wizardSpec:this.options.upsertWizard})).render()},wizardEdit:function(){(new j.WizardUpsertView({firstApplet:this.options.upsertWizard.firstApplet,
nextAppletFunctions:this.options.upsertWizard.nextAppletFunctions,viewTemplate:this.options.upsertWizard.viewTemplate,upsertmodel:this.options.detailview.model,stations:this.options.upsertWizard.stations,saveFunction:this.options.upsertWizard.saveFunction,parentView:this,wizardSpec:this.options.upsertWizard})).render()},wizardNew:function(){(new j.WizardUpsertView({firstApplet:this.options.upsertWizard.firstApplet,nextAppletFunctions:this.options.upsertWizard.nextAppletFunctions,refreshFunction:this.options.upsertWizard.refreshFunction,
viewTemplate:this.options.upsertWizard.viewTemplate,upsertmodel:null,stations:this.options.upsertWizard.stations,saveFunction:this.options.upsertWizard.saveFunction,parentView:this,wizardSpec:this.options.upsertWizard})).render()},share:function(a){a=c(a.target).attr("recId");a=c.hasVal(a)?this.options.d1view.model.get(a):null;a={model:this.options.masterview.model,detailRecord:a};c.hasVal(this.options.shareFunction)?this.options.shareFunction(a):rwApp.sharePartnerInfo({model:this.options.masterview.model})},
ignore:function(a){a=c(a.target).attr("recId");a={dview:this.options.d1view,actionRecordId:a,refreshFunction:rwApp.refreshTopView(!1),setFieldMap:{status:"IGNORED"}};rwApp.updateKeyFieldSilent(a)},paynow:function(){alert("paynow")},updateField:function(a){a.dView=this.options.d1view;a.refreshFunction="$('.mainList').html(that.render().el.outerHTML).trigger('create');";rwApp.updateKeyField(a)},displayRecord:function(a){this.options.d1view.toggleCollapse(a)},render:function(){try{rwcore.spinOn();var a=
this.options.masterview.render().el.outerHTML;c.hasVal(this.options.appletMenuRight)&&(this.options.appletMenuRight=new j.FormView({applet:this.options.appletMenuRight,templateHTML:"StdForm",showViewBar:!0,viewBarTemplate:"AppletMenuTemplate",model:this.options.masterview.model}));this.primaryChildListView=this.options.d1view;var b=this.primaryChildListView.render().el.outerHTML,e=!d.isUndefined(this.options.d2view)&&!d.isNull(this.options.d2view)?this.options.d2view.render().el.outerHTML:"",f=this.options.viewBar.render().el.outerHTML,
h="";if(!d.isUndefined(this.options.viewTitle)&&!d.isNull(this.options.viewTitle))h=this.options.viewTitle;else if(!d.isUndefined(this.options.dynamicTitles)&&!d.isNull(this.options.dynamicTitles)&&0<this.options.dynamicTitles.length)var g=this.options.dynamicTitles[0],h=!d.isUndefined(g)&&!d.isNull(g)?g:"";g="";c.hasVal(this.options.secondTierNav)&&(g=d.template("SecondTierNavBar",{model:this.options.masterview.model,secondTierNav:this.options.secondTierNav}));var k=d.template(this.options.templateHTML,
{masterview:a,d1:b,d2:e,viewBar:f,render:this,title:h,secondTierNav:g,_:d});c(this.el).css("height","100%");c(this.el).html(k);rwcore.spinOff()}catch(l){rwcore.spinOff()}return this}});j.SavedSearchPickView=n.View.extend({initialize:function(a){this.options=a;this.parentView=a.parentView;this.container="#pickListContents";this.searchGroup=a.searchGroup},events:{"click .rw_listitem":"pickSavedSearch"},pickSavedSearch:function(a){a=a.target;var b=c(a).get(0).nodeName.toLowerCase(),e=c(a).attr("id");
"a"!=b&&(e=c(a).parents("a").attr("id"));a=this.pickView.model.get(e);a=rwApp.xformSS(a);d.isUndefined(this.parentView.searchView)||this.parentView.searchView.refreshSearchModel(a);this.parentView.applySavedSearch(a);this.pickView.cancelPick();c("#picklistContainer").removeClass("bookMarks");c("#picklistContainer").off("click","#pickCreate");this.remove()},fetchSavedSearch:function(a){return rwApp.fetchList({module:"GenericMgr",bc:"SavedSearch",bo:"SavedSearch",sortby:"name",searchSpec:{filter:[{ftype:"expr",
expression:{searchGroup:a.searchGroup}},{ftype:"expr",expression:{$or:[{ownerId:rwFB.uId},{accessLevel:"public"}]}}]}})},render:function(){var a=this;this.pickView=new j.ListView({applet:"SavedSearchList",setFilter:!0,template:"StdDynamicPickList",parentView:this.parentView,ulClass:"pickID",batchSize:12,usePaging:!1});this.fetchSavedSearch({searchGroup:this.searchGroup}).done(function(b){a.pickView.model=b;b=a.pickView.render().el.outerHTML;a.$el.html(b).trigger("create");c(a.container).html(a.$el).trigger("create");
c("#pickTitle").html("Pick Saved Search");c("#picklistContainer").addClass("bookMarks");c.hasVal(!1);c("#pickBackground").show(50);c("#picklistContainer").show(250);c("#picklistContainer").one("click","#cancelPick",function(){a.pickView.cancelPick();c("#picklistContainer").removeClass("bookMarks");c("#picklistContainer").off("click","#pickCreate");a.remove()})})}});j.SearchView=n.View.extend({initialize:function(a){this.options=a;this.parentView=a.parentView;this.container="#SavedSearchContainer";
this.searchGroup=a.searchGroup;this.actor=a.actor;this.bo=a.bo;this.bc=a.bc},events:{"click #cancelSearch":"cancel","click #execSearch":"exec","click #deleteSearch":function(){this.showConfirmation({confirmTemplate:"ConfirmSS_Delete"})},"click #saveSearch":function(){this.showConfirmation({confirmTemplate:"ConfirmSS_Save_Prompt",selectedSSModel:this.searchFormView.model})},"click #clearSearch":"clearSearch","click [pickApplet]":function(a){this.searchFormView.launchPick(a)},"change select":function(a){this.searchFormView.changeItem(a)},
"change input":function(a){this.searchFormView.changeItem(a)},"change textarea":function(a){this.searchFormView.changeItem(a)},"click [multicheckbox_search]":function(a){this.searchFormView.addToMultiCheckSearchBox(a)},"click .removeSelectedMCS":function(a){this.searchFormView.removeMultiCheckSearchBox(a)},"click .multicheck-search-container":function(a){this.searchFormView.setMCSFocus(a)}},fetchSavedSearch:function(a){return rwApp.fetchList({module:"GenericMgr",bc:"SavedSearch",bo:"SavedSearch",
sortby:"name",searchSpec:{filter:[{ftype:"expr",expression:{searchGroup:this.searchGroup}},{ftype:"expr",expression:{searchName:a}},{ftype:"expr",expression:{$or:[{ownerId:rwFB.uId},{accessLevel:"public"}]}}]}})},cancel:function(){this.closeView()},showConfirmation:function(a){var b=c("#PopupContainer");b.html(d.template(a.confirmTemplate)());b.addClass("confirmation");c(".overlay-background").show();b.show();a=a.selectedSSModel;d.isUndefined(a)||(a=a.get("searchName"),c("#ssName").attr("value",a));
b.one("click","[confirmsave]",this,function(a){var b=c("#ssName").attr("value");a=a.data;c.hasVal(b)?a.save({searchName:b}):rwcore.FYI("You must give your filter a name to save it")});b.one("click","[confirmCancel]",function(){b.hide();c(".overlay-background").hide();b.removeClass("confirmation")});b.one("click","[confirmDelete]",this,function(a){a.data.deleteFilter();b.hide();c(".overlay-background").hide();b.removeClass("confirmation")})},hideConfirmation:function(){popUpContainer.hide();c(".overlay-background").hide();
popUpContainer.removeClass("confirmation")},save:function(a){that=this;var b=a.searchName;this.fetchSavedSearch(b).done(function(a){if(0<a.length){a=a.models[0];var d=a.get("accessLevel"),h=a.get("ownerId"),g=c.hasAccess({record:a,routeName:"any",privilege:"editPublicSavedSearch"});if("public"==d&&!g)rwcore.FYI("Only an administrator can change a public filter.  Rename it to save a private copy.");else if(g||h==rwFB.uId)g=rwApp.getSearchDefinition(this.searchFormView.model,this.options.searchAppletName,
!1),a.set({searchName:b}),a.set({definition:g}),a=rwApp.saveModel(a),a.done(function(){that.showConfirmation({confirmTemplate:"ConfirmSS_Save"})})}else a=new rwcore.StandardModel({module:"SavedSearchMgr",bo:"SavedSearch",bc:"SavedSearch"}),g=c.hasAccess({record:a,routeName:"any",privilege:"editPublicSavedSearch"}),a.set({ownerId:rwFB.uId,accessLevel:g?"public":"personal",sActor:that.actor,sBO:that.bo,sBC:that.bc,searchName:b,searchGroup:that.searchGroup}),g=rwApp.getSearchDefinition(that.searchFormView.model,
that.options.searchAppletName,!1),a.set({searchName:b}),a.set({definition:g}),a=rwApp.saveModel(a),a.done(function(){that.showConfirmation({confirmTemplate:"ConfirmSS_Save"});that.enableDelete()})})},exec:function(){this.parentView.applySavedSearch(this.searchFormView.model)},deleteFilter:function(){var a=this.searchFormView.model.get("savedSearchId"),b=new rwcore.StandardModel({module:"SavedSearchMgr",bo:"SavedSearch",bc:"SavedSearch"});b.set({id:a});rwApp.deleteModel(b).done(function(){})},enableSave:function(){c("#saveSearch").show();
c("#hideSearch").hide();c("#deleteSearch").hide();this.searchFormView.model.set({accessLevel:"personal"})},enableDelete:function(){c("#saveSearch").hide();c("#hideSearch").hide();c("#deleteSearch").show()},clearButtons:function(){c("#deleteSearch").hide();c("#saveSearch").hide()},enableRemove:function(){},clearSearch:function(){this.searchFormView.setDefaultModel();this.searchFormView.model.set({searchName:"None"});this.parentView.applySavedSearch(this.searchFormView.model);this.refreshSearchModel(this.searchFormView.model)},
render:function(){this.searchFormView=new j.FormView({applet:this.options.searchAppletName,templateHTML:this.options.searchAppletTemplate,parentView:this,postChange:function(a){a.parentView.enableSave()}});d.isUndefined(this.options.searchModel)?this.searchFormView.setDefaultModel():this.searchFormView.model=this.options.searchModel;var a=this.searchFormView.metaApplet.model.attributes.field;!1==d.isArray(a)&&(a=[a]);a=d.clone(a);rwApp.FetchRadioButtonModels({view:this.searchFormView,fieldList:a,
done:function(a){a.view.parentView.renderFinish()},wizardView:null})},renderFinish:function(){var a=d.isUndefined(this.options.searchModel)?!0:!1,b=this.searchFormView.render().el.outerHTML,b=d.template("SearchView",{title:this.options.title,formHTML:b});this.$el.html(b);c(this.container).html(this.$el).trigger("create");a?this.enableSave():"personal"==this.options.searchModel.get("accessLevel")&&this.enableDelete();this.searchFormView.renderAllMultiCheckSearchControls();c("[altTimeVal]").attr("value",
c("[altTimeVal]").attr("altTimeVal"));c("[altDateVal]").attr("value",c("[altDateVal]").attr("altDateVal"));c(".datepicker").datepicker({dateFormat:"mm/dd/yy"});c(".datetimepicker").datetimepicker({dateFormat:"mm/dd/yy",timeFormat:"hh:mm tt"});c(".timepicker").timepicker({timeFormat:"hh:mm tt"});this.showView();return this},refreshSearchModel:function(a){var b=this.searchFormView.render(a).el.outerHTML;this.$el.find("#appletFrame").html(b).trigger("create");"personal"==a.get("accessLevel")&&this.enableDelete();
d.isUndefined(a.get("accessLevel"))&&this.clearButtons();this.searchFormView.renderAllMultiCheckSearchControls();c("[altTimeVal]").attr("value",c("[altTimeVal]").attr("altTimeVal"));c("[altDateVal]").attr("value",c("[altDateVal]").attr("altDateVal"));c(".datepicker").datepicker({dateFormat:"mm/dd/yy"});c(".datetimepicker").datetimepicker({dateFormat:"mm/dd/yy",timeFormat:"hh:mm tt"});c(".timepicker").timepicker({timeFormat:"hh:mm tt"})},showView:function(){c(this.container).show(50);c.hasVal(this.options.SearchViewClass)&&
c(this.el).addClass(this.options.SearchViewClass);c(this.container).animate({top:15},500,function(){c(this.container).css("bottom","5px");c(this.container).css("height","auto")})},closeView:function(){var a=this.container;c(a).animate({top:1E3},500,function(){c(this.el).hide(50);c(a).css("bottom","auto");c(a).css("height","99%");c(a).css("top","100%");c(a).hide()});rwApp.preventNavigation=!1;this.parentView.searchView=void 0;this.remove()}});j.WizardUpsertView=n.View.extend({initialize:function(a){this.options=
a;this.firstApplet=a.firstApplet;this.previousApplets=[];this.previousApplets[0]=this.firstApplet;this.nextAppletFunctions=a.nextAppletFunctions;this.refreshFunctionStatic=a.refreshFunctionStatic;this.currentAppletInt=0;this.model=a.upsertmodel;this.currentAppletView=null;this.parentView=a.parentView;this.viewTemplate=a.viewTemplate;this.container="#upsertRecord";this.appletFrameEL="#appletFrame";this.stations=a.stations;this.appletTemplates=a.appletTemplates;this.saveFunction=a.saveFunction;this.showConfirmOnSave=
a.showConfirmOnSave;this.refreshFunction=a.refreshFunction;this.cartFrameEL="#cartFrame";this.isCreateRecord=d.isUndefined(a.upsertmodel)?!0:!1;this.initializedApplets={};this.helpUrl=a.helpUrl},events:{"change select":function(a){this.currentAppletView.changeItem(a)},"change input":function(a){this.currentAppletView.changeItem(a)},"change textarea":function(a){this.currentAppletView.changeItem(a)},"click #next":"next","click #back":"back","click #cancel":"cancel","click #save":"save","click [pickApplet]":function(a){this.currentAppletView.launchPick(a)},
"click .assoc":"addAssociation","click .cartItem":"removeAssociation","click [multicheckbox_search]":function(a){this.currentAppletView.addToMultiCheckSearchBox(a)},"click .removeSelectedMCS":function(a){this.currentAppletView.removeMultiCheckSearchBox(a)},"click .multicheck-search-container":function(a){this.currentAppletView.setMCSFocus(a)}},addAssociation:function(a){this.currentAppletView.addAssociation(a)},removeAssociation:function(a){this.currentAppletView.removeAssociation(a)},updateTrain:function(){var a=
c.hasVal(this.currentAppletOptions.stationNumber)?this.currentAppletOptions.stationNumber:this.currentAppletInt,b="Step "+(this.currentAppletInt+1)+": "+this.stations[a];c(".stationTitle").html(b);b=c(c("#train div.trainStation")[a]);c("div.trainCircle.active").removeClass("active");b.find(".trainCircle").addClass("active");a==this.stations.length-1&&(c("#next").hide(),c("#save").show())},next:function(){var a=this.currentAppletView.class==j.AssociationView?null:m.validateRequired(this.model,this.currentAppletView.metaApplet);
if(d.isNull(a))this.previousApplets[this.currentAppletInt]=this.currentAppletOptions,this.currentAppletInt++,c("#back").show(),this.getCurrentAppletView();else if(!d.isUndefined(this.currentAppletView.error)){var b={};b.responseText=a;b.status=99999;this.currentAppletView.error(null,b,null)}},renderStep:function(){var a=this.currentAppletView;a.class==j.AssociationView?(a.parentView=this,a.render("refresh")):(c(this.appletFrameEL).html(a.render(this.model).el.outerHTML).trigger("create"),c("[altTimeVal]").attr("value",
c("[altTimeVal]").attr("altTimeVal")),c("[altDateVal]").attr("value",c("[altDateVal]").attr("altDateVal")),c(".datepicker").datepicker({dateFormat:"mm/dd/yy"}),c(".datetimepicker").datetimepicker({dateFormat:"mm/dd/yy",timeFormat:"hh:mm tt"}),c(".timepicker").timepicker({timeFormat:"hh:mm tt"}),a.renderAllMultiCheckSearchControls())},renderFirstStep:function(){var a=this.currentAppletView;if(a.class==j.AssociationView)a.parentView=this,a.render("renderContainer");else{var b="";!d.isUndefined(this.options.viewTitle)&&
!d.isNull(this.options.viewTitle)?b=this.options.viewTitle:!d.isUndefined(this.options.dynamicTitles)&&(!d.isNull(this.options.dynamicTitles)&&0<this.options.dynamicTitles.length)&&(b=this.options.dynamicTitles[0],b=!d.isUndefined(b)&&!d.isNull(b)?b:"");var e=a.render().el.outerHTML,b=d.template(this.viewTemplate,{firstAppletHTML:e,title:b,stations:this.stations,cart:this.cartView,_:d,helpUrl:this.helpUrl});this.$el.html(b);c(this.container).html(this.$el).trigger("create");c("[altTimeVal]").attr("value",
c("[altTimeVal]").attr("altTimeVal"));c("[altDateVal]").attr("value",c("[altDateVal]").attr("altDateVal"));c(".datepicker").datepicker({dateFormat:"mm/dd/yy"});c(".datetimepicker").datetimepicker({dateFormat:"mm/dd/yy",timeFormat:"hh:mm tt"});c(".timepicker").timepicker({timeFormat:"hh:mm tt"});a.renderAllMultiCheckSearchControls();this.showView()}},back:function(){this.currentAppletInt--;var a=this.previousApplets[this.currentAppletInt];a.postFetchRadio="wizardNextApplet";this.getCurrentAppletView(a);
c("#next").show();c("#save").hide();0==this.currentAppletInt&&c("#back").hide();this.updateTrain();this.currentAppletView.class==j.AssociationView&&(this.currentAppletView.parentView=this,this.currentAppletView.render("refresh"))},cancel:function(){this.currentAppletView.cancelUpdate()},save:function(){c.hasVal(this.saveFunction)?this.saveFunction({model:this.model,currentAppletView:this.currentAppletView,parentView:this.parentView,wizardSpec:this.options.wizardSpec}):(c.hasVal(this.showConfirmOnSave)&&
(this.currentAppletView.options.showConfirmOnSave=this.showConfirmOnSave,c.hasVal(this.refreshFunctionStatic)||(this.currentAppletView.parentView=null)),c.hasVal(this.refreshFunction)&&(this.currentAppletView.refreshFunction=this.refreshFunction),c.hasVal(this.refreshFunctionStatic)&&(this.currentAppletView.refreshFunctionStatic=this.refreshFunctionStatic),this.currentAppletView.saveItem())},updateField:function(a){a.dView=this.options.d1view;a.refreshFunction="$('.mainList').html(that.render().el.outerHTML).trigger('create');";
rwApp.updateKeyField(a)},getCurrentAppletView:function(a){var b=null;this.currentAppletOptions=b=c.hasVal(a)?a:(0,this.nextAppletFunctions[this.previousApplets[this.currentAppletInt-1].name])(this.model,this.options.wizardSpec);var e=b.name;this.updateTrain();a=c.hasVal(b.template)?b.template:"WizardUpsertFormNarrow";var f=c.hasVal(b.renderer)?b.renderer:j.FormView;a=new f({applet:e,templateHTML:a,parentView:this.parentView,"class":f,data:this.model,setFilter:b.setFilter,assocOptions:b,refreshFunction:this.refreshFunction});
c.hasVal(this.model)?(this.isCreateRecord&&!this.initializedApplets.hasOwnProperty(e)&&(m.setDefaultValues(this.model,a.metaApplet,void 0),this.initializedApplets[e]=!0),a.model=this.model):(a.setDefaultModel(),this.model=a.model,this.isCreateRecord=!0,this.initializedApplets[e]=!0);this.currentAppletView=a;a.class==j.AssociationView?"initializeWizard"==this.firstApplet.postFetchRadio?(this.firstApplet.postFetchRadio="wizardNextApplet",this.renderFirstStep()):this.renderStep():(e=a.metaApplet.model.attributes.field,
!1==d.isArray(e)&&(e=[e]),e=d.clone(e),b=c.hasVal(b.postFetchRadio)?b.postFetchRadio:"wizardNextApplet",rwApp.FetchRadioButtonModels({view:a,fieldList:e,done:b,wizardView:this}))},render:function(){this.firstApplet.postFetchRadio="initializeWizard";this.getCurrentAppletView(this.firstApplet)},showView:function(){c(this.container).show(50);c(".overlay-background").toggle(0);c.hasVal(this.options.wizardViewClass)&&c(this.el).addClass(this.options.wizardViewClass);c(this.container).animate({top:0},500,
function(){c(this.container).css("bottom","5px");c(this.container).css("height","auto")});rwApp.preventNavigation=!0}});j.PopupView=n.View.extend({initialize:function(a){this.params=a},events:{"click #pickOutlook":"pickOutlook","click #pickVCF":"pickVCF","click #pickCSV":"pickCSV","click #cancelImport":"cancel","change #vCard_Pick":"importFile","change #csv_Pick":"importCSVFile"},cancel:function(a){c("#PopupContainer").hide(50);c("#PopupContainer").html("");c("#pickBackground").hide(50);a.preventDefault()},
pickVCF:function(a){c("#vCard_Pick").click();a.preventDefault()},pickCSV:function(a){c("#csv_Pick").click();a.preventDefault()},importCSVFile:function(a){var b=this,e=c.Deferred(),d=void 0;try{if(d=c.browser.msie?(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(a.target.value).ReadAll():a.target.files[0],void 0!=d){var h=new FileReader;debugger;h.onload=function(a){a=c.csv.toObjects(a.target.result);e.resolve(a)};h.readAsText(d)}else e.reject("csv reader failed")}catch(g){e.reject(g)}c.when(e).done(function(c){console.log(c);
b.cancel(a)}).fail(function(c){alert(c);b.cancel(a)})},importFile:function(a){c.rwVCFUpload(a)},render:function(){c(this.el).html(d.template(this.params.template));return this}});j.TilesView=n.View.extend({tagName:"ul",options:null,className:"tileList",attributes:{datarole:"listview",style:"list-style: none;"},initialize:function(a){this.options=a;this.options.offset=0;this.id=a.id;this.nextHandlerState=!1},events:{"click [actionone]":"actionone","click [actiontwo]":"actiontwo","click [actionthree]":"actionthree"},
scrollHandler:function(a){var b=c(".mainPanelBody").scrollTop(),e=c(".mainPanelBody").height();c(".mainPanelBody").prop("scrollHeight")-b<e+5&&!a.data.nextHandlerState&&(a.data.nextHandlerState=!0,c.when(a.data.NextHandler(a)).done(function(){a.data.nextHandlerState=!1}).fail(function(){a.data.nextHandlerState=!1}))},render:function(a){var b=this;d.isUndefined(a)?a=b.model:b.model.set(a.models);var e=(new m.AppletView({applet:b.options.applet,template:this.options.templateHTML})).render().el;0<a.length?
(d.each(a.models,function(a){c(b.options.offset?"ul#"+b.id:b.el).append(m.recordBinder(e,a))},b),0==b.options.offset&&c("ul#"+b.id).listview("refresh"),b.options.offset+=rwcore.pagingSize):0==b.options.offset&&c(b.el).append("<h3 style='font-style:italic'> No records! </h3>");return b},NextHandler:function(a){var b=c.Deferred(),e=a.data;"FaceBookRegionSelector"==e.id?(rwcore.spinOn(),a=rwcore.FBMatch({offset:e.options.offset}),a.done(function(a){a&&e.render(a);rwcore.spinOff();b.resolve()}).fail(function(){rwcore.spinOff();
b.reject()})):"LinkedIdRegionSelector"==e.id&&(rwcore.spinOn(),a=rwcore.LNMatch({offset:e.options.offset}),a.done(function(a){a&&e.render(a);rwcore.spinOff();b.resolve()}).fail(function(){rwcore.spinOff();b.reject()}));return b},actionone:function(a){var b=a.target;if("Invited"!=c(b).html()){var e=c(b).attr("for");FB.api("/"+e,function(a){var d=new rwcore.StandardModel({module:"RfrlMgr"});d.set({socialId:rwFB.fbUserID});d.set({socialConnectionId:e});d.set({invitationType:"FB"});d.set({to_firstName:a.first_name});
d.set({to_lastName:a.last_name});d.set({to_middleName:a.middle_name});d.set({to_emailAddress:a.username});d.call("SocialInvitaton",d,{add:!0,error:rwcore.showError,raw:!0,success:function(a){FB.ui({method:"send",name:rwFB.rwTenantName,to:e,link:rwFB.rwTenantURL+"/register.jsp?invitation="+a.token,picture:rwFB.rwTenantLogo,description:rwFB.rwTenantInvitation,display:"popup"},function(d){var f="FAILED";d&&(c(b).attr("class",""),c(b).html("Invited"),f="SUCCESS");d=new rwcore.StandardModel({module:"RfrlMgr"});
d.set({status:f});d.set({socialConnectionId:e});d.set({invitationType:"FB"});d.set({details:a});d.call("SocialInvitatonSent",d,{add:!0,error:rwcore.showError,success:function(){}})})}})})}},actiontwo:function(a){var b=a.target;if("Invited"!=c(b).html()){var e=c(b).attr("for");IN.API.Profile(e).fields(["firstName","lastName"]).result(function(a){var d=a.values[0];a=new rwcore.StandardModel({module:"RfrlMgr"});a.set({socialId:rwFB.lnUserID});a.set({socialConnectionId:e});a.set({invitationType:"LN"});
a.set({to_firstName:d.firstName});a.set({to_lastName:d.lastName});a.set({to_emailAddress:d.firstName+"."+d.lastName});a.call("SocialInvitaton",a,{add:!0,error:rwcore.showError,raw:!0,success:function(a){a={recipients:{values:[{person:{_path:"/people/"+e}}]},subject:rwFB.rwTenantInvitation,body:rwFB.rwTenantURL+"/register.jsp?invitation="+a.token};IN.API.Raw("/people/~/mailbox").method("POST").body(JSON.stringify(a)).result(function(){c(b).attr("class","");c(b).html("Invited");var a=new rwcore.StandardModel({module:"RfrlMgr"});
a.set({status:"SUCCESS"});a.set({socialConnectionId:e});a.set({invitationType:"LN"});a.call("SocialInvitatonSent",a,{add:!0,error:rwcore.showError,success:function(){}});rwcore.FYI(d.firstName+" has been invited.")}).error(function(a){var b=new rwcore.StandardModel({module:"RfrlMgr"});b.set({status:"FAILED"});b.set({socialConnectionId:e});b.set({invitationType:"LN"});b.call("SocialInvitatonSent",b,{add:!0,error:rwcore.showError,success:function(){}});rwcore.FYI(a.message)})}})})}},actionthree:function(){alert("ActionThree")}});
j.PhotoGallery=j.FormView.extend({events:{"click [next]":"next"},next:function(){var a=c(".activePhoto"),b=a.next("li");0<b.length?(b.attr("id"),a.animate({left:"-=2000"},500,function(){a.hide();a.removeClass("activePhoto");c("[prevphoto]").show()}),b.show(),b.animate({right:"+=2000"},500,function(){b.addClass("activePhoto");var a=b.next("li");0==a.length?c("[nextphoto]").hide():(a=a.find("img").attr("src"),(d.isUndefined(a)||d.isNull(a)||""==a||"undefined"==a)&&c("[nextphoto]").hide())})):c("[nextphoto]").hide()},
previous:function(){var a=c(".activePhoto"),b=a.prev("li");a.animate({right:"-=2000"},500,function(){a.hide();a.removeClass("activePhoto");c("[nextphoto]").show()});b.show();b.animate({left:"+=2000"},500,function(){b.addClass("activePhoto");0==b.prev("li").length&&c("[prevphoto]").hide()})},launchshow:function(a){var b=a.target.id;a=new j.PhotoGallery({model:this.model,applet:this.applet,templateHTML:"PhotoGalleryShow",showViewBar:!1});c("#slideshowcontainer").html(a.render(a.model).el);var e=!0;
c(".pGallery").children("li").each(function(){if(e)if(c(this).attr("id")==b){if(!1==c(this).hasClass("activePhoto")){c(this).addClass("activePhoto");c(this).css("right","0");c(this).show();var a=c(this).next();0==a.length?c("[nextphoto]").hide():(a=a.find("img").attr("src"),(d.isUndefined(a)||d.isNull(a)||""==a||"undefined"==a)&&c("[nextphoto]").hide())}e=!1}else c(this).removeClass("activePhoto"),c(this).css("left","-2000px"),c(this).css("right",""),c(this).hide(),c("[prevphoto]").show()});c("#slideshowcontainer").show()}});
j.SimpleView=n.View.extend({tagName:"div",options:null,initialize:function(a){this.options=a},render:function(a){c(this.el).html(d.template(this.options.template,{model:d.isUndefined(a)?this.model:a,options:this.options}));return this}});j.ChartView=n.View.extend({tagName:"div",id:Math.random().toString(36).substr(2,16),options:null,initialize:function(a){this.options=a;var b=void 0;d.isUndefined(a.chartName)?(b=a.seriesName,this.cType=a.chartType,this.title=!d.isUndefined(a.title)?a.title:"",this.seriesItemXlabel=
!d.isUndefined(a.seriesItemXlabel)?a.seriesItemXlabel:"",this.seriesLabel=!d.isUndefined(a.seriesLabel)?a.seriesLabel:""):(this.metaApplet=new m.RepoObjectModel({type:"ChartApplet",name:a.chartName}),b=this.metaApplet.get("series"),this.catLovType=this.metaApplet.get("LOVType"),this.clientSort=this.metaApplet.get("clientSort"),this.plotformat=this.metaApplet.get("plotformat"),this.cType=this.metaApplet.get("type"),this.seriesItemXlabel=this.metaApplet.get("series-item-xlabel"),this.seriesLabel=this.metaApplet.get("series-label"),
this.title=this.metaApplet.get("Title"),this.catformat=a.catformat,this.contextVars=a.contextVars,this.pointSelectFunction=a.pointSelectFunction);this.metaSeries=new m.RepoObjectModel({type:"ChartData",name:b});this.chartContainer=a.containerEl},events:{"click #showchart":"showchart"},showchart:function(){alert("1")},formatDataRequest:function(){var a={},b={};b.name=!d.isUndefined(this.metaApplet)?this.metaApplet.name:this.metaSeries.name;b.dataclass=this.metaSeries.get("dataclass");b.clientSort=
this.clientSort;b.filter=this.metaSeries.get("filter");this.addContextVars(b,a);b.groupby=this.metaSeries.get("groupby");var e=this.clientSort;if(c.hasVal(e)){var f={};f._id="CHRON"==e||"ALPHA"==e?1:-1;b.sort=f}b.sort=this.metaSeries.get("sort");a.chart=b;a.module="AnalyticsMgr";a.act="getChart";a.name=this.metaSeries.get("name");a.searchRequest=this.searchRequest;return a},addContextVars:function(a,b){var c=a.filter;!1==d.isArray(c)&&(c=[c]);if(!d.isUndefined(this.contextVars)&&!d.isUndefined(c))for(var f in this.contextVars)for(var h=
0;h<c.length;h++)thisF=c[h],thisF.hasOwnProperty("contextVar")&&thisF.contextVar==f&&(b[f]=this.contextVars[f])},getData:function(){var a=c.Deferred(),b=this.formatDataRequest(),e=b.chart.groupby,f=this,b=new rwcore.StandardCollection(b);c.when(b.sync()).done(function(b){var g=c.hasVal(e.joinfield)&&c.hasVal(e.joinfield.name)?e.joinfield.name:void 0,k=c.hasVal(g);if(k)if(k=g.split(","),1<k.length)for(var g={},j=0;j<k.length;j++)g[k[j]]=void 0;else g=k[0];var k=c.hasVal(g),m=e.unit,q=c.hasVal(m),p=
n,n=k?g:e.field.name,x=!d.isUndefined(e.aggregate.isCumulative)?!0:!1;c.hasVal(f.clientSort)&&"ALPHA"==f.clientSort&&(b.models=d.sortBy(b.models,function(a){return a.get(n)}));c.hasVal(f.clientSort)&&"DESC"==f.clientSort&&(b.models=d.sortBy(b.models,function(a){return a.get(e.aggregate.name)}),b.models.reverse());for(var r=[],w=0,j=0;j<b.length;j++){var B={},t=b.models[j].get("_id")[e.aggregate.name];d.isUndefined(t)&&(t=b.models[j].get("_id"));d.isObject(t)&&(t=t[e.field.name]);var s=B.name=t;if(k&&
d.isObject(g)&&!d.isUndefined(f.catformat)){var s={},u;for(u in g)s[u]=b.models[j].get(u);s.id=t}else k&&(s=b.models[j].get(g));if("No Value"==s||""==s||d.isObject(s)&&d.isUndefined(f.catformat))s="No "+p;c.hasVal(f.catLovType)&&(s=rwcore.getLovDisplayVal(f.catLovType,s));q&&("week"==m&&(s=c.getFirstDayOfWeek(t.year,t[m],0)),"month"==m&&(s=rwcore.getLovDisplayVal("MONGO_MONTH",t[m])+" "+t.year));B.display=s;w+=b.models[j].get(e.aggregate.name);B.y=x?w:b.models[j].get(e.aggregate.name);r[j]=B}a.resolve(r)}).fail(function(){a.reject()});
return a},render:function(){var a=this,b=c.hasVal(a.options.defaultHeight)?a.options.defaultHeight:600;c.when(a.getData()).done(function(e){var f=a.plotformat,h=a.cType,g=JSON.parse(JSON.stringify(c.wizardChartTemplates["column"==h?"bar":h]));"pie"==h&&!d.isUndefined(a.pointSelectFunction)&&(g.plotOptions.pie.point.events.click=a.pointSelectFunction);g.title.text=a.title;g.chart.renderTo=a.chartContainer;c("#"+a.chartContainer).height(b);if("bar"==h||"column"==h)g.xAxis.title.text=a.seriesItemXlabel,
g.xAxis.categories=d.map(e,function(a){return a.display}),g.yAxis.title.text=a.yAxisTitle,g.series[0].data=e,g.series[0].name=a.seriesLabel,d.isUndefined(a.catformat)||(g.xAxis.labels.formatter=a.catformat),c.hasVal(f)&&(g.plotOptions.bar.dataLabels.format="{point.y:.2f}");"pie"==h&&(g.series[0].data=d.map(e,function(a){return{name:a.display,y:a.y,id:a.name}}),g.series[0].name=a.seriesLabel);"column"==h&&(g.chart.type="column",g.series[0].pointWidth=40);"bar"==h&&(g.chart.type="bar",g.series[0].pointWidth=
30,6<g.series[0].data.length&&(e=70*(g.series[0].data.length-9),f=c("#"+a.chartContainer).height(),c("#"+a.chartContainer).height(f+e)));chart=new Highcharts.Chart(g);return a})}});j.ChartWizardView=n.View.extend({tagName:"div",id:Math.random().toString(36).substr(2,16),options:null,initialize:function(a){this.options=a;this.meta=a.meta;this.chartContainer="chartContainer";this.yAxisTitle="Total"},events:{"click #showchart":"showchart"},showchart:function(){alert("1")},getData:function(){var a=c.Deferred(),
b={},e={};b.name=this.meta.get("dataclass")+"Chart";b.dataclass=this.meta.get("dataclass");var f={field:{name:""},aggregate:{name:"",fn:""}};f.field.name=this.meta.get("groupByField");f.aggregate.name=this.meta.get("groupByField");f.aggregate.label=this.meta.get("groupByDisplay");f.aggregate.fn=this.meta.get("fn");f.aggregate.value=this.meta.get("fnField");c.hasVal(this.meta.get("unit")&&"nothing"!=this.meta.get("unit"))&&(f.aggregate.unit=this.meta.get("unit"));if(c.hasVal(this.meta.get("joinName"))){var h=
{};h.name=this.meta.get("joinName");h.onKey=this.meta.get("joinOn");h.toKey=this.meta.get("joinTo");h.toCollection=this.meta.get("joinColl");f.joinfield=h}var h=this.meta.get("searchapplet"),g=new j.FormView({applet:h});b.admin="true";b.filter=!d.isUndefined(g.metaApplet.model.get("searchSpec"))?g.metaApplet.model.get("searchSpec").filter:void 0;b.groupby=f;if(c.hasVal(this.meta.get("orderBy"))&&!c.hasVal(this.meta.get("joinName"))){var g="CHRON"==this.meta.get("orderBy")||"ALPHA"==this.meta.get("orderBy")?
1:-1,k={};k._id=g;b.sort=k}c.hasVal(this.meta.get("limit"))&&(b.limit=this.meta.get("limit"));e.chart=b;this.meta=rwApp.getReportModel({baseModel:this.meta,sActor:this.meta.get("sActor"),sBC:this.meta.get("sBC"),sBO:this.meta.get("sBO")});e.searchRequest=rwApp.parseSavedSearch(this.meta,h);e.module=this.meta.get("actor");e.act="getChart2";e.name=this.meta.get("series");var l=c.hasVal(this.meta.get("joinName"))?this.meta.get("joinName"):f.field.name,m=this,b=new rwcore.StandardCollection(e);c.when(b.sync()).done(function(b){var e=
m.meta.get("joinName"),g=c.hasVal(e),h=m.meta.get("unit"),k=c.hasVal(h),j=m.meta.get("groupByDisplay"),n="true"==m.meta.get("isCumulative")?!0:!1;"ALPHA"==m.meta.get("orderBy")&&c.hasVal(m.meta.get("joinName"))&&(b.models=d.sortBy(b.models,function(a){return a.get(l)}));"DESC"==m.meta.get("orderBy")&&(b.models=d.sortBy(b.models,function(a){return a.get(f.aggregate.name)}),b.models.reverse());for(var t=[],s=0,u=0;u<b.length;u++){var v={},z=b.models[u].get("_id")[f.aggregate.name];d.isUndefined(z)&&
(z=b.models[u].get("_id"));var y=v.name=z;g&&(y=b.models[u].get(e));if("No Value"==y||""==y||d.isObject(y))y="No "+j;k&&("week"==h&&(y=c.getFirstDayOfWeek(z.year,z[h],0)),"month"==h&&(y=rwcore.getLovDisplayVal("MONGO_MONTH",z[h])+" "+z.year));v.display=y;s+=b.models[u].get(f.aggregate.name);v.y=n?s:b.models[u].get(f.aggregate.name);t[u]=v}a.resolve(t)}).fail(function(){a.reject()});return a},render:function(a){c.hasVal(a)&&(this.meta=a);var b=this;c.when(b.getData()).done(function(a){var f=b.meta,
h=f.get("chartType"),g=c.wizardChartTemplates["column"==h?"bar":h];g.title.text=f.get("reportName");g.chart.renderTo=b.chartContainer;c("#"+b.chartContainer).height(600);if("bar"==h||"column"==h)g.xAxis.title.text=f.get("groupByDisplay"),g.xAxis.categories=d.map(a,function(a){return a.display}),g.yAxis.title.text=b.yAxisTitle,g.series[0].data=a,g.series[0].name=f.get("metricName");"pie"==h&&(g.series[0].data=d.map(a,function(a){return{name:a.display,y:a.y,id:a.name}}),g.series[0].name=f.get("metricName"));
"column"==h&&(g.chart.type="column",g.series[0].pointWidth=40);"bar"==h&&(g.chart.type="bar",g.series[0].pointWidth=30,6<g.series[0].data.length&&(a=30*(g.series[0].data.length-6),f=c("#chartContainer").height(),b.defChartHeight=f,c("#chartContainer").height(f+a)));chart=new Highcharts.Chart(g);return b})}});return j}(v,C,H,D,E,F,G||window.jQuery||window.Zepto||window.ender);return v.ReferralWireView});
