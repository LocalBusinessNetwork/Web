(function(a,g){if("object"===typeof exports){var h=require("jquery"),j=require("underscore"),c=require("backbone");require("rwcore");module.exports=g(h,j,c,rwcore)}else"function"===typeof define&&define.amd&&define(["jquery","underscore","backbone","rwcore"],g)})(this,function(a,g,h,j){var c=j||window.jQuery||window.Zepto||window.ender,f={resetPasswordTemplate:{location:"/Templates/custom/resetPasswordTemplate.html",value:null}};f.Router=h.Router.extend({params:"",routes:{passwordReset:"passwordReset",
"*actions":"defaultRoute"},defaultRoute:function(){if(g.isNull(rwFB.loginEmail)||g.isEmpty(rwFB.loginEmail))rwFB.loginEmail=localStorage.getItem("rwLoginId");rwFB.loginEmail&&(a("#loginForm #login").val(rwFB.loginEmail),rwFB.loginChecked=!0)},register:function(){if(!a.hasVal(a("#registerForm #login").val())||!a.hasVal(a("#registerForm #password").val())||!a.hasVal(a("#registerForm #firstName").val())||!a.hasVal(a("#registerForm #lastName").val()))c.FYI("Please fill in all the required information");
else if(c.validEmail(a("#registerForm #login").val()))if(6>a("#registerForm #password").val().length)c.FYI("<h4> Weak Password </h4> Password should be 6 letters or more. Please use Alpha Numerics. <p> Example: Abc1Xyz2");else{var b={module:"SecMgr",act:"create",login:a("#registerForm #login").val(),password:a("#registerForm #password").val(),firstName:a("#registerForm #firstName").val(),lastName:a("#registerForm #lastName").val(),postalCodeAddress_work:a("#registerForm #postalCode").val(),invitationId:a("#registerForm #invitationId").val(),
tenant:rwApp.tenant},b=a.ajax({type:"POST",url:"/rwWebRequest?",async:!1,cache:!0,dataType:"json",data:{data:JSON.stringify(b)}});b.done(function(){window.localStorage.setItem("rwLoginId",a("#registerForm #login").val());-1<rwFB.OSType.indexOf("IPHONE")?window.location="/"+rwFB.tenant+"/Templates/Other/iphoneWelcome.html":-1<rwFB.OSType.indexOf("ANDROID")?window.location="/"+rwFB.tenant+"/Templates/Other/androidWelcome.html":(c.FYI("Congratulations, Your account has been registered a confirmation email has been sent to your email address."),
window.location="/rw.jsp#home")});b.fail(c.showError)}else c.FYI("<h4>Login Email should be a valid email address</h4> Example: bob@acme.com. <p>You Login email address will be used to communicate with you.")},login:function(){var b=a("#login").val();6>b.length||!c.validEmail(b)?c.FYI("<h4>Login Email should be a valid email address</h4> Example: bob@acme.com."):6>a("#password").val().length?c.FYI("<h4>Password is short</h4> Your password should be atleast 6 letters long"):(b=a("#loginForm").serialize(),
b=a.ajax({type:"POST",url:"/rwWebRequest?module=SecMgr&",async:!1,cache:!0,dataType:"json",data:b}),b.done(function(){window.localStorage.setItem("rwLoginId",a("#loginForm #login").val());window.location="/rw.jsp#home"}),b.fail(function(a,b,f){c.showError(a,b,f)}))},checkLoginExists:function(b){var e=a.Deferred(),d=b.val();if(6>d.length||!c.validEmail(d))c.FYI("<h4>Login Email should be a valid email address</h4> Example: bob@acme.com. <p>You Login email address will be used to communicate with you."),
e.reject();else return d=new c.StandardModel({module:"SecMgr"}),d.set({login:b.val()}),b=d.call("confirmLoginId",d),a.when(b).done(function(){c.FYI("<h4>This Login Email has already been registered.</h4> We sent you an email at the time of registration with your login information. Please check your email folders including junk folders to locate it. Or goto login screen, request a password reset.");e.reject()}).fail(function(){e.resolve()}),e},help:function(a){c.FYI("help"+a)},passwordReset:function(){(new f.passwordResetWizard({})).render()},
initialize:function(a){this.params=a.params;this.homepage=a.homepage;this.tenant=a.tenant;this.OStype=a.OStype;c.init(a)}});f.passwordResetWizard=h.View.extend({options:null,initialize:function(a){this.options=a},events:{"click #confirmLogin":"confirmLogin","click #resetPassword":"resetPassword"},confirmLogin:function(b){var e=a("#resetpw_login").val();if(6>e.length||!c.validEmail(e))c.FYI("<h4>Login Email should be a valid email address</h4> Example: bob@acme.com.");else{var d=new c.StandardModel({module:"SecMgr"});
d.set({login:e});e=d.call("confirmLoginId",d);a.when(e).done(function(){a("#Step1").hide(0);a("#Step2").show(0);promise.reject()}).fail(function(a,b,d){c.showError(esponse,b,d)});b.preventDefault()}},resetPassword:function(b){var e=b.data,d=new c.StandardModel({module:"SecMgr"});d.set({login:a("#resetpw_login").val()});d.call("resetPassword",d,{add:!0,error:c.showError,success:function(){e.cancel()}});b.preventDefault()},cancel:function(){a("#PopupContainer").hide(0);a("#PopupContainer").html("");
a("#pickBackground").hide(0);rwApp.navigate("/",{trigger:!0})},render:function(){new c.StandardModel({module:"SecMgr"});g.isNull(f.resetPasswordTemplate.value)&&(f.resetPasswordTemplate.value=c.getTemplate(f.resetPasswordTemplate.location));var b=g.template(f.resetPasswordTemplate.value,{});a("#PopupContainer").html(b).trigger("create");a("#PopupContainer").on("click","#confirmLogin",this,this.confirmLogin);a("#PopupContainer").on("click","#resetPassword",this,this.resetPassword);a("#PopupContainer").on("click",
"#CancelResetTxn",this,this.cancel);a("#pickBackground").show(0);a("#PopupContainer").show(0);return this}});h.RWAuth=RWAuth=f;return h.RWAuth});
