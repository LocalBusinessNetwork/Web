(function(b,f){if("object"===typeof exports){var m=require("jquery"),p=require("underscore"),q=require("backbone"),a=require("ReferralWireRouterBase");module.exports=f(m,p,q,a)}else"function"===typeof define&&define.amd&&define(["jquery","underscore","backbone","ReferralWireRouterBase"],f)})(this,function(b,f,m,p){p=(p||window.jQuery||window.Zepto||window.ender).extend({routes:{home:"home",phoneRefInbox:"phoneRefInbox","Refer/:id":"Refer","ContactProfile/:id":"ContactProfile","ContactPartnerProfile/:id":"ContactPartnerProfile",
"ContactNativeProfile/:id":"ContactNativeProfile","PhonePartnerContact/:id":"PhonePartnerContact","lookupPartnerProfile/:id":"lookupPartnersPhone","lookupContactProfile/:partyId":"lookupContactPhone","lookupPartnerProfile/:partyId/:partyType":"lookupPartnerPhone_P2P","phoneQualifications/:id":"phoneQualifications","phonePhotos/:id":"phonePhotos","phoneTestimonials/:id":"phoneTestimonials",membersalt:"members",members:"members","members/:id":"members",nearMeAlt:"nearMe",nearMe:"nearMe","memberProfile/:id":"PhoneMemberContact",
"PhoneMemberContact/:id":"PhoneMemberContact","phoneMemberQualifications/:id":"phoneMemberQualifications","phoneMemberPhotos/:id":"phoneMemberPhotos","phoneMemberTestimonials/:id":"phoneMemberTestimonials",phoneOrgList:"phoneOrgList","phoneOrgList/:id":"phoneOrgList","phoneOrgDetails/:id":"phoneOrgDetails","phoneOrgMembers/:id":"phoneOrgMembers","phoneOrgPhotos/:id":"phoneOrgPhotos","phoneOrgEvents/:id":"phoneOrgEvents","OrgEvents/:id":"phoneOrgEvents","EventExpected/:id":"phoneEvent","phoneEventExpected/:id":"phoneEventExpected",
"phoneEventCheckedIn/:id":"phoneEventCheckedIn","phoneEventGuests/:id":"phoneEventGuests",phoneUpcomingEvents:"phoneUpcomingEvents","phoneUpcomingEvents/id":"phoneUpcomingEvents",phoneRefOutbox:"phoneRefOutbox","/:toPartyId":"",partners:"partners","partners/:id":"partners",referrals:"referrals",contacts:"contacts","editPhoneContactWork/:id":"editPhoneContactWork","editPhoneContactPartnerHome/:id":"editPhoneContactPartnerHome","ContactProfileFromParty/:id":"ContactProfileFromPartyId",signout:"signout"},
Refer:function(){},renderPhoneScreen:function(a){var c=b.hasVal(a.listItemClass)?a.listItemClass:"phoneListItem",j=a.viewBarApplet,e=b.hasVal(a.suppressBack)&&a.suppressBack?!0:!1,g=ReferralWireView.ChildViewContainer.findByCustom("phoneView");!f.isUndefined(g)&&"object"==typeof g&&g.undelegateEvents();var d=null,n=null,h=null,l=null,g=null;if(!b.hasVal(a.mainRenderer)||"ListView"==a.mainRenderer)d=new ReferralWireView.ListView({applet:a.listAppletName,upsertTemplate:a.upsertTemplate,template:a.listTemplateHTML,
filter:a.setFilter,refreshRoute:a.refreshRoute,routeIdField:a.routeIdField,usePaging:a.usePaging,noRecordsMsg:a.noRecordsMsg,clientSideSortAttr:a.clientSideSortAttr,listItemClass:c,formRoute:""});b.hasVal(a.mainRenderer)&&"FormView"==a.mainRenderer&&(d=new ReferralWireView.FormView({applet:a.formAppletName,upsertTemplate:a.upsertTemplate,templateHTML:a.templateHTML,refreshRoute:a.refreshRoute,routeIdField:a.routeIdField,refreshFunction:a.refreshFunction}));b.hasVal(a.mainRenderer)&&"ReferralMgmtListView"==
a.mainRenderer&&(d=new ReferralWireView.ReferralMgmtListView({applet:a.listAppletName,template:a.listTemplateHTML,listItemClass:c,filter:a.setFilter,formRoute:""}));b.hasVal(a.mainRenderer)&&"PhotoGallery"==a.mainRenderer&&(d=new ReferralWireView.PhotoGallery({applet:a.formAppletName,templateHTML:a.templateHTML}));var k=b.hasVal(j)?new ReferralWireView.FormView({applet:a.viewBarApplet,clickRoute:a.clickRoute,templateHTML:"StdForm",showViewBar:!0,model:b.hasVal(a.viewBarModel)?a.viewBarModel:d.model,
viewBarTemplate:"ActionBarTemplate"}):null;b.hasVal(a.appletMenu)&&(n=new ReferralWireView.FormView({applet:a.appletMenu,templateHTML:"PhoneAppletMenu",viewBarTemplate:"PhoneAppletMenu",model:d.model,showViewBar:!0}));b.hasVal(a.formapplet2)&&(h=new ReferralWireView.FormView({applet:a.formapplet2,templateHTML:"CollapseFormNarrow"}));b.hasVal(a.formapplet3)&&(l=new ReferralWireView.FormView({applet:a.formapplet3,templateHTML:"CollapseFormNarrow"}));b.hasVal(a.childListApplet)&&(g=new ReferralWireView.ListView({applet:a.childListApplet,
clientSideSortAttr:a.clientSideSortAttr,model:a.childListModel,template:a.listTemplateHTML,filter:!f.isUndefined(a.filter)&&a.filter?!0:!1,usePaging:a.usePaging,listItemClass:a.listItemClass,formRoute:""}),b.hasVal(a.clientSideSortAttr)&&b.hasVal(a.childListModel)&&g.setModel(a.childListModel));b.hasVal(a.newRecord)&&!1!=a.newRecord&&(d.setDefaultModel(),a.model=d.model);if(b.hasVal(a.model))d.model=a.model,b.hasVal(k)&&(k.model=d.model),b.hasVal(n)&&(n.model=d.model),b.hasVal(h)&&(h.model=d.model),
b.hasVal(l)&&(l.model=d.model),c=new q({el:"#ContentSection",viewTemplate:a.viewTemplate,listView:d,formView2:h,formView3:l,childList:g,viewClass:a.viewClass,viewBar:k,upsertApplet:a.upsertApplet,route:!f.isUndefined(a.route)?a.route:a.clickRoute,refWizard:a.refWizard,upsertWizard:a.upsertWizard,contextMenu:a.contextMenu,noRecordsMsg:a.noRecordsMsg,parentDefaultVals:a.parentDefaultVals,savedSearch:a.savedSearch,appletMenu:n}),ReferralWireView.ChildViewContainer.add(c,"phoneView"),c.render(),f.isUndefined(g.options.usePaging)||
(b("#"+g.id).on("listviewbeforefilter",g,g.textSearchHandler),b("#"+g.id).on("scroll",g,g.scrollHandler),b(".phone-master-detail").addClass("phoneMDSearchList")),b("#title").html(a.title);else{var s=this;(new rwcore.StandardCollection({module:d.actor,searchSpec:b.hasVal(a.searchSpec)?a.searchSpec:d.searchSpec,id:a.id,act:a.act,bc:a.bc,bo:a.bo,calculatedFields:a.calculatedFields,shape:!f.isUndefined(a.shape)?a.shape:"ListView"==a.mainRenderer?"Skinny":void 0,sortby:a.sortby,limit:f.isUndefined(a.usePaging)?
void 0:rwcore.pagingSize,sortOrder:f.isUndefined(a.sortOrder)?"ASC":a.sortOrder})).fetch({add:!0,error:rwcore.showError,success:function(c){f.isUndefined(a.cc)||(s.phoneContactsCollection=a.cc,c.add(a.cc.models));b.hasVal(a.formAppletName)?d.model=c.models[0]:d.setModel(c);b.hasVal(k)&&(k.model=d.model);b.hasVal(n)&&(n.model=d.model);b.hasVal(h)&&(h.model=d.model);b.hasVal(l)&&(l.model=d.model);c=new q({el:"#ContentSection",viewTemplate:a.viewTemplate,listView:d,formView2:h,formView3:l,viewBar:k,
upsertWizard:a.upsertWizard,route:!f.isUndefined(a.route)?a.route:a.clickRoute,contextMenu:a.contextMenu,viewClass:a.viewClass,refWizard:a.refWizard,upsertApplet:a.upsertApplet,parentDefaultVals:a.parentDefaultVals,savedSearch:a.savedSearch,appletMenu:n});e||b("#backBtn").show(10);ReferralWireView.ChildViewContainer.add(c,"phoneView");c.render();f.isUndefined(d.options.usePaging)||(b("#"+d.id).on("listviewbeforefilter",d,d.textSearchHandler),b("#"+d.id).on("scroll",d,d.scrollHandler));b("#title").html(a.title)}})}},
loadPhonePage:function(){},phoneOrgList:function(){this.renderPhoneScreen({el:this.params.modules[1],mainRenderer:"ListView",listTemplateHTML:"PhoneChapterList",listAppletName:"OrganizationAppletList",usePaging:!0,title:"Chapters",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneStdViewList",sortby:"businessName"})},phoneOrgDetails:function(a){this.renderPhoneScreen({formAppletName:"OrganizationShortForm",templateHTML:"PhoneChapterProfile",id:a,viewBarApplet:"OrgPhoneViewBar",mainRenderer:"FormView",
title:"Chapter Detail",clickRoute:"phoneOrgDetails",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneStdView",contextMenu:{icon:rwFB.CDN+"/images/icons/joinChapterIcon.png",action:"joinchapter",hideIf:function(a){return a.get("id")==rwFB.OrgId?!0:!1}}})},phoneOrgMembers:function(a){var b=this;(new rwcore.StandardCollection({module:"OrgMgr",id:a})).fetch({add:!0,error:rwcore.showError,success:function(j){var e=j.models[0];(new rwcore.StandardCollection({module:"PartyMgr",searchSpec:{filter:[{ftype:"expr",
expression:"{OrgId : '"+a+"'}"}]},shape:"Skinny",sortby:"fullName",sortOrder:"ASC"})).fetch({add:!0,error:rwcore.showError,success:function(a){b.renderPhoneScreen({templateHTML:"PhoneChapterMaster",listTemplateHTML:"PhoneMemberList",childListApplet:"MemberAppletList",childListModel:a,title:"Chapter Members",clickRoute:"phoneOrgMembers",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneMasterDetailView",mainRenderer:"FormView",formAppletName:"OrganizationShortForm",model:e,viewBarApplet:"OrgPhoneViewBar"})}})}})},
phoneOrgPhotos:function(a){this.renderPhoneScreen({formAppletName:"ChapterImages",templateHTML:"PhoneChapterProfile",id:a,viewBarApplet:"OrgPhoneViewBar",clickRoute:"phoneOrgPhotos",mainRenderer:"PhotoGallery",templateHTML:"PhotoGalleryThumbsNoEdit",title:"Chapter Photos",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneStdView"})},phoneOrgEvents:function(a){var c=this;rwApp.fetchParentChildren({parentModule:"OrgMgr",masterRecordId:a,childModule:"EventMgr",childBC:"Event",clientFKFilter:!0,parentKeyField:"id",
detailSearchSpec:{OrgId:"id"},searchSpec:{filter:[{ftype:"time",fieldname:"datetime",period:"80640"}]},sortby:"datelong",sortOrder:"DESC"}).done(function(a){c.renderPhoneScreen({templateHTML:"PhoneChapterMaster",listTemplateHTML:"EventList",childListApplet:"EventList",childListModel:a.childModel,title:"Chapter Events",clickRoute:"phoneOrgEvents",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneMasterDetailView",mainRenderer:"FormView",formAppletName:"OrganizationShortForm",model:a.parentModel,
viewBarApplet:"OrgPhoneViewBar",upsertApplet:"EventNewForm",parentDefaultVals:{OrgId:"id",locationName:"establishmentName",logoUrl:"logoUrl",datetime:{functionName:b.calcNextMeeting,functionArg:["meetingDayOfWeek","meetingHour"]},date:{functionName:b.calcNextMeetingDate,functionArg:["meetingDayOfWeek"]},day:{functionName:b.calcNextMeetingDay,functionArg:["meetingDayOfWeek"]},title:"businessName",streetAddress1_work:"streetAddress1_work",cityAddress_work:"cityAddress_work",stateAddress_work:"stateAddress_work",
postalCodeAddress_work:"postalCodeAddress_work"},contextMenu:{icon:rwFB.CDN+"/STN/Images/phoneNewRecord.png",action:"addChild",hideIf:function(a){return b.hasAccess({record:a,routeName:"phoneOrgEvents",privilege:"add"})?!1:!0}}})})},phoneUpcomingEvents:function(){var a=[],c=rwFB.postalCode;a[0]={ftype:"time",period:"120",max:"10080",fieldname:"datetime"};b.hasVal(c)&&(a[1]={ftype:"proximity",from:c,distance:50});this.renderPhoneScreen({el:this.params.modules[1],sortby:"datetime",mainRenderer:"ListView",
searchSpec:{filter:a},calculatedFields:{dayName:function(a){a=f.isObject(a.get("datetime"))?a.get("datetime").$date:a.get("datetime");var b=rwcore.getLovDisplayVal("WEEKDAY",(new Date(a)).getDay());return b+=", "+dateFormat(new Date(a),"mmm d")},orgPhotoUrl:function(a){return a.get("photoUrl")}},usePaging:!0,listTemplateHTML:"PhoneAllEventList",listAppletName:"UpcomingEventList",title:"Upcoming Events",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneStdViewList"})},phoneEvent:function(a){this.renderPhoneScreen({formAppletName:"EventNewForm",
templateHTML:"PhoneEventFormNarrow",id:a,viewBarApplet:"PhoneAttendeeViewBar",bc:"Event",bo:"Event",act:"readphone",clickRoute:"EventExpected",mainRenderer:"FormView",title:"Event Detail",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneStdView",upsertApplet:"EventEditForm",contextMenu:{icon:rwFB.CDN+"/STN/Images/phoneEditButton.png",action:"editRecord",hideIf:function(a){return b.hasAccess({record:a,routeName:"phoneEvent",privilege:"editFull"})?!1:!0}}})},phoneEventExpected:function(a){var c=
this;rwApp.fetchParentChildren({parentModule:"EventMgr",parentBC:"Event",masterRecordId:a,childModule:"AttendeeMgr",childBC:"Attendee",clickRoute:"phoneEventExpected",clientFKFilter:!0,sortby:"fullName_denorm",limit:rwcore.pagingSize,parentKeyField:"id",detailSearchSpec:{eventId:"id"},searchSpec:{filter:[{ftype:"expr",expression:"{status : 'INVITED'}"}]}}).done(function(a){c.renderPhoneScreen({templateHTML:"PhoneEventMaster",listTemplateHTML:rwApp.getTemplate,childListApplet:"AttendeeExpectedList",
childListModel:a.childModel,title:"Expecting",clickRoute:"phoneEventExpected",filter:!0,usePaging:!0,listItemClass:"rw_listitem buttonright",viewTemplate:"PhoneMasterDetailView",mainRenderer:"FormView",formAppletName:"EventNewForm",model:a.parentModel,viewBarApplet:"PhoneAttendeeViewBar",contextMenu:{icon:rwFB.CDN+"/STN/Images/addGuestButton.png",action:"addGuest",hideIf:function(a){var c=b.hasAccess({record:a,routeName:"phoneEventExpected",privilege:"editFull"});c||(c=b.hasAccess({record:a,routeName:"phoneEventExpected",
privilege:"addGuest"}));return c?!1:!0}}})})},phoneEventCheckedIn:function(a){var c=this;rwApp.fetchParentChildren({parentModule:"EventMgr",parentBC:"Event",masterRecordId:a,childModule:"AttendeeMgr",childBC:"Attendee",clickRoute:"phoneEventCheckedIn",clientFKFilter:!0,sortby:"fullName_denorm",limit:rwcore.pagingSize,parentKeyField:"id",detailSearchSpec:{eventId:"id"},searchSpec:{filter:[{ftype:"expr",expression:"{status : 'CHECKEDIN'}"}]}}).done(function(a){c.renderPhoneScreen({templateHTML:"PhoneEventMaster",
listTemplateHTML:rwApp.getTemplate,childListApplet:"AttendeeExpectedList",childListModel:a.childModel,title:"Checked In",filter:!0,usePaging:!0,listItemClass:"rw_listitem buttonright",clickRoute:"phoneEventCheckedIn",viewTemplate:"PhoneMasterDetailView",mainRenderer:"FormView",formAppletName:"EventNewForm",model:a.parentModel,viewBarApplet:"PhoneAttendeeViewBar",contextMenu:{icon:rwFB.CDN+"/STN/Images/addGuestButton.png",action:"addGuest",hideIf:function(a){var c=b.hasAccess({record:a,routeName:"phoneEventExpected",
privilege:"editFull"});c||(c=b.hasAccess({record:a,routeName:"phoneEventExpected",privilege:"addGuest"}));return c?!1:!0}}})})},phoneEventGuests:function(a){var c=this;rwApp.fetchParentChildren({parentModule:"EventMgr",parentBC:"Event",masterRecordId:a,childModule:"AttendeeMgr",childBC:"Attendee",clickRoute:"phoneEventGuests",clientFKFilter:!0,parentKeyField:"id",detailSearchSpec:{eventId:"id"},searchSpec:{filter:[{ftype:"expr",expression:"{guestType : {$in:['FLOATER','NEW_MEMBER']}}"},{ftype:"expr",
expression:"{status : 'CHECKEDIN'}"}]}}).done(function(a){c.renderPhoneScreen({templateHTML:"PhoneEventMaster",listTemplateHTML:rwApp.getTemplate,childListApplet:"AttendeeExpectedList",childListModel:a.childModel,title:"Guests",clickRoute:"phoneEventGuests",viewTemplate:"PhoneMasterDetailView",mainRenderer:"FormView",formAppletName:"EventNewForm",model:a.parentModel,viewBarApplet:"PhoneAttendeeViewBar",contextMenu:{icon:rwFB.CDN+"/STN/Images/addGuestButton.png",action:"addGuest",hideIf:function(a){var c=
b.hasAccess({record:a,routeName:"phoneEventExpected",privilege:"editFull"});c||(c=b.hasAccess({record:a,routeName:"phoneEventExpected",privilege:"addGuest"}));return c?!1:!0}}})})},fetchParentChildren:function(a){this.options=a;this.promise=b.Deferred();var c=this,j={};(new rwcore.StandardCollection({module:c.options.parentModule,bc:c.options.parentBC,bo:c.options.parentBC,shape:"Skinny",id:c.options.masterRecordId})).fetch({add:!0,error:rwcore.showError,success:function(e){var g=e.models[0],d;d=
"{ZFKeyName : 'ZFKeyValue'}".replace("ZFKeyName",c.options.parentKeyField);d=d.replace("ZFKeyValue",c.options.masterRecordId);e={masterRecordId:a.masterRecordId,module:c.options.childModule,act:a.act,searchSpec:b.hasVal(a.searchSpec)?a.searchSpec:b.hasVal(dview.searchSpec)?dview.searchSpec:void 0,sortby:c.options.sortby,bc:c.options.childBC,bo:c.options.childBC,limit:c.options.limit,sortOrder:f.isUndefined(a.sortOrder)?"ASC":a.sortOrder};if(!f.isUndefined(c.options.detailSearchSpec))for(var n=Object.keys(c.options.detailSearchSpec),
h=0;h<n.length;h++){var l=n[h],k=c.options.detailSearchSpec[n[h]];b.hasVal(c.options.parentKeyField)&&a.parentKeyField==k&&(k=g.get(k),c.options.clientFKFilter?(d="{ZKeyField : 'ZValue'}",d=d.replace("ZKeyField",l),d=d.replace("ZValue",k),d={ftype:"expr",expression:d},b.hasVal(e.searchSpec)?(f.isArray(e.searchSpec.filter)||(e.searchSpec.filter=[e.searchSpec.filter]),e.searchSpec.filter[e.searchSpec.filter.length]=d):e.searchSpec={filter:[d]}):e[l]=k)}(new rwcore.StandardCollection(e)).fetch({add:!0,
error:rwcore.showError,success:function(a){g.clickRoute=c.options.clickRoute;a.clickRoute=c.options.clickRoute;j.parentModel=g;j.childModel=a;c.promise.resolve(j)}})}});return this.promise},partners:function(){this.renderPhoneScreen({el:this.params.modules[1],listTemplateHTML:"PhonePartnerList",listAppletName:"PartnerAppletList",title:"Partners",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhonePageNoViewBar",clientSideSortAttr:"firstName"})},PhonePartnerContact:function(a){var b=rwApp.ContactRefWizard_partnerRefWizard();
this.renderPhoneScreen({refWizard:b,formAppletName:"PartnerAppletForm",templateHTML:"PhoneStdForm",id:a,viewBarApplet:"PhonePartnerContactViewBar",appletMenu:"PartnerPhoneReferAppletMenu",mainRenderer:"FormView",title:"Partner Info",viewTemplate:"PhoneStdView"})},phoneQualifications:function(a){var b=rwApp.ContactRefWizard_partnerRefWizard();this.renderPhoneScreen({formAppletName:"PhonePartnerProfile",templateHTML:"PhonePartnerProfile",id:a,viewBarApplet:"PhonePartnerQualificationsViewBar",mainRenderer:"FormView",
title:"About",appletMenu:"PartnerPhoneReferAppletMenu",viewTemplate:"PhoneStdView",refWizard:b,viewClass:"qualifications"})},phonePhotos:function(a){var b=rwApp.ContactRefWizard_partnerRefWizard();this.renderPhoneScreen({formAppletName:"PartnerImages",viewBarApplet:"PhonePartnerPhotosViewBar",id:a,mainRenderer:"PhotoGallery",title:"Photos",templateHTML:"PhotoGalleryThumbsNoEdit",viewTemplate:"PhoneStdView",appletMenu:"PartnerPhoneReferAppletMenu",refWizard:b})},phoneTestimonials:function(a){var b=
rwApp.ContactRefWizard_partnerRefWizard();this.renderPhoneScreen({formAppletName:"Testimonials",viewBarApplet:"PhonePartnerTestimonialsViewBar",id:a,mainRenderer:"FormView",templateHTML:"TestimonialsDisplay",viewTemplate:"PhoneStdView",title:"Testimonials",appletMenu:"PartnerPhoneReferAppletMenu",refWizard:b})},members:function(){this.renderPhoneScreen({el:this.params.modules[1],listTemplateHTML:"PhoneMemberListBadges",listAppletName:"MemberAppletList",mainRenderer:"ListView",usePaging:!0,listItemClass:"rw_listitem hasBadges",
title:"All Members",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneStdViewList",sortby:"memberRankScore",sortOrder:"DESC",savedSearch:{searchGroup:"members",actor:"PartyMgr",bo:"Party",bc:"Party",searchAppletName:"MemberSearchForm",searchAppletTemplate:"SearchForm",title:"Member Search"},contextMenu:{icon:"/images/icons/advancedSearchWhitePhone.png",action:"launchSavedSearch"}})},nearMe:function(){var a=this;b.when(a.MarkAndTrackGPS({partyId:rwFB.uId})).always(function(){a.renderPhoneScreen({listTemplateHTML:"PhoneMemberListPP",
listAppletName:"MembersNearMeList",mainRenderer:"ListView",act:"NearMe",title:"Members Near Me Now",appletMenu:"PhoneAppletMenuSimple",viewTemplate:"PhoneStdViewList",sortby:"fullName",listItemClass:"powerpartner-li",noRecordsMsg:"No members near me now",contextMenu:{icon:"STN/Images/phoneRefreshIcon.png",action:"refreshView"}})})},PhoneMemberContact:function(a){this.renderPhoneScreen({formAppletName:"PartyAppletFormPublic",templateHTML:"PhoneStdMember",id:a,viewBarApplet:"PhoneMemberContactViewBar",
appletMenu:"PhoneAppletMenuMember",mainRenderer:"FormView",title:"Phone + Address",viewTemplate:"PhoneStdView",contextMenu:{icon:rwFB.CDN+"/images/icons/connectIcon.png",action:"invite",hideIf:function(a){return b.getConditionalConnected(a.get("id"),rwFB.uId,!0,!1,"connect")}}})},phoneMemberQualifications:function(a){var b={formAppletName:"PhoneMemberProfile",templateHTML:"PhoneMemberProfileBadges",id:a,viewBarApplet:"PhoneMemberQualificationsViewBar",mainRenderer:"FormView",title:"Qualifications",
upsertApplet:"PhoneProfileUpsert",upsertTemplate:"UpsertFormNarrow",refreshFunction:function(){rwApp.refreshTopView()},appletMenu:"PhoneAppletMenuMember",viewTemplate:"PhoneStdView",viewClass:"qualifications",contextMenu:{icon:rwFB.CDN+"/images/icons/connectIcon.png",action:"invite",hideIf:function(a){return a.get("id")==rwFB.uId?!0:!1}}};a==rwFB.uId&&(b.contextMenu.action="editRecord",b.contextMenu.icon="/images/icons/editPhoneIcon.png",b.contextMenu.hideIf=void 0);this.renderPhoneScreen(b)},phoneMemberPhotos:function(a){this.renderPhoneScreen({formAppletName:"MemberImages",
viewBarApplet:"PhoneMemberPhotosViewBar",id:a,mainRenderer:"PhotoGallery",title:"Photos",templateHTML:"PhotoGalleryThumbsNoEdit",viewTemplate:"PhoneStdView",appletMenu:"PhoneAppletMenuMember"})},phoneMemberTestimonials:function(a){this.renderPhoneScreen({formAppletName:"MemberTestimonials",viewBarApplet:"PhoneMemberTestimonialsViewBar",id:a,mainRenderer:"FormView",templateHTML:"TestimonialsDisplay",viewTemplate:"PhoneStdView",title:"Testimonials",appletMenu:"PhoneAppletMenuMember"})},referrals:function(){this.renderPhoneScreen(this.params.modules[1],
"ReferralList","StdThumbNailList","Referrals")},contacts:function(){that=this;rwApp.contactCache=null;that.renderPhoneScreen({el:rwApp.params.modules[1],listAppletName:"PhoneContactList",listTemplateHTML:rwApp.getContactListTemplPhone,title:"My Address Book",mainRenderer:"ListView",viewTemplate:"PhoneStdViewList",appletMenu:"ContactPhoneListAppletMenu",refreshRoute:"#contacts",upsertWizard:{viewTemplate:"WizardUpsertView",refreshFunction:rwApp.ContactProfileFromParty,stations:["Work","Home"],firstApplet:{name:"ProfessionalContactUpsertNoPhoto"},
nextAppletFunctions:{ProfessionalContactUpsertNoPhoto:function(){return{name:"PersonalContactInsert"}}}},cacheModel:"rwApp.contactCache",sortby:"fullName",usePaging:!0,cacheOptimize:"yes",contextMenu:{icon:rwFB.CDN+"/STN/Images/phoneAction.png",action:"launchContextMenu",contextMenu:[{id:"#wizardNew",route:"wizardNew",label:"New",iconSrc:"addIconLargeWhite.png"},{id:"#import",route:"importAddressBook",label:"Import",iconSrc:"importContacts.png"},{id:"#search",label:"Saved Searches",iconSrc:"advancedSearchWhitePhone.png",
route:"launchSavedSearch"}]},savedSearch:{searchGroup:"addressbook",actor:"PartnerMgr",bo:"Partner",bc:"Partner",searchAppletName:"AddressBookSearchForm",searchAppletTemplate:"SearchForm",title:"Addressbook Search"}})},ContactProfile:function(a){this.renderPhoneScreen({formAppletName:"ProfessionalContact",templateHTML:"PhoneStdFormContact",id:a,viewBarApplet:"ContactPhoneViewBar",appletMenu:"ContactPhoneProfileAppletMenu",mainRenderer:"FormView",upsertApplet:"PersonalContact",upsertTemplate:"UpsertFormNarrow",
title:"Contact Detail",refreshRoute:"#contacts",refWizard:rwApp.ContactRefWizard,upsertWizard:{viewTemplate:"WizardUpsertView",refreshFunction:rwApp.ContactProfileFromParty,stations:["Work","Home"],firstApplet:{name:"ProfessionalContactUpsertNoPhoto"},nextAppletFunctions:{ProfessionalContactUpsertNoPhoto:function(){return{name:"PersonalContactInsert"}}}},route:"ContactProfile",viewTemplate:"PhoneStdView",contextMenu:{icon:rwFB.CDN+"/STN/Images/phoneAction.png",action:"launchContextMenu",contextMenu:[{id:"#referContact",
route:"refer",label:"Refer",iconSrc:"newReferralWhite.png"},{id:"#inviteContact",route:"invite",label:"Invite",iconSrc:"invitationWhite.png"},{id:"#editContact",route:"wizardEdit",label:"Edit",iconSrc:"editWhiteLarge.png"},{id:"#deleteContact",route:"deleteItem",label:"Delete",iconSrc:"deleteLargeWhite.png"}]}})},ContactProfileFromParty:function(a){a=a.get("id");ContactProfileFromPartyId(a)},ContactProfileFromPartyId:function(a){(new rwcore.StandardModel({module:"PartnerMgr",partnerId:a})).fetch({add:!0,
success:function(a){partnerId=a.get("id");"REFERRAL_PARTNER"==a.get("type")?rwApp.navigate("#ContactPartnerProfile/"+partnerId,{trigger:!0,replace:!0}):rwApp.navigate("#ContactProfile/"+partnerId,{trigger:!0,replace:!0})}})},ContactPartnerProfile:function(a){this.renderPhoneScreen({formAppletName:"ProfessionalContactPartner",formapplet2:"PersonalContact",templateHTML:"PhoneStdFormContactPartner",id:a,viewBarApplet:"ContactPhoneViewBar",appletMenu:"ContactPhoneProfilePartnerAppletMenu",mainRenderer:"FormView",
upsertApplet:"PersonalContact",upsertTemplate:"UpsertFormNarrow",title:"Contact Detail",refWizard:rwApp.ContactRefWizard,route:"ContactPartnerProfile",viewTemplate:"PhoneStdView"})},editPhoneContactPartnerHome:function(a){rwApp.editPhoneContactHome(a,"ContactPartnerProfile","PersonalContact",null)},phoneRefInbox:function(){this.renderPhoneScreen({listAppletName:"ReferralInbox",act:"InBox",listTemplateHTML:rwApp.getReferralInboxHomeTemplate,viewBarApplet:"PhoneReferralInBoxViewBar",sortby:"rw_created_on",
sortOrder:"DESC",viewTemplate:"PhoneStdView",mainRenderer:"ReferralMgmtListView",appletMenu:"PhoneAppletMenuSimple",title:"Recently Received",suppressBack:!0,setFilter:!1})},phoneRefOutbox:function(){this.renderPhoneScreen({listAppletName:"ReferralOutboxPhone",listTemplateHTML:rwApp.getReferralOutboxHomeTemplate,act:"OutBox",viewBarApplet:"PhoneReferralOutBoxViewBar",sortby:"rw_created_on",sortOrder:"DESC",viewTemplate:"PhoneStdView",mainRenderer:"ReferralMgmtListView",appletMenu:"PhoneAppletMenuSimple",
title:"Recently Made",suppressBack:!0,setFilter:!1})},home:function(){var a=this;(new ReferralWire.HomePageModel).fetch({error:rwcore.showError,success:function(c){rwApp.uId=c.get("id");b.when(a.MarkAndTrackGPS({partyId:rwFB.uId})).always(function(){rwApp.zip=c.get("postalCodeAddress");var a=new ReferralWire.HomePageView({model:c,template:"STN_phonehome"});b("#backBtn").hide(10);b("#loginBackdrop").hide();b("#ContentSection").html(a.render().el).trigger("create");b("#title").html(rwFB.HeaderName);
a=f.template("PhoneNavPanel",{model:c,menuNav:[{id:"homeMenu",route:"#home",label:"Home",iconSrc:"homeIconSmall.png"},{id:"peopleGroup",label:"My Address Book",route:"#contacts",iconSrc:"contactCardsSmall.png"},{id:"members",route:"#members",iconSrc:"allMembers.png",label:"All Members"},{id:"nearMe",route:"#nearMeAlt",label:"Members Near Me",iconSrc:"nearMeIconWhite.png"},{id:"chaptersMenu",route:"#phoneOrgList",label:"Chapters",iconSrc:"chaptersWhite.png"}]})();b("#left-panel").html(a)})}})},getPhoneContacts:function(a){var b=
new ContactFindOptions;b.filter="";b.multiple=!0;navigator.contacts.find("name phoneNumbers emails addresses organizations photos".split(" "),function(b){a.success(b)},function(){alert("Error!")},b)},MarkAndTrackGPS:function(){var a=b.Deferred();a.resolve();return a},StartGeoLocationTracking:function(){}});var q=m.View.extend({initialize:function(a){this.options=a},events:{"click [togglestate]":"toggleReferral","tap [launchShow]":function(a){this.options.listView.launchshow(a)},"click [closeslideshow]":function(){b("#slideshowcontainer").hide()},
"tap [nextphoto]":function(a){this.options.listView.next(a)},"tap [prevphoto]":function(a){this.options.listView.previous(a)},"tap .pickPhoneContact":function(a){this.options.listView.pickPhoneContact(a)},"tap #refer":"refer","click [confirmation='true']":"updateField","click #menuButtonSave":function(a){a.options=this.options;this.options.listView.saveRecordPhone(a)},"tap #edit":"editRecord","tap #delete":"deleteItem","tap #wizardEdit":"wizardEdit","tap #wizardNew":"wizardNew","tap #addChild":"addChild",
"tap #import":"importAddressBook","click [contextAction]":"contextAction","tap #invite":"invite","click .eventselfcheckin":"selfcheckin","click .checkout":"checkout","click .checkin":"checkin","click #menuButtonCancel":"cancel","change select":function(a){this.options.listView.changeItem(a)},"change input":function(a){this.options.listView.hasOwnProperty("changeItem")&&this.options.listView.changeItem(a)},"change textarea":function(a){this.options.listView.changeItem(a)},"tap #share":"share","click #showNextRecords":function(){this.options.listView.showNextRecords()},
"click #showPreviousRecords":function(){this.options.listView.showPreviousRecords()}},launchSavedSearch:function(){(new ReferralWireView.SavedSearchPickView({searchGroup:this.options.savedSearch.searchGroup,parentView:this})).render()},applySavedSearch:function(a){var c="",c=""==a.get("searchName")?"Ad Hoc Search":a.get("searchName");this.searchModel=a;b(".savedSearchName").html(c);this.options.listView.model.options.searchModel=this.searchModel;this.options.listView.model.options.searchRequest=rwApp.parseSavedSearch(a,
this.options.savedSearch.searchAppletName);this.options.listView.model.options.searchText=void 0;this.options.listView.model.options.skip=void 0;b(this.options.listView.selector).html("");b(".hasAdvancedSearch .ui-input-search input").attr("value","");var j=rwApp.fetchList(this.options.listView.model.options),e=this;a.get("accessLevel");b(this.options.listView.selector).addClass("fetching");f.isUndefined(this.ChartView)||(this.ChartView.searchRequest=this.options.listView.model.options.searchRequest,
this.ChartView.render());e=this;j.done(function(a){e.options.listView.model=a;e.options.listView.pageNumber=1;e.options.listView.reDraw(a);b(e.options.listView.selector).removeClass("fetching");e.options.listMap&&e.renderListMap();b("#title").html(c)})},wizardEdit:function(){(new ReferralWireView.WizardUpsertView({firstApplet:this.options.upsertWizard.firstApplet,nextAppletFunctions:this.options.upsertWizard.nextAppletFunctions,viewTemplate:this.options.upsertWizard.viewTemplate,upsertmodel:this.options.listView.model,
stations:this.options.upsertWizard.stations,saveFunction:this.options.upsertWizard.saveFunction,parentView:this,wizardSpec:this.options.upsertWizard})).render()},wizardNew:function(){(new ReferralWireView.WizardUpsertView({firstApplet:this.options.upsertWizard.firstApplet,nextAppletFunctions:this.options.upsertWizard.nextAppletFunctions,refreshFunction:this.options.upsertWizard.refreshFunction,viewTemplate:this.options.upsertWizard.viewTemplate,upsertmodel:null,stations:this.options.upsertWizard.stations,
saveFunction:this.options.upsertWizard.saveFunction,wizardSpec:this.options.upsertWizard,parentView:this})).render()},selfcheckin:function(a){b(a.target).attr("checkInButtonId");a=this.options.listView.model;a.options.bo="Event";a.options.bc="Event";b.when(rwApp.eventSelfCheckIn({model:a,validateTimePlace:!0})).done(function(){b.when(rwcore.showWaitDialog("CheckedInConfirmation_Self")).done(function(){rwApp.navigate("#nearMeAlt",{trigger:!0,replace:!0})})})},checkin:function(a){var c=b.hasVal(b(a.target).attr("checkInButtonId"))?
b(a.target).attr("checkInButtonId"):b(a.target).parents("[checkInButtonId]").attr("checkInButtonId");a=this.options.childList.model.get(c);a.options.module="AttendeeMgr";a.options.bo="Attendee";a.options.bc="Attendee";a=rwApp.eventCheckIn({model:a,changeToStatus:"CHECKEDIN"});b.when(a).done(function(){b("#"+c).hide()})},checkout:function(a){var c=b.hasVal(b(a.target).attr("checkInButtonId"))?b(a.target).attr("checkInButtonId"):b(a.target).parents("[checkInButtonId]").attr("checkInButtonId");a=this.options.childList.model.get(c);
a.options.module="AttendeeMgr";a.options.bo="Attendee";a.options.bc="Attendee";a=rwApp.eventCheckIn({model:a,changeToStatus:"INVITED"});b.when(a).done(function(){b("#"+c).hide()})},editRecord:function(){var a=b.hasVal(this.options.upsertApplet)?this.options.upsertApplet:this.options.listView.applet;this.options.listView.parentView=this;this.options.listView.editRecord(a)},addChild:function(){var a=this.options.listView.model,b=this.options.upsertApplet,j={};for(item in this.options.parentDefaultVals){var e=
this.options.parentDefaultVals[item];if(f.isObject(e)){arguments={};for(var g=0;g<e.functionArg.length;g++){var d=e.functionArg[g];arguments[d]=a.get(d)}e=e.functionName(arguments);j[item]=e}else j[item]=a.get(e)}a=new ReferralWireView.FormView({applet:b,templateHTML:"StdForm",parentView:this,showConfirmOnSave:!1,showViewBar:!1,refreshFunctionStatic:"rwApp.refreshTopView(false)"});a.setDefaultModel();a.model.set(j);a.editRecord(b)},invite:function(){var a=this.options.listView.model;if("PartnerMgr"==
a.options.module)var c=a.get("firstName_pub"),f=a.get("fullName_pub"),e=a.get("partnerId"),g=a.get("partytype"),d=a.get("emailAddress_pub");else c=a.get("firstName"),f=a.get("fullName"),e=a.get("id"),g=a.get("partytype"),d=a.get("emailAddress");b.hasVal(d)||(d=a.get("emailAddress2"));rwApp.newInvitation({toFirstName:c,toFullName:f,toPartyId:e,toPartyType:g,toEmail:d,parentView:this})},contextAction:function(a){this[(b.hasVal(b(a.target).attr("contextAction"))?b(a.target):b(a.target).parents("[contextAction]")).attr("contextAction")](a)},
launchContextMenu:function(){b("#right-panel").panel("open")},addGuest:function(a){var b=this.options.listView.model;a.OrgId=b.get("OrgId");a.eventId=b.get("id");a.refWizard=rwApp.AddGuestWizard;a.parentView=this;rwApp.addGuest(a)},refreshView:function(){b.mobile.loading("show");rwApp.refreshTopView(!0);setTimeout(function(){b.mobile.loading("hide")},1E3)},contextActionItem:function(a){var c=(b.hasVal(b(a.target).attr("route"))?b(a.target):b(a.target).parents("[route]")).attr("route");b("#right-panel").panel("close");
a.data[c]()},render:function(){var a=b.hasVal(this.options.childList)?this.options.childList.render().el.outerHTML:"",c=this.options.listView.render().el.outerHTML,j=b.hasVal(this.options.formView2)?this.options.formView2.render().el.outerHTML:"",e=b.hasVal(this.options.formView3)?this.options.formView3.render().el.outerHTML:"",g=b.hasVal(this.options.viewBar)?this.options.viewBar.render().el.outerHTML:"",d=b.hasVal(this.options.appletMenu)?this.options.appletMenu.render().el.outerHTML:"",a=f.template(this.options.viewTemplate,
{childListHTML:a,listHTML:c,formView2:j,formView3:e,viewBarHTML:g,appletMenuHTML:d,_:f});b(this.el).html(a).trigger("create");b.hasVal(this.options.viewClass)&&b(this.el).find("#ViewContentSection").addClass(this.options.viewClass);this.options.listView.hasOwnProperty("listItem")&&this.options.listView.refreshList();b.hasVal(this.options.childList)&&this.options.childList.refreshList();a="";b.hasVal(this.options.contextMenu)?!b.hasVal(this.options.contextMenu.hideIf)||!this.options.contextMenu.hideIf(this.options.listView.model)?
(b("#actionLink").find("img").attr("src",this.options.contextMenu.icon),b("#actionLink").show(),b("#actionLink").attr("contextAction",this.options.contextMenu.action),b.hasVal(this.options.contextMenu.contextMenu)&&(a=f.template("PhoneContextNavPanel",{model:this.options.listView.model,menuNav:this.options.contextMenu.contextMenu}),b("#right-panel").html(a),b("#contextMenuBody").on("click",".menuItemDetail",this,this.contextActionItem))):b("#actionLink").hide():b("#actionLink").hide();return this},
share:function(){rwApp.sharePartnerInfo({model:this.options.listView.model})},toggleReferral:function(a){console.log("toggleHome");a.containerEL=".rw_details";this.options.listView.toggleCollapse(a)},cancel:function(){rwApp.goBack=!0;if(b.hasVal(rwApp.newReferralData)&&b.hasVal(rwApp.newReferralData.startingRoute)){var a=rwApp.newReferralData.startingRoute;rwApp.newReferralData=null;rwApp.newReferralMode=null;m.history.fragment==a&&(m.history.fragment=null);rwApp.navigate(a,{trigger:!0,replace:!0})}else history.back()},
deleteItem:function(a){f.isUndefined(a)&&(a={});a.dView=this.options.listView;var b;b="rwApp.navigate(route,{trigger: true,replace: true});".replace("route","'"+a.dView.options.refreshRoute+"'");a.refreshFunction=b;a.confirmTemplate="ConfirmDelete";a.setFields="";a.setVals="";a.actionRecordId=a.dView.model.get("id");rwApp.updateKeyField(a)},importAddressBook:function(a){b.hasVal(a)||(a={});a.dView=this.options.listView;a.confirmTemplate="ConfirmImport";a.refreshlist="true";a.setFields="";a.setVals=
"";r="rwApp.refreshTopView(true)";a.refreshFunction=r;rwApp.updateKeyField(a)},refer:function(a){f.isUndefined(a)&&(a={});a.dView=this.options.listView;a.refWizard=this.options.refWizard;a.parentView=this;rwApp.referCustToSelectedPartner(a)},updateField:function(a){a.dView=this.options.listView;a.refreshFunction="rwApp.phoneRefInbox()";rwApp.updateKeyField(a)},joinchapter:function(){rwApp.joinChapter({OrgId:this.options.listView.model.get("id")})}});m.Model.extend({options:{success:function(){},error:function(){}},
initMobile:function(){this.bindEvents()},selected_onSuccess:function(a){for(var b=0;b<a.length;b++)console.log("Display Name = "+a[b].displayName)},selected_onError:function(){rwApp.FYI("onError!")},onContactSelected:function(a){console.log("Works! However only the contact's id is received, not the full contact object.");console.log("Contact ID = "+a);var b=new ContactFindOptions;b.filter=""+a;navigator.contacts.find("id displayName addresses name phoneNumbers emails phoneNumbers organizations photos".split(" "),
phoneapp.phone_onSuccess,phoneapp.phone_onError,b)},readystatus:!1,OnLineStatus:!1,bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){this.OnLineStatus=this.readystatus=!0;console.log("Received Event: "+id)},OffLine:function(){this.readystatus=this.OnLineStatus=!1},OnLine:function(){this.OnLineStatus=!0},phonePick:function(){var a=new ContactFindOptions;a.filter="";navigator.contacts.chooseContact(phoneapp.onContactSelected,a)},urlRoot:function(){return"/rwWebRequest?"},
initialize:function(a){this.options=a},sync:function(a,c,j){var e=this;a={};c=this.urlRoot();f.isUndefined(j)&&(j=e.options);a.module="HomePageMgr";a.act="phoneread";b.ajax({type:"POST",url:c,async:!1,cache:!0,dataType:"json",data:a,success:function(a,b,c){for(var h=JSON.parse(a.userdata.data),l=Object.keys(h),k={},m=0;m<l.length;m++)k[l[m]]=h[l[m]];h=h._id;!f.isUndefined(h)&&!f.isNull(h)&&(k.id=h.$oid);h=JSON.parse(a.NewReferralsRcvd.data);k.NewReferralsRcvd=0<h.length?h[0].count:0;h=JSON.parse(a.NewReferralsSent.data);
k.NewReferralsSent=0<h.length?h[0].count:0;e.set(k);rwFB.routes=JSON.parse(a.routes);j.success(e,b,c)},error:function(a,b,c){j.error(a,b,c)}})}});m.ReferralWirePhoneRouter=ReferralWirePhoneRouter=p;return m.ReferralWirePhoneRouter});
