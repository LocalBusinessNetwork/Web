(function(u,s){if("object"===typeof exports){var r=require("jquery"),t=require("underscore"),q=require("backbone");require("ReferralWireBase");var h=require("ReferralWirePattern");module.exports=s(r,t,q,h)}else"function"===typeof define&&define.amd&&define(["jquery","underscore","backbone","ReferralWirePattern"],s)})(this,function(u,s,r,t){r.ReferralWireRouterBase=ReferralWireRouterBase=function(q,h,c,p){return q.Router.extend({params:null,routes:{"*actions":"defaultRoute"},defaultRoute:function(){},
initialize:function(a){this.params=a.params;this.homepage=a.homepage;this.tenant=a.tenant;ReferralWireBase.init(a)},help:function(a){rwcore.FYI("help"+a)},signout:function(){c.ajax({type:"POST",url:"/rwWebRequest?",async:!1,cache:!0,dataType:"json",data:{signout:"true"},success:function(){null!=rwFB.geoLocationWatchID&&(navigator.geolocation.clearWatch(rwFB.geoLocationWatchID),rwFB.geoLocationWatchID=null);window.location=rwFB.loginUrl},error:rwcore.showError})},createNewRecord:function(a,b,d,e,f){b=
new ReferralWireView.FormView({applet:b,templateHTML:d,success:function(a,b,d){h.isUndefined(f)||f(a,b,d)},error:rwcore.showError});b.setDefaultModel();c(a).html(b.render().el).trigger("create")},GenericSummaryDetailPattern:function(a){h.bind(p.GenericSummaryDetailPattern,this,a)()},GenericListDetailPattern:function(a){h.bind(p.GenericListDetailPattern,this,a)()},GenericMergedListDetailPattern:function(a){h.bind(p.GenericMergedListDetailPattern,this,a)()},GenericMasterDetailPattern:function(a){h.bind(p.GenericMasterDetailPattern,
this,a)()},MasterDetailWithNextPrev:function(a){h.bind(p.MasterDetailWithNextPrev,this,a)()},MasterDetailRenderChildren:function(a){h.bind(p.MasterDetailRenderChildren,this,a)()},ReferralsMasterTwoDetail:function(a){h.bind(p.ReferralsMasterTwoDetail,this,a)()},GenericSummaryTilesPattern:function(a){h.bind(p.GenericSummaryTilesPattern,this,a)()},allEventDataOptions:[{module:"EventMgr",bo:"Event",bc:"Event",sortby:"datetime",searchSpec:{filter:[{ftype:"time",period:"120",max:"10080",fieldname:"datetime"}]},
calculatedFields:{dayName:function(a){a=h.isObject(a.get("datetime"))?a.get("datetime").$date:a.get("datetime");var b=rwcore.getLovDisplayVal("WEEKDAY",(new Date(a)).getDay());return b+=", "+dateFormat(new Date(a),"mmm d")},orgPhotoUrl:function(a){return a.get("photoUrl")},pastFuture:function(a){a=h.isObject(a.get("datetime"))?a.get("datetime").$date:a.get("datetime");return(new Date(a)).getTime()+432E5>(new Date).getTime()?"Future":"Past"}}}],ContactRefWizard:{showConfirmOnSave:"ReferralSentConfirmation",
viewTemplate:"WizardUpsertView",stations:["Referral Type","Who","Context","Other"],helpUrl:function(){return rwcore.getLov("ONLINEHELP","INVITE_WEB").get("Url")},firstPartyIdField:"partnerId",firstApplet:{name:"ReferralWizard_1WhosThis"},refreshFunction:function(a,b){b.parentView.refreshInPlace(a)},partyDefaults:{CUST_FOR_PART:{contactId:"firstPartyId",contact_fullName:"firstPartyFullName",contact_firstName:"firstPartyFirstName"},PART_FOR_PART:{toId:"firstPartyId",to_fullName:"firstPartyFullName",
to_firstName:"firstPartyFirstName"},PART_FOR_CUST:{contactId:"firstPartyId",contact_fullName:"firstPartyFullName",contact_firstName:"firstPartyFirstName"}},nextAppletFunctions:{ReferralWizard_1WhosThis:function(a,b){var d=a.get("referralType"),e=a.get("firstPartyEmail"),f=b.partyDefaults[d],g={};if(c.hasVal(f))for(item in f)g[item]=a.get(f[item]);f=h.toArray(g);if("CUST_FOR_PART"==d)return 0<f.length&&a.set(g),a.set({comments:""}),{name:"ReferralWizard_2PickCustomer"};if("PART_FOR_PART"==d)return c.hasVal(e)&&
(0<e.indexOf("@")&&0<f.length)&&a.set(g),a.set({comments:"I believe the two of you would be good power partners. I encourage you to connect through STN Connect."}),{name:"ReferralWizard_2PickOtherPartner"};if("PART_FOR_CUST"==d)return 0<e.indexOf("@")&&0<f.length&&a.set(g),a.set({comments:""}),{name:"ReferralWizard_2PickIndirect"};if("PART_INVITE"==d)return{name:"InvitationWizard_ContactInfo"}},ReferralWizard_2PickCustomer:function(){return{name:"ReferralWizard_3WhyNowCust"}},ReferralWizard_2PickOtherPartner:function(){return{name:"ReferralWizard_3WhyNowPart"}},
ReferralWizard_2PickIndirect:function(){return{name:"ReferralWizard_3WhyNowIndirect"}},InvitationWizard_ContactInfo:function(a){var b=a.get("newContactFirst"),b=c.getInvitationText(a,b,"CONTACT");a.set({comments:b});return{name:"ReferralWizard_3WhyNowInvite"}},ReferralWizard_3WhyNowPart:function(){return{name:"ReferralWizard_4NoteP2P",template:"CreateReferralWizardFormP2P"}},ReferralWizard_3WhyNowCust:function(){return{name:"ReferralWizard_4NotesCustomQ",template:"CreateReferralWizardForm"}},ReferralWizard_3WhyNowIndirect:function(a){var b;
b=c.substituteVals("<ul><li>Send your email to [contact_firstName]; and</li><li>Let [to_firstName] know you've recommended him/her to one of your contacts</li></ul><div style='padding-top: 25px;font-weight: bold;font-style: italic;'>If [to_firstName] enters [_contact_firstName] into his/her STN Connect address book in the future, we'll make sure [to_firstName] knows [contact_firstName] was referred by you.</div>",a);var d;d=c.substituteVals("[to_firstName] is a great resource.",a);a.set({comments:d,
summaryText2:b});return{name:"ReferralWizard_4NoteIndirect"}},ReferralWizard_3WhyNowInvite:function(a){var b;b=c.substituteVals("Send an invitation with your message to [newContactFirst] with a registration link.",a);a.set({summaryText2:b});return{name:"ReferralWizard_4InviteNote"}}}},ContactRefWizard_phoneHomeRefWizard:function(){var a=h.clone(rwApp.ContactRefWizard);a.partyDefaults={};return a},referCustToSelectedPartner:function(a){var b=a.refWizard,d=a.dView,d=c.hasVal(d)?d.model:c.hasVal(a.dViewModel)?
a.dViewModel:void 0;if(c.hasVal(d))var e=d.get(b.firstPartyIdField),f=c.hasVal(b.firstPartyFullNameField)?d.get(b.firstPartyFullNameField):d.get("fullName_pub"),g=c.hasVal(b.firstPartyFirstNameField)?d.get(b.firstPartyFirstNameField):d.get("firstName_pub"),l=c.hasVal(b.firstPartyEmailAddressField)?d.get(b.firstPartyEmailAddressField):d.get("emailAddress_pub"),m=c.hasVal(b.firstPartyProfessionField)?d.get(b.firstPartyProfessionField):d.get("profession"),j=d.get(b.secondPartyFullNameField),k=d.get(b.secondPartyFirstNameField),
n=d.get(b.secondPartyEmailAddressField),v=d.get(b.secondPartyProfessionField);!h.isUndefined(a.parentView)&&h.isNull(a.parentView);new rwcore.StandardModel({module:"UserMgr",id:e});var p=new rwcore.StandardModel({module:"RfrlMgr"}),q=new ReferralWireBase.AppletView({applet:b.firstApplet.name});ReferralWireBase.setDefaultValues(p,q,null);c.hasVal(d)?p.set({firstPartyId:e,firstPartyFullName:f,firstPartyFirstName:g,firstPartyEmail:l,firstPartyProfession:m,question1:d.get("question1"),question2:d.get("question2"),
question3:d.get("question3"),question4:d.get("question4"),summaryText:"You can only pick parties that are Successful Thinkers members or have a valid email.",secondPartyFullName:j,secondPartyFirstName:k,secondPartyEmail:n,secondPartyProfession:v}):p.set({summaryText:"You can only pick parties that are Successful Thinkers members or have a valid email."});(new ReferralWireView.WizardUpsertView({firstApplet:b.firstApplet,nextAppletFunctions:b.nextAppletFunctions,appletTemplates:b.appletTemplates,viewTemplate:b.viewTemplate,
upsertmodel:p,stations:b.stations,saveFunction:b.saveFunction,refreshFunction:a.refnewreshFunction,refreshFunctionStatic:a.refreshFunctionStatic,parentView:a.parentView,showConfirmOnSave:b.showConfirmOnSave,wizardSpec:b,helpUrl:b.helpUrl})).render()},upsertRecord:function(a){var b=a.appletName,d=c.hasVal(a.upsertTemplate)?a.upsertTemplate:"upsertForm",e=a.upsertModel;a=new ReferralWireView.FormView({applet:b,templateHTML:d,parentView:a.parentView,showConfirmOnSave:a.showConfirmOnSave,refreshFunctionStatic:a.refreshFunctionStatic,
refreshFunction:a.refreshFunction,success:function(){},error:rwcore.showError});""==e?a.setDefaultModel():(h.isUndefined(e.options.bo)&&!h.isUndefined(a.bo)&&(e.options.bo=a.bo),h.isUndefined(e.options.bc)&&!h.isUndefined(a.bc)&&(e.options.bc=a.bc),a.model=e);e=a.metaApplet.model.attributes.field;!1==h.isArray(e)&&(e=[e]);e=h.clone(e);rwApp.FetchRadioButtonModels({view:a,fieldList:e,done:"showUpsert",wizardView:null})},FetchRadioButtonModels:function(a){var b=a.fieldList[0],d=h.rest(a.fieldList),
e=this;if(("radio"==b.dataType||"multicheckbox_search"==b.dataType)&&!c.hasVal(b.lovType)){var f=b.pickApplet,g=null,g=c.hasVal(b.pickUsePaging)&&b.pickUsePaging?!0:null,l=rwApp.getCopyPickMaps(b.pickMap),f=new ReferralWireBase.RepoObjectModel({type:"Applet",name:f}),m=rwApp.addConstraintPickMapExpressions(b.pickMap,a.view.model,f.get("searchSpec")),j=f.attributes.field,j=!h.isUndefined(f.get("sortBy"))&&!h.isNull(f.get("sortBy"))?f.get("sortBy"):c.isArray(j)?j[0].fldname:j.fldname;(new rwcore.StandardCollection({module:f.get("actor"),
bo:f.get("bo"),bc:f.get("bc"),searchSpec:m,sortby:j,limit:h.isNull(g)?void 0:10})).fetch({add:!0,error:function(a,b,d){(new rwcore.ErrorView({request:a,status:b,error:d})).render(b.responseText)},success:function(f){b.radioList=f;b.radioPickMaps=l;a.view.metaAppletHasRadioModels=!0;c.hasVal(a.view.radioModels)||(a.view.radioModels={});a.view.radioModels[b.fldname]={radioPickMaps:l,radioList:f};0<d.length?rwApp.FetchRadioButtonModels({view:a.view,fieldList:d,done:a.done,wizardView:a.wizardView}):("showUpsert"==
a.done&&(f=h.isUndefined(e.options)?a.view:e.options.view,rwApp.openStandardDialog({view:f})),"wizardNextApplet"==a.done&&a.wizardView.renderStep(),"initializeWizard"==a.done&&a.wizardView.renderFirstStep(),"function"===typeof a.done&&a.done(a))}})}else 0<d.length?rwApp.FetchRadioButtonModels({view:a.view,fieldList:d,done:a.done,wizardView:a.wizardView}):("showUpsert"==a.done&&rwApp.openStandardDialog({view:a.view}),"wizardNextApplet"==a.done&&a.wizardView.renderStep(),"initializeWizard"==a.done&&
a.wizardView.renderFirstStep(),"function"===typeof a.done&&a.done(a))},renderList:function(a,b,d){var e=new ReferralWireView.ListView({applet:b,template:d});(new rwcore.StandardCollection({module:e.actor,searchSpec:e.searchSpec})).fetch({add:!0,error:rwcore.showError,success:function(b){c(a).html(e.render(b).el).trigger("create")}})},getContactProfessionalTemplate:function(a){var b="StdFormContact";if(c.hasVal(a)){var d=a.get("type");a.get("partytype");"REFERRAL_PARTNER"==d&&(b="StdFormContactPartner")}return b},
getReferralInboxHomeTemplate:function(a){if(a.get("fromId")==rwFB.uId)return rwApp.getReferralOutboxHomeTemplate(a);var b="ReferralInbox";if(c.hasVal(a)){var d=c.hasVal(a.get("referralType"))?a.get("referralType"):"CUST_FOR_PART",e=c.hasVal(a.get("status"))?a.get("status"):"ACCEPTED";"CUST_FOR_PART"==d&&"UNREAD"==e&&(b="ReferralInboxUnread");"PART_INVITE"==d&&(b="ReferralInboxInvite");"PART_FOR_PART"==d&&(b="ReferralInboxP2P");"INMAIL_REFERRAL"==d&&(a=a.get("referralSubType"),"P2PM"==a?b="ReferralInboxMessage":
"C2PM"==a&&(b="ReferralInboxAnnouncement"))}return b},getReferralOutboxHomeTemplate:function(a){var b="ReferralOutbox";if(c.hasVal(a)){var d=c.hasVal(a.get("referralType"))?a.get("referralType"):"CUST_FOR_PART";"PART_FOR_PART"==d&&(b="ReferralOutboxP2P");"PART_INVITE"==d&&(b="ReferralOutboxInvite");"PART_INVITE"==d&&(b="ReferralOutboxInvite");"INMAIL_REFERRAL"==d&&(a=a.get("referralSubType"),"P2PM"==a?b="ReferralOutboxMessage":"C2PM"==a&&(b="ReferralInboxAnnouncement"))}return b},getReferralViewForm:function(a){if(c.hasVal(a)){var b=
c.hasVal(a.get("referralType"))?a.get("referralType"):"CUST_FOR_PART";a=a.get("status");if("PART_FOR_PART"==b)return"ViewReferralFormP2P";if("CUST_FOR_PART"==b&&"UNREAD"==a)return"ViewReferralFormUnreadProspect";if("PART_INVITE"==b)return"ViewReferralFormInvite"}return"ViewReferralForm"},getReferralViewOutForm:function(a){if(c.hasVal(a)){var b=c.hasVal(a.get("referralType"))?a.get("referralType"):"CUST_FOR_PART";a.get("status");if("PART_FOR_PART"==b)return"OutBoxReferralFormP2P";if("PART_INVITE"==
b)return"OutBoxReferralFormInvite"}return"OutBoxReferralForm"},getPartnerReferralReceivedTempl:function(a){var b="PartnerReferralInbox";if(c.hasVal(a)){var d=c.hasVal(a.get("referralType"))?a.get("referralType"):"CUST_FOR_PART";a.get("status");"PART_FOR_PART"==d&&(b="PartnerReferralInboxP2P");"PART_INVITE"==d&&(b="PartnerReferralInboxInvite")}return b},getPartnerReferralGivenTempl:function(a){var b="PartnerReferralOutbox";if(c.hasVal(a)){var d=c.hasVal(a.get("referralType"))?a.get("referralType"):
"CUST_FOR_PART";a.get("status");"PART_FOR_PART"==d&&(b="PartnerReferralOutBoxP2P");"PART_INVITE"==d&&(b="PartnerReferralOutBoxInvite")}return b},getContactListTempl:function(a){var b="ContactListPrivate";if(c.hasVal(a)){var d=a.get("type");a=a.get("partytype_denorm");if("REFERRAL_CONTACT"==d&&("PARTNER"==a||"PARTNER_DEMO"==a))b="ContactListNoRelation";"REFERRAL_PARTNER"==d&&(b="ContactList")}return b},getContactQualificationsTemplate:function(a){return c.hasVal(a)&&"REFERRAL_PARTNER"==a.get("type")?
"QualificationsFormDisplay":"StdFormContactPartner"},getContactProfessionalApplet:function(a){var b="ProfessionalContact";if(c.hasVal(a)){var d=a.get("type");a.get("partytype");"REFERRAL_PARTNER"==d&&(b="ProfessionalContactPartner")}return b},getPublicMemberApplet:function(a){var b="PartyAppletFormPublic";if(!h.isUndefined(a)){var d=q.history.fragment.split("/")[0];a={routeName:d,record:a};h.contains(["memberList","memberProfile","PhoneMemberContact"],d)&&(a.privilege="viewFullProfile",c.hasAccess(a)&&
(b="PartyAppletFormAdmin"))}return b},getAddrListViewBarApplet:function(a){var b="ContactsViewBar";c.hasVal(rwApp.tenant)&&"STN"==rwApp.tenant&&(b="STNContactsViewBar");c.hasVal(a)&&"REFERRAL_PARTNER"==a.get("type")&&(b="PartnersViewBar",c.hasVal(rwApp.tenant)&&"STN"==rwApp.tenant&&(b="STNPartnersViewBar"));return b},getAddrRecViewBarApplet:function(a){return c.hasVal(a)&&"REFERRAL_PARTNER"==a.get("type")?"PartnerRecommendationsViewBar":"ContactRecommendationsViewBar"},getTemplate:function(a){var b=
a.clickRoute,d={routeName:b,record:a},e="not found";if(h.contains("EventExpected EventCheckedIn EventGuests phoneEventExpected phoneEventCheckedIn phoneEventGuests".split(" "),b)){var f=a.get("guestType"),e="AttendeeMemberNoAct";d.privilege="editFull";c.hasAccess(d)?("MEMBER"==f&&(e="AttendeeMember"),"NEW_MEMBER"==f&&(e="AttendeeNewGuest"),"FLOATER"==f&&(e="AttendeeFloater")):(d.privilege="addGuest",c.hasAccess(d)?("MEMBER"==f&&(e="AttendeeMember"),"NEW_MEMBER"==f&&(e="AttendeeNewGuest"),"FLOATER"==
f&&(e="AttendeeFloater")):("MEMBER"==f&&(e="AttendeeMemberNoAct"),"NEW_MEMBER"==f&&(e="AttendeeNewGuestNoAct"),"FLOATER"==f&&(e="AttendeeFloaterNoAct")))}"speakerBio"==b&&(d={routeName:b,record:a,privilege:"edit"},e="STN_speakerInviteMessage",c.hasAccess(d)&&(e="StdFormPlain"));return e},InviteWizard:{viewTemplate:"WizardUpsertView",stations:["Who","Message","Next Steps"],helpUrl:function(){return rwcore.getLov("ONLINEHELP","INVITE_WEB").get("Url")},firstPartyIdField:"partnerId",firstApplet:{name:"InvitationWizard_ContactInfo"},
nextAppletFunctions:{InvitationWizard_ContactInfo:function(a){var b=a.get("newContactFirst"),b=c.getInvitationText(a,b,"CONTACT");a.set({comments:b,fromId:rwFB.uId,referralType:"PART_INVITE"});return{name:"ReferralWizard_3WhyNowInvite"}},ReferralWizard_3WhyNowInvite:function(a){var b;b=c.substituteVals("Send an invitation with your message to [newContactFirst] with a registration link.",a);a.set({summaryText2:b});return{name:"ReferralWizard_4InviteNote"}}}},AddGuestSelfServiceWizard:{showConfirmOnSave:"AddGuestConfirmation",
viewTemplate:"WizardUpsertView",stations:["Guest Name","Confirmation"],firstApplet:{name:"AddGuestWizard_2AddNewMember"},nextAppletFunctions:{AddGuestWizard_2AddNewMember:function(a){var b;b=c.substituteVals("We'll send [newContactFirst] a registration email!",a);a.set({nextSteps:b});return{name:"AddGuestWizard_4NewMemberConfirmation"}}}},refreshTopView:function(a){c.hasVal(a)||(a=!1);var b=window.location.hash.replace("#","");a&&-1!=b.indexOf("/")&&(a=b.substr(b.lastIndexOf("/")+1),b=b.replace(a,
""));q.history.fragment=null;rwApp.navigate(b,{trigger:!0,replace:!0})},refreshAndSelect:function(a){var b=window.location.hash.replace("#","");a=a.get("id");if(-1!=b.indexOf("/"))var d=b.substr(b.lastIndexOf("/")+1),b=b.replace(d,a);else b+="/"+a;q.history.fragment=null;rwApp.navigate(b,{trigger:!0,replace:!0})},ContactRefWizard_Recommendation:function(){var a=h.clone(rwApp.ContactRefWizard);a.firstPartyIdField="contactPartyId";a.firstPartyFullNameField="contact_fullName";a.firstPartyFirstNameField=
"contact_firstName";a.firstPartyEmailAddressField="contact_emailAddress";a.firstPartyProfessionField="partner_profession";a.secondPartyIdField="partnerPartyId";a.secondPartyFullNameField="partner_fullName";a.secondPartyFirstNameField="partner_firstName";a.secondPartyEmailAddressField="partner_emailAddress";a.secondPartyProfessionField="partner_profession";a.partyDefaults.CUST_FOR_PART={contactId:"firstPartyId",contact_fullName:"firstPartyFullName",contact_firstName:"firstPartyFirstName",toId:"secondPartyId",
to_fullName:"secondPartyFullName",to_firstName:"secondPartyFirstName",recipientProfession:"secondPartyProfession"};a.partyDefaults.PART_FOR_PART={toId2:"firstPartyId",to_fullName2:"firstPartyFullName",to_firstName2:"firstPartyFirstName",toId:"secondPartyId",to_fullName:"secondPartyFullName",to_firstName:"secondPartyFirstName",recipientProfession:"secondPartyProfession"};a.partyDefaults.PART_FOR_CUST={contactId:"firstPartyId",contact_fullName:"firstPartyFullName",contact_firstName:"firstPartyFirstName",
toId:"secondPartyId",to_fullName:"secondPartyFullName",to_firstName:"secondPartyFirstName",recipientProfession:"secondPartyProfession"};return a},ContactRefWizard_ServProvRecommendation:function(){var a=h.clone(rwApp.ContactRefWizard);a.firstPartyIdField="contactPartyId";a.firstPartyFullNameField="contact_fullName";a.firstPartyFirstNameField="contact_firstName";a.firstPartyEmailAddressField="contact_emailAddress";a.firstPartyProfessionField="contact_profession";a.secondPartyIdField="partnerPartyId";
a.secondPartyFullNameField="partner_fullName";a.secondPartyFirstNameField="partner_firstName";a.secondPartyEmailAddressField="partner_emailAddress";a.secondPartyProfessionField="partner_profession";a.partyDefaults.CUST_FOR_PART={contactId:"secondPartyId",contact_fullName:"secondPartyFullName",contact_firstName:"secondPartyFirstName",toId:"firstPartyFullName",to_fullName:"firstPartyFullName",to_firstName:"firstPartyFirstName",recipientProfession:"secondPartyProfession"};return a},ContactRefWizard_P2PRecommendation:function(){var a=
h.clone(rwApp.ContactRefWizard);a.firstPartyIdField="partnerPartyId";a.firstPartyFullNameField="partner_fullName";a.firstPartyFirstNameField="partner_firstName";a.firstPartyEmailAddressField="partner_emailAddress";a.firstPartyProfessionField="partner_profession";a.firstApplet={name:"ReferralWizard_1WhosThis_P2P"};a.secondPartyIdField="contactPartyId";a.secondPartyFullNameField="contact_fullName";a.secondPartyFirstNameField="contact_firstName";a.secondPartyEmailAddressField="contact_emailAddress";
a.partyDefaults.PART_FOR_PART={toId:"firstPartyId",to_fullName:"firstPartyFullName",to_firstName:"firstPartyFirstName",toId2:"secondPartyFullName",to_fullName2:"secondPartyFullName",to_firstName2:"secondPartyFirstName"};a.nextAppletFunctions.ReferralWizard_1WhosThis_P2P=function(a,d){return d.nextAppletFunctions.ReferralWizard_1WhosThis(a,d)};return a},ContactRefWizard_partnerRefWizard:function(){var a=h.clone(rwApp.ContactRefWizard);a.partyDefaults.PART_FOR_PART={toId:"firstPartyId",to_fullName:"firstPartyFullName",
to_firstName:"firstPartyFirstName",recipientProfession:"firstPartyProfession"};a.nextAppletFunctions.ReferralWizard_3WhyNowPart=function(){return{name:"ReferralWizard_4NoteP2P",template:"CreateReferralWizardFormP2P"}};return a},ContactUpsertWizard:function(){return{viewTemplate:"WizardUpsertView",refreshFunction:rwApp.refreshContactAfterInsert,stations:["Work","Home"],firstApplet:{name:"ProfessionalContactUpsert"},nextAppletFunctions:{ProfessionalContactUpsert:function(){return{name:"PersonalContactInsert"}}}}},
updateClaimedReferralWizard:{viewTemplate:"WizardUpsertView",stations:["New Status","Notes","Next Steps","Forward To","Confirm"],firstApplet:{name:"ClaimedUpdate_NewReferralStatus1A",template:"WizardUpsertFormRefStatus"},nextAppletFunctions:{ClaimedUpdate_NewReferralStatus1A:function(a){a=a.get("protoStatus");if("NOSALE"==a)return{name:"ClaimedUpdate_WhyClaimedToNoSale1A_2A"};if("CONFIRMED"==a)return{name:"ClaimedUpdate_ContactedNoteToSender2B_3A"};if("CONVERTED"==a)return{name:"ClaimedUpdate_ConvertedNoteToSender2C_3A"};
if("ARCHIVED"==a)return{name:"ClaimedUpdate_NextSteps4M",stationNumber:4,template:"WizardUpsertFormRefStatusConfirm"}},ClaimedUpdate_WhyClaimedToNoSale1A_2A:function(a){a.set({toId_fwd:void 0,to_fullName_fwd:void 0,recipientProfession_fwd:void 0});return{name:"ClaimedUpdate_NoSale2A_3A"}},ClaimedUpdate_NoSale2A_3A:function(a){if(c.hasVal(a.get("toId_fwd"))){var b;b="<ul><li>ZfromFullName will be notified that you don't see an opportunity to move forward with ZcontactFullName at this time.</li><li>The original referral will be archived and a new referral will be created from you to ZtoFullNameFWD.</li></ul>".replace("ZfromFullName",
a.get("from_fullName"));b=b.replace("ZcontactFullName",a.get("contact_fullName"));b=b.replace("ZtoFullNameFWD",a.get("to_fullName_fwd"));a.set({summaryText:b});c.hasVal(a.get("recipientProfession_fwd"))||a.set({recipientProfession_fwd:"Other",referral_reason_fwd:"OTHER"});return{name:"ClaimedUpdate_ContactedForwardTo4M",template:"ForwardReferralWizardForm"}}b="<ul><li>ZfromFullName will be notified that you don't see an opportunity to move forward with ZcontactFullName at this time.</li><li>The referral will be archived.</li></ul>".replace("ZfromFullName",
a.get("from_fullName"));b=b.replace("ZcontactFullName",a.get("contact_fullName"));a.set({summaryText:b});return{name:"ClaimedUpdate_NextSteps4M",stationNumber:4,template:"WizardUpsertFormRefStatusConfirm"}},ClaimedUpdate_ConvertedServiceProvided1A_2C:function(a){var b="ZfromFullName will be notified that you made a sale to ZcontactFullName.";"YES"==a.get("archiveNow")&&(b="ZfromFullName will be notified that you made a sale to ZcontactFullName and the lead will be archived.");b=b.replace("ZfromFullName",
a.get("from_fullName"));b=b.replace("ZcontactFullName",a.get("contact_fullName"));a.set({summaryText:b});return{name:"ClaimedUpdate_NextSteps4M",stationNumber:4,template:"WizardUpsertFormRefStatusConfirm"}},ClaimedUpdate_ConvertedNoteToSender2C_3A:function(){return{name:"ClaimedUpdate_ConvertedServiceProvided1A_2C"}},ClaimedUpdate_ContactedNoteToSender2B_3A:function(a){var b;b="ZfromFullName will be notified that you contacted ZcontactFullName and that the lead represents an active opportunity for you.".replace("ZfromFullName",
a.get("from_fullName"));b=b.replace("ZcontactFullName",a.get("contact_fullName"));a.set({summaryText:b});return{name:"ClaimedUpdate_NextSteps4M",stationNumber:4,template:"WizardUpsertFormRefStatusConfirm"}},ClaimedUpdate_ContactedNoOpportunity2B_3B:function(a){if(c.hasVal(a.get("toId_fwd"))){var b;b="ZfromFullName will be notified that you contacted ZcontactFullName but don't see an opportunity to move forward at this time. The original referral will be archived and a new referral will be created from you to ZtoFullNameFWD.".replace("ZfromFullName",
a.get("from_fullName"));b=b.replace("ZcontactFullName",a.get("contact_fullName"));b=b.replace("ZtoFullNameFWD",a.get("to_fullName_fwd"));a.set({summaryText:b});c.hasVal(a.get("recipientProfession_fwd"))||a.set({recipientProfession_fwd:"Other",referral_reason_fwd:"OTHER"});return{name:"ClaimedUpdate_ContactedForwardTo4M",template:"ForwardReferralWizardForm"}}b="ZfromFullName will be notified that you contacted ZcontactFullName but don't see an opportunity to move forward at this time.  The referral will be archived.".replace("ZfromFullName",
a.get("from_fullName"));b=b.replace("ZcontactFullName",a.get("contact_fullName"));a.set({summaryText:b});return{name:"ClaimedUpdate_NextSteps4M",stationNumber:4,template:"WizardUpsertFormRefStatusConfirm"}},ClaimedUpdate_ContactedForwardTo4M:function(){return{name:"ClaimedUpdate_NextSteps4M",template:"WizardUpsertFormRefStatusConfirm"}}}},getUpdateContactedReferralWizard:function(){var a=h.clone(rwApp.updateClaimedReferralWizard);a.firstApplet={name:"ContactedUpdate_NewReferralStatus1A",template:"WizardUpsertFormRefStatus"};
a.nextAppletFunctions.ContactedUpdate_NewReferralStatus1A=a.nextAppletFunctions.ClaimedUpdate_NewReferralStatus1A;return a},getUpdateUnreadReferralWizard:function(){var a=h.clone(rwApp.updateClaimedReferralWizard);a.firstApplet={name:"UnreadUpdate_NewReferralStatus1A",template:"WizardUpsertFormRefStatus"};a.stations=["New Status","Confirm"];a.nextAppletFunctions.UnreadUpdate_NewReferralStatus1A=function(a){var d=a.get("protoStatus");if("ACCEPTED"==d)return a.set({summaryText:"When you click 'Done'"}),
{name:"ClaimedUpdate_NextSteps4M",template:"WizardUpsertFormRefStatusConfirm"};if("ARCHIVED"==d)return a.set({summaryText:"The lead has been ignored..."}),{name:"ClaimedUpdate_NextSteps4M",template:"WizardUpsertFormRefStatusConfirm"}};return a},AddGuestWizard:{showConfirmOnSave:"AddGuestConfirmation",viewTemplate:"WizardUpsertView",stations:["Guest Type","Guest Name","Source","Confirmation"],firstApplet:{name:"AddGuestWizard_1GuestType"},refreshFunction:function(){rwApp.refreshTopView()},nextAppletFunctions:{AddGuestWizard_1GuestType:function(a){a=
a.get("guestType");if("FLOATER"==a)return{name:"AddGuestWizard_2PickFloater"};if("NEW_MEMBER"==a)return{name:"AddGuestWizard_2AddNewMember"}},AddGuestWizard_2PickFloater:function(){return{name:"AddGuestWizard_3FloaterSource"}},AddGuestWizard_3FloaterSource:function(a){var b;b=c.substituteVals("We'll add [firstName] to the guest list!",a);a.set({nextSteps:b});return"EXISTING_MEMBER"==a.get("heardAboutFrom")?{name:"AddGuestWizard_4FloaterPickRecommender"}:{name:"AddGuestWizard_4FloaterConfirmation"}},
AddGuestWizard_2AddNewMember:function(){return{name:"AddGuestWizard_3NewMemberSource"}},AddGuestWizard_3NewMemberSource:function(a){var b=a.get("heardAboutFrom"),d;d=c.substituteVals("We'll send [newContactFirst] a registration email!",a);a.set({nextSteps:d});return"EXISTING_MEMBER"==b?{name:"AddGuestWizard_4NewMemberPickRecommender"}:{name:"AddGuestWizard_4NewMemberConfirmation"}}}},getNewReferralModel:function(a){var b=a.toPartyId,d=a.toFullName;(new rwcore.StandardModel({module:"UserMgr",id:b})).fetch({error:rwcore.showError,
success:function(a){var c=new ReferralWireView.FormView({applet:"CreateReferralForm",templateHTML:"CreateReferralForm"});c.setDefaultModel();c=c.model;c.set({toId:b});c.set({to_fullName:d});c.set({question1:a.get("question1")});c.set({question2:a.get("question2")});c.set({question3:a.get("question3")});c.set({question4:a.get("question4")});return c}})},addGuest:function(a){var b=a.refWizard,d=new rwcore.StandardModel({module:"AttendeeMgr"}),c=new ReferralWireBase.AppletView({applet:b.firstApplet.name});
ReferralWireBase.setDefaultValues(d,c,null);d.set({OrgId:a.OrgId,eventId:a.eventId,newMemberSrc_partyId:a.newMemberSrc_partyId,isGuest:"true",status:"CHECKEDIN",guestType:a.guestType,newMemberSrc_fullName:a.newMemberSrc_fullName});(new ReferralWireView.WizardUpsertView({firstApplet:b.firstApplet,nextAppletFunctions:b.nextAppletFunctions,appletTemplates:b.appletTemplates,viewTemplate:b.viewTemplate,upsertmodel:d,stations:b.stations,saveFunction:b.saveFunction,parentView:a.parentView,refreshFunction:function(){rwApp.refreshTopView()},
showConfirmOnSave:b.showConfirmOnSave,wizardSpec:b})).render()},validateCheckIn:function(a){var b=c.Deferred();c.hasVal(a.validateTimePlace)&&a.validateTimePlace?(a=new Date(a.model.get("datetime").$date),a=Math.abs((new Date).getTime()-a)/6E4,0>rwcore.mtgCheckinWindowDistance||a>rwcore.mtgCheckinWindowMinutes?c.when(rwcore.showWaitDialog("CheckedInInvalid")).done(function(){rwApp.preventNavigation=!1;b.reject()}):b.resolve()):b.resolve();return b},validateCheckInGeo:function(a){this.options=a;var b=
a.model.get("org_latitude_work"),d=a.model.get("org_longitude_work");that=this;navigator.geolocation.getCurrentPosition(function(a){a={firstPosition:{lat:b,lng:d},secondPosition:{lat:a.coords.latitude,lng:a.coords.longitude}};var f=5280*c.calculateDistance(a),g=new Date(that.options.model.get("datetime").$date),l=Math.abs((new Date).getTime()-g)/6E4;console.log("checkin chapterLongitude "+d);console.log("checkin chapterLatitude "+b);console.log("checkin position lat "+a.secondPosition.lat);console.log("checkin position lng "+
a.secondPosition.lng);console.log("checkin meetingTime "+g);console.log("checkin now "+(new Date).getTime());console.log("checkin feet away "+f);console.log("checkin min from start "+l);if(400>f&&120>l)that.options.validateTimePlace=!1,rwApp.eventSelfCheckIn(that.options);else{var m=c("#PopupContainer");m.html(h.template("CheckedInInvalid")());m.addClass("confirmation");c(".overlay-background").show();m.show();m.one("click","[popEvent]",function(){m.hide();c(".overlay-background").hide();m.removeClass("confirmation");
rwApp.preventNavigation=!1})}},function(){var a=c("#PopupContainer");a.html(h.template("CheckedInPositionError")());a.addClass("confirmation");c(".overlay-background").show();a.show();a.one("click","[popEvent]",function(){a.hide();c(".overlay-background").hide();a.removeClass("confirmation");rwApp.preventNavigation=!1})},{maximumAge:6E4,timeout:1E4,enableHighAccuracy:!0})},getContactListTemplPhone:function(a){var b="ContactListPrivatePhone";if(c.hasVal(a)){var d=a.get("type");a=a.get("partytype_denorm");
if("REFERRAL_CONTACT"==d&&("PARTNER"==a||"PARTNER_DEMO"==a))b="ContactListNoRelationPhone";"REFERRAL_PARTNER"==d&&(b="ContactListPhone")}return b},eventCheckIn:function(a){var b=c.Deferred();c.when(rwApp.validateCheckIn(a)).done(function(){a.model.set({status:c.hasVal(a.changeToStatus)?a.changeToStatus:"CHECKEDIN"});a.model.save({},{success:function(d){rwApp.preventNavigation=!1;c.hasVal(a.refresh)&&rwApp.refreshTopView();b.resolve(d)},error:function(a,c,f){rwcore.showError(a,c,f);b.reject()}})}).fail(function(){b.reject()});
return b},eventSelfCheckIn:function(a){var b=c.Deferred();c.when(rwApp.validateCheckIn(a)).done(function(){a.model.set({selfcheckin:!0});a.model.save({},{success:function(d){c.hasVal(a.refresh)&&rwApp.refreshTopView();b.resolve(d)},error:function(a,c,f){rwcore.showError(a,c,f);b.reject()}})}).fail(function(){b.reject()});return b},getCopyPickMaps:function(a){var b=[];!1==h.isArray(a)&&(a=[a]);for(i=0;i<a.length;i++){var d=a[i];"pick"==d.type&&(b[b.length]=d)}return b},fetchMultipleLists:function(a){var b=
!h.isUndefined(a.promise)?a.promise:c.Deferred();rwApp.fetchList(a.dataOptions[0]).done(function(d){h.isUndefined(a.dataSoFar)?a.dataSoFar=d:a.dataSoFar.add(d.models,{merge:!0,silent:!0});1<a.dataOptions.length?(d=h.rest(a.dataOptions),rwApp.fetchMultipleLists({dataOptions:d,dataSoFar:a.dataSoFar,promise:b})):b.resolve(a.dataSoFar)});return b},fetchList:function(a){var b=c.Deferred();(new rwcore.StandardCollection(a)).fetch({add:!0,error:rwcore.showError,success:function(a){b.resolve(a)}});return b},
saveModel:function(a){var b=c.Deferred();a.save({},{success:function(a){b.resolve(a)}});return b},deleteModel:function(a){var b=c.Deferred();a.destroy({add:!0,success:function(){b.resolve()}});return b},fetchSavedSearch:function(a){return rwApp.fetchList({module:"SavedSearchMgr",bc:"SavedSearch",bo:"SavedSearch",sortby:"name",searchSpec:{filter:[{ftype:"expr",expression:{searchGroup:a.searchGroup}},{ftype:"expr",expression:{accessLevel:"public"}},{ftype:"expr",expression:{searchName:a.searchName}}]}})},
getSearchDefinition:function(a,b,d){b=(new ReferralWireView.FormView({applet:b})).metaApplet.model.attributes.field;for(var e=[],f=0;f<b.length;f++){var g=b[f],l=g.fldname,m=g.dataType,j=g.label,k=a.get(l),n=g.searchOperator;if((c.hasVal(k)||"DISTANCE_FROM"==n||"WEEKS_AGO"==n)&&"searchName"!=l&&"isDefaultSearch"!=l)"DISTANCE_FROM"==n?(j=c.toArray(g.part),h.each(j,function(b){l=b.fldname;k=a.get(l);c.hasVal(k)&&(thisElement=b.element,e[e.length]={fldname:thisElement,value:k})})):(j=d?j:l,"EQUALS_ID"==
n?(g=g.equalsIdField,m=a.get(g),j={fldname:g,value:m,displayName:j,displayVal:k},e[e.length]=j):"LIKE_ID"==n?(g=g.likeIdField,m=a.get(g),j={fldname:g,value:m,displayName:j,displayVal:k},e[e.length]=j):"IN"==n||"NOT_IN"==n?(j={fldname:j,value:k},e[e.length]=j):"WEEKS_AGO"==n||"WEEKS_BEFORE"==n?(j=g.compareField,fVal=a.get(j),c.hasVal(k)&&(j={fldname:l,compareField:j,value:k},e[e.length]=j)):(j="date"==m||"datetime"==m||"time"==m?{fldname:j,value:k,isDate:!0}:{fldname:j,value:k},e[e.length]=j))}return JSON.stringify(e)},
getReportModel:function(a){var b=h.clone(a.baseModel);b.set({sActor:a.sActor,sBC:a.sBC,sBO:a.sBO,isGenericFilter:"true"});var b=rwApp.xformSS(b),d={};for(attr in b.attributes)if(!h.contains(["module"],attr)){var c=b.get(attr);d[attr]=c}a.baseModel.set(d);return a.baseModel},rWizSetModel:function(a,b){b=a.get("searchapplet");var d=rwApp.getSearchDefinition(a,b,!1),c=rwApp.getSearchDefinition(a,b,!0);a.set({definition:d,fDesc:c});return a},xformSS:function(a){var b=a.get("sActor"),d=a.get("sBC"),e=
a.get("sBO"),f=c.hasVal(a.get("isGenericFilter"))?!1:!0,b=new rwcore.StandardModel({module:b,bo:d,bc:e});f&&b.set({searchName:a.get("searchName"),isDefaultSearch:a.get("isDefaultSearch"),accessLevel:a.get("accessLevel"),savedSearchId:a.get("id")});a=a.get("definition");if(!h.isUndefined(a)){a=c.toArray(a);var g={};h.each(a,function(a){var b=a.value;c.hasVal(b)&&b.hasOwnProperty("$date")&&(b=b.$date);-1<(new String(b)).indexOf("[")&&(b=b.replace("[",""),b=b.replace("]",""),b=rwFB[b]);g[a.fldname]=
b;h.isUndefined(a.displayName)||(g[a.displayName]=a.displayVal)});b.set(g)}return b},parseSavedSearch:function(a,b){for(var d=(new ReferralWireView.FormView({applet:b})).metaApplet.model.attributes.field,e={},f=0;f<d.length;f++){var g=d[f],l=g.fldname,m=a.get(l),j=g.searchOperator;if(c.hasVal(m)&&!h.isUndefined(j)||"DISTANCE_FROM"==j||"WEEKS_AGO"==j){var k={};k.dataType=g.dataType;if("DISTANCE_FROM"==j||"DISTANCE_LENGTH"==j){l=g.distanceGroup;e.hasOwnProperty(l)&&(k=e[g.distanceGroup]);k.searchOperator=
"DISTANCE";if("DISTANCE_FROM"==j){var n=a.get(g.distanceLengthField);if("ANY"!=n){if(k.distanceCompareTo=g.distanceCompareTo,n=c.toArray(g.part),h.each(n,function(b){l=b.fldname;m=a.get(l);thisElement=b.element;c.hasVal(m)&&(k[thisElement]=m)}),!(c.hasVal(k.postalCode)||c.hasVal(k.city)&&c.hasVal(k.state)&&c.hasVal(k.street)))if(n=a.get(g.distanceLengthField),"ANY"!=n){rwcore.FYI("You must provide either a zipcode or a street, city and state in order to search by distance.");return}}else k=void 0}"DISTANCE_LENGTH"==
j&&("ANY"==m?k=void 0:(k.distanceUnit=g.distanceUnit,h.isUndefined(g.distanceLengthField)?k.distanceLength=m:k.distanceLengthField=g.distanceLengthField))}else"EQUALS_ID"==j?(k.searchOperator=j,k.equalsIdField=g.equalsIdField,k.value=a.get(k.equalsIdField)):"LIKE_ID"==j?(k.searchOperator=j,k.likeIdField=g.likeIdField,k.value=a.get(k.likeIdField)):"LESS_THAN"==j||"GREATER_THAN"==j?(l=g.compareField,k.searchOperator="LT_GT",e.hasOwnProperty(l)&&(k=e[l]),k[j]=m):"WEEKS_AGO"==j||"WEEKS_BEFORE"==j?c.hasVal(m)?
(k.searchOperator=j,k.value=m,k.fieldName=l,k.compareField=g.compareField):k=void 0:"EQUALS"==j&&"ANY"==m?k=void 0:(k.searchOperator=j,k.value=m);h.isUndefined(k)||(k.fieldName=l,e[l]=k)}}return e},addConstraintPickMapExpressions:function(a,b,d){!1==h.isArray(a)&&(a=[a]);c.hasVal(d)||(d={filter:[]});!1==h.isArray(d.filter)&&(d.filter=[d.filter]);for(i=0;i<a.length;i++){var e=a[i];if("constraint"==e.type){var f=b.get(e.toField),g=e.ftype;if("expr"==g){c.hasVal(f)||(f="");var l=e.constraintExpr.replace("ZtoFieldValue",
f);d.filter[d.filter.length]={ftype:"expr",expression:l}}if(c.hasVal(f)&&h.contains(["objectId","fieldVal","fieldVal_list"],g)&&(d.filter[d.filter.length]={ftype:g,operator:e.operator,fieldname:e.fromField},"objectId"==g&&(d.filter[d.filter.length-1].objectId=f),"fieldVal"==g||"fieldVal_list"==g))d.filter[d.filter.length-1].fieldVal=f}}return d},execPickMap:function(a){for(var b=a.fromModel,d=a.pickMap,e=0;e<d.length;e++){var f=d[e];if("pick"==f.type){var g=b.get(f.fromField),g="novalue"==b.get("id")?
"":g,l={};l[f.toField]=g;a.toModel.set(l);l=f.toField;if(-1<l.indexOf("["))l=l.replace("[",""),l=l.replace("]",""),rwFB[l]=g;else{var m=".upsertContainer span#"+l;c(m).html(g);m=".upsertContainer input#"+l;c(m).html(g);c(m).attr("value",g);h.isUndefined(f.pickToMCS)||a.form.renderAllMultiCheckSearchControls()}}}c("#pickBackground").hide(50);c("#picklistContainer").hide(350)},closeStandardDialog:function(){c("#upsertRecord").animate({top:1E3},500,function(){c(this.el).hide(50);c(".overlay-background").toggle(0);
c("#upsertRecord").css("bottom","auto");c("#upsertRecord").css("height","99%");c("#upsertRecord").css("top","100%");c("#upsertRecord").hide();rwApp.preventNavigation=!1})},openStandardDialog:function(a){a=a.view;c.hasVal(a)&&c("#upsertRecord").html(a.render(a.model).el).trigger("create");c("[altTimeVal]").attr("value",c("[altTimeVal]").attr("altTimeVal"));c("[altDateVal]").attr("value",c("[altDateVal]").attr("altDateVal"));c(".datepicker").datepicker({dateFormat:"mm/dd/yy"});c(".datetimepicker").datetimepicker({dateFormat:"mm/dd/yy",
timeFormat:"hh:mm tt"});c(".timepicker").timepicker({timeFormat:"hh:mm tt"});a.renderAllMultiCheckSearchControls();c("#upsertRecord").show(50);c(".overlay-background").toggle(0);c("#upsertRecord").animate({top:0},500,function(){c("#upsertRecord").css("bottom","5px");c("#upsertRecord").css("height","auto")});rwApp.preventNavigation=!0},OONReferral:function(a){a.save({},{success:function(){c("#upsertRecord").animate({top:1E3},500,function(){c(this.el).hide(50);c(".overlay-background").toggle(0);c("#upsertRecord").css("bottom",
"auto");c("#upsertRecord").css("height","99%");c("#upsertRecord").css("top","100%");c("#upsertRecord").hide();var a=c("#PopupContainer");a.html(h.template("ReferralSentConfirmation")());a.addClass("confirmation");c(".overlay-background").show();a.show();a.one("click","[popEvent]",function(){a.hide();c(".overlay-background").hide();a.removeClass("confirmation");rwApp.preventNavigation=!1})})},error:rwcore.showError})},joinChapter:function(a){var b=new ReferralWireView.FormView({applet:"PartyUpsertForm",
templateHTML:"StdFormNarrow",showViewBar:!1});(new rwcore.StandardModel({module:b.actor})).fetch({add:!0,error:rwcore.showError,success:function(d){b.model=d;d={};d.dView=b;d.refreshFunction="rwApp.refreshTopView()";d.confirmTemplate="ConfirmJoinChapter";d.setFields="OrgId,isAmbassador,joinChapter";d.setVals=a.OrgId+",false,true";d.actionRecordId=d.dView.model.get("id");rwApp.updateKeyField(d)}})},toggleMeetingAttendence:function(a){a.handleRefresh=!0;rwcore.showWaitDialog(a.htmlTemplate,a,function(a){var d=
a.data;a=new rwcore.StandardModel({module:"AttendeeMgr"});"remove"==d.operation?(a.set({id:d.attendeeId}),rwApp.deleteModel(a).done(function(){d.refreshFunction(d.eventId)})):(a.set({eventId:d.eventId,partyId:rwFB.uId,guestType:d.OrgId==rwFB.OrgId?"MEMBER":"FLOATER",OrgId:d.OrgId,status:"INVITED"}),rwApp.saveModel(a).done(function(a){a.set({id:a.get("eventId"),orgPhotoUrl:a.get("Org_photoUrl")});d.refreshFunction(a,d.parentView)}))})},updateKeyField:function(a){if(h.isUndefined(a.target))d=a.confirmTemplate,
e=a.setFields,f=a.setVals,g=a.actionRecordId;else{var b=c.hasVal(c(a.target).attr("confirmtemplate"))?a.target:c(a.target).parents("[confirmtemplate]"),d=c(b).attr("confirmtemplate"),d=c.hasVal(a.confirmtemplate)?a.confirmtemplate:c(b).attr("confirmtemplate"),e=c(b).attr("setfieldlist"),f=c(b).attr("setvallist"),g=c(b).attr("actionRecord");c(b).attr("refreshlist")}var l=e.split(","),m=f.split(","),j=c("#PopupContainer");j.html(h.template(d)());j.addClass("confirmation");c(".overlay-background").show();
j.show();var b=a.dView,k=null;c.hasVal(b)&&(k=b.model.hasOwnProperty("models")&&c.hasVal(g)?b.model.get(g):b.model);k.options.bo=b.bo;k.options.bc=b.bc;c.hasVal(k)&&k.get("id");j.delegate("[confirmevent]","click",function(b){b.popUpContainer=j;b.thatModel=k;b.event=a;b.setFieldAry=l;b.setValAry=m;rwApp.confirmationDialogResponse(b)})},confirmationDialogResponse:function(a){var b=a.popUpContainer,d=a.target,e=a.thatModel,f=a.event;b.undelegate("[confirmevent]","click");d=c(d).attr("confirmevent");
if("save"==d){for(i=0;i<a.setFieldAry.length;i++)e.set(a.setFieldAry[i],a.setValAry[i]),"OrgId"==a.setFieldAry[i]&&(rwFB.OrgId=a.setValAry[i]);e.save({},{success:function(){b.hide();b.removeClass("confirmation");c(".overlay-background").hide();eval(f.refreshFunction)},error:function(a,b,d){h.isUndefined(that.error)||that.error(a,b,d)},done:function(){}})}"cancel"==d&&(b.hide(),c(".overlay-background").hide(),b.removeClass("confirmation"));if("delete"==d)return e.destroy({success:function(){b.hide();
c(".overlay-background").hide();b.removeClass("confirmation");f.refreshFunction()},error:function(a,d,e){b.hide();c(".overlay-background").hide();b.removeClass("confirmation");rwcore.showError(a,d,e)}}),!1;"importPhoneContacts"==d&&(c(".ui-loader").find("H1").html("loading..."),c.mobile.loading("show"),rwApp.getPhoneContacts({success:function(a){a=new rwcore.StandardModel({module:"ContactsMgr",contacts:JSON.stringify(a)});a.call("phoneCards",a,{async:!0,success:function(){c.mobile.loading("hide");
(function(){b.hide();c(".overlay-background").hide();q.history.fragment=null;eval(f.refreshFunction)})()}})}}));"confirmPayPal"==d&&(a=new rwcore.StandardModel({module:"UserMgr"}),a.set({billing_day:f.billing_day}),a.set({paypalId:f.paypalId}),a.call("setupPaypal",a,{add:!0,error:rwcore.showError,success:function(){rwcore.FYI("Paypal Id Saved");b.hide();c(".overlay-background").hide();eval(f.refreshFunction)}}));"EnrichAll"==d&&(ReferralWireBase.enrichParty(f),b.hide(),c(".overlay-background").hide())},
lookupPartnerProfile_P2P:function(a){(new rwcore.StandardModel({module:"PartnerMgr",partnerId:a})).fetch({add:!0,error:function(){rwApp.MemberSocial(a)},success:function(a){partnerId=a.get("id");rwApp.PartnerSocial(partnerId)}})},lookupPartnerProfile:function(a){(new rwcore.StandardModel({module:"PartnerMgr",partnerId:a})).fetch({add:!0,error:rwcore.showError,success:function(a){partnerId=a.get("id");rwApp.PartnerSocial(partnerId)}})},lookupContactProfile:function(a){(new rwcore.StandardModel({module:"PartnerMgr",
partnerId:a})).fetch({add:!0,error:rwcore.showError,success:function(a){partnerId=a.get("id");rwApp.PartnerListDetail(partnerId)}})},lookupPartnersPhone:function(a){(new rwcore.StandardModel({module:"PartnerMgr",partnerId:a})).fetch({add:!0,error:function(){rwApp.phoneMemberQualifications(a)},success:function(a){partnerId=a.get("id");rwApp.phoneQualifications(partnerId)}})},lookupContactPhone:function(a){(new rwcore.StandardModel({module:"PartnerMgr",partnerId:a})).fetch({add:!0,error:rwcore.showError,
success:function(a){partnerId=a.get("id");rwApp.ContactProfile(partnerId)}})},lookupPartnerPhone_P2P:function(a){rwApp.phoneMemberQualifications(a);(new rwcore.StandardModel({module:"PartnerMgr",partnerId:a})).fetch({add:!0,error:function(){rwApp.phoneMemberQualifications(a)},success:function(a){partnerId=a.get("id");rwApp.phoneQualifications(partnerId)}})},newInvitation:function(a){var b=a.toPartyId,d=a.toFullName,e=a.toFirstName,f=a.toPartyType;a=a.toEmail;if(!(c.hasVal(a)&&-1<a.indexOf("@"))&&
"CONTACT"==f)rwcore.showError(null,{status:0,statusText:"The invitee must have a valid email address"},null);else{if("PARTNER"==f)var g="ZFirstName will receive an invitation to join your network.".replace("ZFirstName",e);else a=c.addPossessiveSuffix(e),g="An invitation will be sent to ZFirstName email address with your message.".replace("ZFirstName",a);(new rwcore.StandardModel({module:"UserMgr"})).fetch({error:rwcore.showError,success:function(a){var h=a.get("id");a=c.getInvitationText(a,e,f);var j=
new ReferralWireView.FormView({applet:"Invitation",templateHTML:"UpsertFormNarrow"});j.setDefaultModel();j=j.model;j.set({toId:b,to_fullName:d,to_firstName:e,comments:a,summaryText:g,referralType:"PART_INVITE",fromId:h});rwApp.upsertRecord({el:"#upsertRecord",appletName:"PARTNER"==f?"ConnectRequest":"Invitation",upsertTemplate:"UpsertFormNarrow",upsertModel:j,parentView:null,showConfirmOnSave:"InvitationSentConfirmation",success:null})}})}},newInMail:function(a){var b=a.toPartyId,d=a.toFullName,c=
a.toFirstName;(new rwcore.StandardModel({module:"UserMgr"})).fetch({error:rwcore.showError,success:function(a){a=a.get("id");var g=new ReferralWireView.FormView({applet:"Message",templateHTML:"UpsertFormNarrow"});g.setDefaultModel();g=g.model;g.set({toId:b,to_fullName:d,to_firstName:c,comments:"",subject:"",urgency:"NORMAL",referralType:"INMAIL_REFERRAL",referralSubType:"P2PM",fromId:a});rwApp.upsertRecord({el:"#upsertRecord",appletName:"Message",upsertTemplate:"UpsertFormNarrow",upsertModel:g,parentView:null,
showConfirmOnSave:"MessageSentConfirmation",success:null})}})},newAnnouncement:function(a){a=a.chapter;var b=a.get("id"),d=new ReferralWireView.FormView({applet:"Announcement",templateHTML:"UpsertFormNarrow"});d.setDefaultModel();d=d.model;d.set({to_fullName:a.get("businessName"),toId:b,subject:"",urgency:"NORMAL",comments:"",referralType:"INMAIL_REFERRAL",referralSubType:"C2PM"});rwApp.upsertRecord({el:"#upsertRecord",appletName:"Announcement",upsertTemplate:"UpsertFormNarrow",upsertModel:d,parentView:null,
showConfirmOnSave:"MessageSentConfirmation",success:null})},inMailReply:function(a,b){rwcore.spinOn();var d='<div class="referralFormSectionTitle"><img src="'+rwFB.photoUrl+'"/><span>&nbsp;'+rwFB.fullName+" on "+(new Date).toLocaleString()+"</span></div>",d=d+"<span>"+b.val()+"</span>",e=(new rwcore.StandardModel({module:"RfrlMgr",id:a,comments2:d,status:"UNREAD"})).save({},{async:!0});c.when(e).done(function(){c("#"+a+"_msg").append(d);b.val("");rwcore.spinOff()}).fail(function(){rwcore.spinOff()})},
getNotifications:function(){var a=c.Deferred(),b=c.ajax({type:"GET",url:"/rwAlerts"});b.done(function(b){b=JSON.parse(b.notifications);var c=rwcore.cacheout("Notifications");0<b.length?(h.isUndefined(c)||(c=JSON.parse(c),null!=c&&0<c.length&&(b=h.union(b,c))),rwcore.cachein("Notifications",JSON.stringify(b))):h.isUndefined(c)||(c=JSON.parse(c),null!=c&&0<c.length&&(b=c));a.resolve(b.length)});b.fail(function(b,c,f){rwcore.showError(b,c,f);a.reject(b)});return a},clearNotifications:function(){localStorage.removeItem("Notifications");
c("#notifications").html("0")},showNotifications:function(){var a=rwcore.cacheout("Notifications");if(!h.isUndefined(a)&&(a=JSON.parse(a),null!=a&&0<a.length)){for(var b='<ul style="font-size:10pt">',d=0;d<a.length;d++)b=b+"<li>"+a[d].message+"</li>";c.when(rwcore.FYI(b+"</ul>",{left:735,top:190})).done(function(){rwApp.clearNotifications()})}}})}(r,s,u,t||window.jQuery||window.Zepto||window.ender);return r.ReferralWireRouterBase});
