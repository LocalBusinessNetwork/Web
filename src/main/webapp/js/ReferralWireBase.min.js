(function(h,a){if("object"===typeof exports){var m=require("jquery"),p=require("underscore"),r=require("backbone"),l=require("rwcore"),d=require("templatecache");module.exports=a(m,p,r,l,d)}else"function"===typeof define&&define.amd&&define(["jquery","underscore","backbone","rwcore","templatecache"],a)})(this,function(h,a,m,p,r){r=r||window.jQuery||window.Zepto||window.ender;var l={};l.extend=m.Model.extend;l.Templatecache=r;l.init=function(a){l.options=a;var g=localStorage.getItem("rwAppVersion");
if(!h.hasVal(g)||g!=a.AppVer)localStorage.clear(),localStorage.setItem("rwAppVersion",a.AppVer)};l.FullContact={findByEmail:function(a){a=p.getJSON("/rwWebRequest?module=ContactsMgr&act=FullContact&emailAddress="+a);return jQuery.parseJSON(a.data)}};l.setDefaultValues=function(d,g,b){if(!h.hasVal(g.model.attributes.field))return"";var e=h.toArray(g.model.attributes.field),f={};a.each(e,function(c){f[c.fldname]="";h.hasVal(b)&&(f[e.fldname]=b.get(c.fldname));if(!h.hasVal(f[c.fldname])&&h.hasVal(c.defaultValue)){var d=
c.defaultValue;"string"==typeof d&&-1<d.indexOf("[")&&(d=d.replace("[",""),d=d.replace("]",""),d=rwFB[d]);"RANDOM_NUMBER"==d?d=1E8*Math.random():"RANDOM_STRING"==d&&(d=1E8*Math.random(),d="STR"+d.toString());f[c.fldname]=d;"address"==c.dataType&&(c=h.toArray(c.part),a.each(c,function(a){h.hasVal(f[a.fldname])||(d=a.defaultValue,-1<d.indexOf("[")&&(d=d.replace("[",""),d=d.replace("]",""),d=rwFB[d]),f[a.fldname]=d)}))}});try{d.set(f)}catch(c){}return!0};l.setPostDefaultValues=function(d,g){if(!h.hasVal(g.model.attributes.field))return"";
var b=h.toArray(g.model.attributes.field),e={};a.each(b,function(a){if(h.hasVal(a.postDefaultValue)){var b=a.postDefaultValue;"string"==typeof b&&-1<b.indexOf("[")&&(b=b.replace("[",""),b=b.replace("]",""),b=d[b]);"RANDOM_NUMBER"==b?b=1E8*Math.random():"RANDOM_STRING"==b&&(b=1E8*Math.random(),b="STR"+b.toString());e[a.fldname]=b}});try{d.set(e)}catch(f){}return!0};l.fieldRenderer=function(a,g){return(new l.FieldView({field:a})).render(g).el.innerHTML};l.validateRequired=function(d,g){var b=g.model.attributes.field;
if(a.isUndefined(b))return null;!1==a.isArray(b)&&(b=[b]);for(var e={},f=0;f<b.length;f++){var c=b[f].required;if(!a.isUndefined(c)&&!0==c){var c=b[f].fldname,k=d.get(c),l=b[f].label;if(a.isUndefined(k)||a.isNull(k)||""==k){k=l.match(RegExp(/\[(.*?)\]/g));if(h.hasVal(k)&&0<k.length)for(j=0;j<k.length;j++)var p=k[j],q=p.replace("[",""),q=q.replace("]",""),q=d.get(q),l=l.replace(p,q);e[c]='"'+l+'"<p>'}}}return a.isEmpty(e)?null:e};l.recordBinder=function(d,g){if(!h.hasVal(g))return d;for(var b=d.querySelectorAll("input"),
e=0;e<b.length;e++)if(!a.isEmpty(b[e].id)){var f=h(b[e]).attr("databind");if(a.isEmpty(f)&&"false"!=f&&(f=g.attributes[b[e].id],b[e].setAttribute("value",""),!a.isUndefined(f)&&!a.isNull(f))){var c=b[e].type,k=!a.isUndefined(b[e].name)?b[e].name:"";b[e].setAttribute("value",f);"checkbox"==c?(c=!a.isUndefined(b[e].attributes.multicheckbox)||!a.isUndefined(b[e].attributes.multicheckbox_search)?!0:!1,"true"==f&!c&&b[e].setAttribute("checked","checked"),f="string"==typeof f?f:new String(f),c&&-1<f.indexOf(k)&&
b[e].setAttribute("checked","checked")):"radio"==c&&k==f&&b[e].setAttribute("checked","true")}}k=d.querySelectorAll("select");for(e=0;e<k.length;e++)if(!a.isEmpty(k[e].id)){f=g.attributes[k[e].id];c=k[e].options;for(b=0;b<c.length;b++)c[b].removeAttribute("selected");if(!a.isUndefined(f)&&!a.isNull(f)&&!a.isEmpty(f))for(b=0;b<c.length;b++)c[b].value===f&&c[b].setAttribute("selected","true");else c[0].setAttribute("selected","true")}b=d.querySelectorAll("img");for(e=0;e<b.length;e++)a.isEmpty(b[e].id)||
(f=g.attributes[b[e].id],!a.isUndefined(f)&&(!a.isNull(f)&&""!=f)&&b[e].setAttribute("src",f));b=d.querySelectorAll("textarea");for(e=0;e<b.length;e++)a.isEmpty(b[e].id)||(f=g.attributes[b[e].id],!a.isUndefined(f)&&!a.isNull(f)&&(b[e].innerHTML=f));var k=d.querySelectorAll("[bulletlist]"),c=h(a.template("Snippets")()).find(".profileBulletList"),l=h(a.template("Snippets")()).find(".profileBulletItem");h(a.template("Snippets")()).find(".bulletGroupContainer");for(e=0;e<k.length;e++)if(!a.isEmpty(k[e].id)){var m=
c.clone();h(k[e]).show();h(k[e]).find("ul").remove();f=g.attributes[k[e].id];if(!a.isUndefined(f)&&!a.isNull(f)&&""!=f){f=f.split("\n");for(b=0;b<f.length;b++){var q=l.clone();q.html(f[b]);m.append(q)}h(k[e]).append(m)}else h(k[e]).hide()}b=d.querySelectorAll("span");for(e=0;e<b.length;e++)a.isEmpty(b[e].id)||(f=g.attributes[b[e].id],!a.isUndefined(f)&&!a.isNull(f)&&(b[e].innerHTML=f));b=d.querySelectorAll("[pickapplet] span");for(e=0;e<b.length;e++)a.isEmpty(b[e].id)||(f=g.attributes[b[e].id],!1==
h.hasVal(f)&&(b[e].innerHTML="Choose One"));e=/Zlhs/g;f=d.innerHTML;f=f.replace(e,"<%=");e=/Zrhs/g;f=f.replace(e,"%>");try{var u=a.template(f,{model:g,_:a,getLovDisplayVal:p.getLovDisplayVal})}catch(s){console.log(s)}return u};l.PickList=m.View.extend({initialize:function(a){this.options=a;this.pickListTemplate=h.hasVal(a.pickTemplate)?a.pickTemplate:requirejs("text!/Templates/Lists/StdPicklistTemplate.html")},render:function(d){h(this.el).html(a.template(this.pickListTemplate,{model:this.model,key:this.options.key,
display:this.options.display,displayListField:this.options.displayListField,radioField:this.options.radioField,fldname:this.options.fldname,order:this.options.order,readonly:d,_:a}));return this}});l.FieldModel=m.Model.extend();l.FieldView=m.View.extend({initialize:function(a){this.model=a.field},render:function(d){var g=this,b=g.model.dataType,e=l.Templatecache.fields[b],f="Captcha"==b&&!1==d?p.GetCaptcha():"",c=a.template(e,{readonly:d,attributes:this.model,url:f,_:a}),k=g.model.lovType,m=g.model.lovGroup,
e=g.model.pickApplet,z=g.model.pickListTemplate,q=g.model.lookupKeyField,u=g.model.lookupDisplayField;if(h.hasVal(k)&&"multicheckbox"==b&&d)c=a.template("MultiCheckBoxes",{readonly:d,attributes:this.model,url:f,_:a});else if(h.hasVal(k)&&a.isUndefined(e)){var f=this.model.dynamicFilterValue,s=this.model.applyFilterToLovField,v=!1,t=null;h.hasVal(f)&&h.hasVal(s)&&(t={},t[s]=f,v=!0);(new p.LOVCollection({module:"LovMgr",LovType:k,Locale:"ENU",Group:a.isNull(m)?void 0:m,constraint:a.isNull(t)?void 0:
t,skipCache:v})).fetch({add:!0,async:!1,error:p.ShowError,success:function(a){var e="StdPickList";"radio"==b&&(e="RadioButtons");"multicheckbox"==b&&(e="MultiCheckBoxes");"multicheckbox_search"==b&&(e="MultiCheckBoxes_Search");c=(new l.PickList({model:a,fldname:g.model.fldname,displayListField:g.model.displayListField,pickTemplate:e,key:q,display:u})).render(d).el.innerHTML}})}a.contains(["radio","multicheckbox_search"],b)&&h.hasVal(e)&&(k=null,"radio"==b&&(k="RadioButtonsDynamic"),"multicheckbox"==
b&&(k="MultiCheckBoxes"),"multicheckbox_search"==b&&(k=z),z=this.model.radioList,m=h.hasVal(g.model.radioField)?g.model.radioField:g.model.fldname,c=(new l.PickList({model:z,fldname:g.model.fldname,displayListField:g.model.displayListField,order:g.model.order,radioField:m,pickTemplate:k,key:q,display:u})).render(d).el.innerHTML);!1==d?h.hasVal(e)&&!a.contains(["radio","multicheckbox_search"],b)&&(c=a.template("pickLaunchButton",{insideHtml:c,model:g.model})):(e=g.model.drilldown,!a.isUndefined(e)&&
(!a.isNull(e)&&0<e.length)&&(c=a.template("drilldownTemplate",{insideHtml:c,model:g.model})));h(this.el).html(c);return this}});l.RepoObjectModel=m.Model.extend({options:null,sync:function(){var d=localStorage.getItem(this.options.type+"."+this.options.name);!a.isUndefined(d)&&!a.isNull(d)?this.set(JSON.parse(d)):(d=p.getJSON("/rwWebRequest?module=RepoMgr&act="+this.options.type+"&name="+this.options.name),!a.isUndefined(d)&&!a.isNull(d)&&(this.set(d),localStorage.setItem(this.options.type+"."+this.options.name,
JSON.stringify(this))))},initialize:function(d){this.options=d;a.isUndefined(d)?p.FYI("Repo Data is missing"):this.sync()}});l.AppletView=m.View.extend({actor:"",applet:"",template:"",showViewBar:!1,viewBarTemplate:null,initialize:function(d){this.applet=d.applet;this.template=d.template;this.model=new l.RepoObjectModel({type:"Applet",name:this.applet});this.actor=this.model.get("actor");this.bc=this.model.get("bc");this.bo=this.model.get("bo");this.clickRoute=d.clickRoute;this.viewBarTemplate="ActionBarTemplate";
!a.isUndefined(d.viewBarTemplate)&&!a.isNull(d.viewBarTemplate)&&(this.viewBarTemplate=d.viewBarTemplate);!a.isUndefined(d.showViewBar)&&(!a.isNull(d.showViewBar)&&d.showViewBar)&&(this.showViewBar=!0);this.options=d},renderFields:function(d){var g=this.model.attributes.field;if(a.isUndefined(g))return"";d=h.hasVal(d)&&h.hasVal(d.data)?d.data:null;g=h.toArray(g);g=a.sortBy(g,function(a){return parseInt(a.order)});return a.template(this.options.template,{attributes:g,_:a,applet:this.model.attributes,
data:d,fieldRenderer:l.fieldRenderer,metaApplet:this.model.attributes})},renderActionsBar:function(){var d=this.model.attributes.action;if(a.isUndefined(d))return"";d=h.toArray(d);d=a.sortBy(d,function(a){return parseInt(a.order)});return a.template(this.viewBarTemplate,{attributes:d,_:a,applet:this.model.attributes,clickRoute:this.clickRoute})},render:function(d){var g=a.isUndefined(this.clickRoute)?"":this.clickRoute,g=this.applet+this.template+g,b=p.cacheout(g);if(a.isUndefined(b)||a.isNull(b))b=
this.showViewBar?this.renderFields(d)+this.renderActionsBar():this.renderFields(d),a.isUndefined(this.model.get("caching"))&&p.cachein(g,b);h(this.el).html(b);return this}});l.vCard_fileimport=function(d){var g=h.Deferred(),b=void 0,b=h.browser.msie?(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(d.target.value).ReadAll():d.target.files[0];void 0!=b&&(d=new FileReader,d.onload=function(d){var b=new p.StandardCollection({module:"ContactsMgr"});b.comparator=function(a){return a.get("firstName")};
b.reset();d=d.target.result.split(/END:VCARD/);for(n in d){vCard=d[n];var c={};h.vcard_parse(vCard,c);if(!a.isEmpty(c.fn)){var k=c.fn.trim().split(" "),l="",m="",q="",u="",s="",v="",t="";a.isUndefined(k[0])||(l=k[0]);a.isUndefined(k[2])?a.isUndefined(k[1])||(m=k[1]):m=k[2];a.isUndefined(c.title)||(q=c.title);a.isUndefined(c.org)||(u=c.org);if("2.1"==c.version)!a.isUndefined(c.email)&&!a.isUndefined(c.email.internet[0])&&(s=c.email.internet[0]);else if("3.0"==c.version){!a.isUndefined(c.email)&&a.isUndefined(c.email["type=work"])&&
a.isUndefined(c.email.work)?s=c.email[0]:(!a.isUndefined(c.email)&&!a.isUndefined(c.email["type=work"])&&(s=c.email["type=work"][0]),!a.isUndefined(c.email)&&!a.isUndefined(c.email.work)&&(s=c.email.work[0]));!a.isUndefined(c.tel)&&a.isUndefined(c.tel["type=work"])&&a.isUndefined(c.tel.work)?v=c.tel[0]:(!a.isUndefined(c.tel)&&!a.isUndefined(c.tel["type=work"])&&(v=c.tel["type=work"][0]),!a.isUndefined(c.tel)&&!a.isUndefined(c.tel.work)&&(v=c.tel.work[0]));!a.isUndefined(c.tel)&&!a.isUndefined(c.tel["type=cell"])&&
(t=c.tel["type=cell"][0]);!a.isUndefined(c.tel)&&!a.isUndefined(c.tel.voice)&&(t=c.tel.voice[1]);var r,w,x,y,A;!a.isUndefined(c.adr)&&a.isUndefined(c.adr["type=work"])&&a.isUndefined(c.adr.work)?(r=c.adr["default"][0][2],w=c.adr["default"][0][3],x=c.adr["default"][0][4],y=c.adr["default"][0][5]):(!a.isUndefined(c.adr)&&!a.isUndefined(c.adr["type=work"])&&(r=c.adr["type=work"][0][2],w=c.adr["type=work"][0][3],x=c.adr["type=work"][0][4],y=c.adr["type=work"][0][5]),!a.isUndefined(c.adr)&&!a.isUndefined(c.adr.work)&&
(r=c.adr.work[0][2],w=c.adr.work[0][3],x=c.adr.work[0][4],y=c.adr.work[0][5]));!a.isUndefined(c.url)&&!a.isUndefined(c.url.home)&&(A=c.url.home[0])}c=new p.StandardModel({module:"ContactsMgr"});c.set({firstName:l,lastName:m,jobTitle:q,business:u,workPhone:v,mobilePhone:t,emailAddress:s,streetAddress1_work:r,cityAddress_work:w,stateAddress_work:x,postalCodeAddress_work:y,photoUrl:void 0,note:A});b.add(c,{silent:!0})}}g.resolve(b)},d.readAsText(b));return g};l.ExportContactsToServer=function(a){var g=
h.Deferred();a=h.ajax({type:"POST",url:"/rwWebRequest?",async:!0,cache:!0,dataType:"json",data:{data:JSON.stringify({module:"ContactsMgr",act:"importContacts",contacts:a})}});a.done(function(a){g.resolve(a)});a.fail(function(a,d,f){p.showError(a,d,f);g.resolve()});return g};l.GetOutlookContactsCollection=function(){if(h.browser.msie)try{var a=(new ActiveXObject("Outlook.Application")).GetNamespace("MAPI");if(a){var g=a.GetDefaultFolder(10),b=new p.StandardCollection({module:"ContactsMgr"});b.comparator=
function(a){return a.get("firstName")};for(a=1;a<=g.items.count;a++){var e=g.items(a),f=new p.StandardModel({module:"ContactsMgr"});h.hasVal(e.FirstName)&&h.hasVal(e.LastName)&&(f.set({firstName:e.FirstName,lastName:e.LastName,workPhone:e.BusinessTelephoneNumber,mobilePhone:e.MobileTelephoneNumber,emailAddress:e.Email1Address,streetAddress1:e.BusinessAddress,cityAddress:e.BusinessAddressCity,stateAddress:e.BusinessAddressState,business:e.CompanyName,postalCodeAddress:e.BusinessAddressPostalCode}),
b.add(f,{silent:!0}))}return b}}catch(c){return p.FYI("Outlook needs to be installed on this computer for importing contacts."),null}};l.enrichParty=function(){var a=new p.StandardModel({module:"ContactsMgr"});a.sync("EnrichAll",a,{success:function(){},error:p.showError})};m.ReferralWireBase=ReferralWireBase=l;return m.ReferralWireBase});
